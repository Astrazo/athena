import{n as h,d as p,h as w,o as I,m,i as R}from"./main-CaYjMSie.js";import{s as S,_ as v,u as E}from"./objectives-DTNZ8ZM1.js";import"./typewriter-KOhSjPsI.js";import{t as P}from"./toast-Ch3uAxuw.js";const z=localStorage.getItem("connectedRoomId"),u=localStorage.getItem("connectedUserId");localStorage.getItem("connectedRoomName");localStorage.getItem("connectedUsername");const c=localStorage.getItem("connectedUserRole");let b=null,r=null,y=null,a=0,d=null,s=!0;document.getElementById("back").addEventListener("click",()=>{h("Situation Room")});function C(e){if(e){document.getElementById("roomName").textContent=`Room: ${e.roomName}`,document.getElementById("currentDay").textContent=`Day: ${e.currentDay}`;const n=e.roomPlayers?Object.values(e.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${n.length}/4`,document.getElementById("yourName").textContent="",b=e.roomPlayers[u].enablerComplete,r=e.roomPlayers[u].enabledComplete;const t=e.roomPlayers[u].enabledValue;y=t!=null,a=e.currentDay,t!==null&&t!=d&&(localStorage.getItem("enabledValueToastShown")||(N().catch(o=>{console.warn("Error showing enabled value toast:",o)}),localStorage.setItem("enabledValueToastShown","true"))),t===null&&d!==null&&localStorage.removeItem("enabledValueToastShown"),d=t}}async function N(){const e={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"},n=T(c,a),t=e[n];P.success(`The ${t} has sent you some information to be used in another room.`);try{const{playNotification:o}=await v(async()=>{const{playNotification:l}=await import("./audio-BlIkHaSl.js");return{playNotification:l}},[]);o()}catch(o){console.warn("Audio not available:",o)}O()&&_()}function T(e,n){const t=R[n];for(const[o,l]of Object.entries(t))if(l===e)return o;return null}function O(){return V()==="research-lab"}function V(){var n;return((n={1:{ca:"research-lab",ne:"developer-hub",se:"server-room",ds:"command-centre"},2:{ca:"command-centre",ne:"server-room",se:"research-lab",ds:"command-centre"},3:{ca:"command-centre",ne:"server-room",se:"developer-hub",ds:"research-lab"}}[a])==null?void 0:n[c])||null}function _(){var n,t,o;const e=(o=(t=(n=m)==null?void 0:n[a])==null?void 0:t[c])==null?void 0:o["research-lab"];e&&e.enabled&&typewriter.showSequence(e.enabled)}function q(){var e,n,t;if(s){const o=((t=(n=(e=m)==null?void 0:e[a])==null?void 0:n[c])==null?void 0:t["research-lab"])||null;if(o===null)typewriter.showSequence(m["WRONG-ROOM"]);else if(o.enabler)if(!b)typewriter.showSequence(o.enabler);else{const l=o["enabler-complete"].slice(0,-1),i=f();typewriter.showSequence([...l,i])}else if(o.enabled)if(y&&!r)typewriter.showSequence(o.enabled);else if(r){const l=o["enabled-complete"].slice(0,-1),i=f();typewriter.showSequence([...l,i])}else typewriter.showSequence(o["enabled-not-available"]);s=!1}}function f(){return r&&b?(E("Objective","Return to situation room and wait."),"You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."):"You should investigate some other rooms in case you can assist further."}const g=p(z,e=>{e?(console.log("Room updated."),C(e),w(e,document.getElementById("players")),S("research-lab",e,localStorage.getItem("connectedUserRole")),s&&(I(e,"research-lab",localStorage.getItem("connectedUserRole"),document.getElementById("availableActions")),q(),s=!1)):(console.error("Room not found"),window.location.href="../index.html")});window.addEventListener("beforeunload",()=>{g&&g()});
