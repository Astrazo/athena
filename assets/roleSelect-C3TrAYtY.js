import{d as p,u as f}from"./main-C1qx7syO.js";import"./typewriter-KOhSjPsI.js";import{s as C}from"./objectives-CkNNXkI5.js";const u=localStorage.getItem("connectedRoomId"),d=localStorage.getItem("connectedUserId"),I=localStorage.getItem("connectedRoomName"),B=localStorage.getItem("connectedUsername");JSON.parse(localStorage.getItem("roomData")||"{}");document.addEventListener("DOMContentLoaded",()=>{console.log("Page loaded - forcing team selection to be hidden"),document.getElementById("waitingSection").style.display="none",document.getElementById("roleButtons").style.display="block"});let y=!0;document.getElementById("roomName").textContent=I;function S(e){if(e){document.getElementById("roomName").textContent=`Room: ${e.roomName}`;const t=e.roomPlayers?Object.values(e.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${t.length}/4`,document.getElementById("yourName").textContent=`You: ${B}`,t.length>0&&t.every(r=>r.role&&r.role!==null)&&(console.log("All roles selected"),setTimeout(()=>{window.location.href="finalise-roles.html"},2e3))}}function w(){document.getElementById("roleButtons").style.display="none",document.getElementById("waitingSection").style.display="block"}function b(){console.log("Hiding waiting state - hiding team selection, showing role buttons"),document.getElementById("roleButtons").style.display="block",document.getElementById("waitingSection").style.display="none",console.log("Role buttons display:",document.getElementById("roleButtons").style.display),console.log("Waiting section display:",document.getElementById("waitingSection").style.display)}function g(e){if(e&&e.roomPlayers){const t=e.roomPlayers[d];console.log("Current player data:",t),console.log("Current player role:",t==null?void 0:t.role);const o=!!(t&&t.role&&t.role!==null);return console.log("Has role:",o),o}return!1}function N(e){const t=document.getElementById("rolePlayers");if(!t||!e||!e.roomPlayers)return;t.innerHTML="";const o=Object.entries(e.roomPlayers).sort((m,n)=>{const l=m[1].name.toLowerCase(),s=n[1].name.toLowerCase();return l.localeCompare(s)}),r={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"};o.forEach(([m,n])=>{const l=document.createElement("li");m===d&&l.classList.add("current-player"),l.textContent=n.name;const s=document.createElement("div");s.className="status-container";const a=document.createElement("span");a.className="status-text";const i=n.role&&n.role!==null,E=i?r[n.role]||n.role:"Choosing...";a.textContent=E,a.style.color=i?"#4CAF50":"#ff6b6b";const c=document.createElement("div");c.className="status-light",c.style.backgroundColor=i?"#4CAF50":"#ff6b6b",c.style.boxShadow=i?"0 0 8px #4CAF50":"0 0 8px #ff6b6b",s.appendChild(a),s.appendChild(c),l.appendChild(s),t.appendChild(l)})}const h=p(u,e=>{e?(S(e),C("role-select"),y&&(typewriter.showSequence([">> SYSTEM BOOT COMPLETE",">> CONNECTION ESTABLISHED WITH HELIOS FACILITY BRIEFING TERMINAL","The Briefing Room glows softly under the flickering light of the holographic table.","Commander Reyes’s face appears, tense, urgent.",`"Athena’s locked us out. She's taken control of Helios."`,'"We need specialists on-site immediately."',"Four specializations flash onto the display: Cybersecurity Analyst, Software Engineer, Network Engineer, Data Scientist.","Your teammates glance at each other, then at you.",'"Each path is critical. Choose yours carefully."',"Waiting for all operatives to select roles..."]),y=!1),console.log("Checking role selection - hasCurrentUserRole result:",g(e)),g(e)?(console.log("User has role - showing team selection"),N(e),w()):(console.log("User has no role - hiding team selection"),b())):(console.error("Room not found"),window.location.href="../index.html")});document.addEventListener("DOMContentLoaded",()=>{});document.querySelectorAll(".role-button").forEach(e=>{e.addEventListener("click",async()=>{({dsBtn:"Data Scientist",seBtn:"Software Engineer",neBtn:"Network Engineer",caBtn:"Cybersecurity Analyst"})[e.id];try{f(d,u,"role",e.id.slice(0,2)),document.getElementById("roleButtons").style.display="none",document.getElementById("waitingSection").style.display="block"}catch(o){console.error("Error in updatePlayer:",o)}})});document.getElementById("changeMindBtn").addEventListener("click",async()=>{f(d,u,"role",null),document.getElementById("roleButtons").style.display="block",document.getElementById("waitingSection").style.display="none"});window.addEventListener("beforeunload",()=>{h&&h()});
