import{n as h,d as w,h as v,o as I,m,i as S}from"./main-C1qx7syO.js";import{s as b,_ as R}from"./objectives-CkNNXkI5.js";import"./typewriter-KOhSjPsI.js";import{t as E}from"./toast-Ch3uAxuw.js";const P=localStorage.getItem("connectedRoomId"),u=localStorage.getItem("connectedUserId");localStorage.getItem("connectedRoomName");localStorage.getItem("connectedUsername");const c=localStorage.getItem("connectedUserRole");let g=null,r=null,p=null,a=0,d=null,s=!0;document.getElementById("back").addEventListener("click",()=>{h("Situation Room")});function z(e){if(e){document.getElementById("roomName").textContent=`Room: ${e.roomName}`,document.getElementById("currentDay").textContent=`Day: ${e.currentDay}`;const n=e.roomPlayers?Object.values(e.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${n.length}/4`,document.getElementById("yourName").textContent="",g=e.roomPlayers[u].enablerComplete,r=e.roomPlayers[u].enabledComplete;const t=e.roomPlayers[u].enabledValue;p=t!=null,a=e.currentDay,t!==null&&t!=d&&(localStorage.getItem("enabledValueToastShown")||(C().catch(o=>{console.warn("Error showing enabled value toast:",o)}),localStorage.setItem("enabledValueToastShown","true"))),t===null&&d!==null&&localStorage.removeItem("enabledValueToastShown"),d=t}}async function C(){console.log("showEnabledValueToast called");const e={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"},n=S[a][c],t=e[n];E.success(`The ${t} has sent you some information to be used in another room.`);try{console.log("Importing audio module...");const{playNotification:o}=await R(async()=>{const{playNotification:l}=await import("./audio-BlIkHaSl.js");return{playNotification:l}},[]);console.log("Audio module imported, playing notification..."),o()}catch(o){console.warn("Audio not available:",o)}T()&&V()}function T(){return N()==="server-room"}function N(){var n;return((n={1:{ca:"research-lab",ne:"developer-hub",se:"server-room",ds:"command-centre"},2:{ca:"command-centre",ne:"server-room",se:"research-lab",ds:"command-centre"},3:{ca:"command-centre",ne:"server-room",se:"developer-hub",ds:"research-lab"}}[a])==null?void 0:n[c])||null}function V(){var n,t,o;const e=(o=(t=(n=m)==null?void 0:n[a])==null?void 0:t[c])==null?void 0:o["server-room"];e&&e.enabled&&typewriter.showSequence(e.enabled)}function O(){var e,n,t;if(s){const o=((t=(n=(e=m)==null?void 0:e[a])==null?void 0:n[c])==null?void 0:t["server-room"])||null;if(o===null)typewriter.showSequence(m["WRONG-ROOM"]);else if(o.enabler)if(!g)typewriter.showSequence(o.enabler);else{const l=o["enabler-complete"].slice(0,-1),i=y();typewriter.showSequence([...l,i])}else if(o.enabled)if(p&&!r)typewriter.showSequence(o.enabled);else if(r){const l=o["enabled-complete"].slice(0,-1),i=y();typewriter.showSequence([...l,i])}else typewriter.showSequence(o["enabled-not-available"]);s=!1}}function y(){return r&&g?(b("Objective","Return to situation room and wait."),"You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."):(b("Objective","Explore other rooms."),"You should investigate some other rooms in case you can assist further.")}const f=w(P,e=>{e?(console.log("Room updated."),z(e),v(e,document.getElementById("players")),b("server-room",e,localStorage.getItem("connectedUserRole")),s&&(I(e,"server-room",localStorage.getItem("connectedUserRole"),document.getElementById("availableActions")),O(),s=!1)):(console.error("Room not found"),window.location.href="../index.html")});window.addEventListener("beforeunload",()=>{f&&f()});
