(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();const Id=()=>{};var Za={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oc=function(n){const e=[];let t=0;for(let o=0;o<n.length;o++){let r=n.charCodeAt(o);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&o+1<n.length&&(n.charCodeAt(o+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++o)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Ad=function(n){const e=[];let t=0,o=0;for(;t<n.length;){const r=n[t++];if(r<128)e[o++]=String.fromCharCode(r);else if(r>191&&r<224){const i=n[t++];e[o++]=String.fromCharCode((r&31)<<6|i&63)}else if(r>239&&r<365){const i=n[t++],a=n[t++],c=n[t++],h=((r&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;e[o++]=String.fromCharCode(55296+(h>>10)),e[o++]=String.fromCharCode(56320+(h&1023))}else{const i=n[t++],a=n[t++];e[o++]=String.fromCharCode((r&15)<<12|(i&63)<<6|a&63)}}return e.join("")},Lc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let r=0;r<n.length;r+=3){const i=n[r],a=r+1<n.length,c=a?n[r+1]:0,h=r+2<n.length,d=h?n[r+2]:0,f=i>>2,g=(i&3)<<4|c>>4;let y=(c&15)<<2|d>>6,A=d&63;h||(A=64,a||(y=64)),o.push(t[f],t[g],t[y],t[A])}return o.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Oc(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Ad(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let r=0;r<n.length;){const i=t[n.charAt(r++)],c=r<n.length?t[n.charAt(r)]:0;++r;const d=r<n.length?t[n.charAt(r)]:64;++r;const g=r<n.length?t[n.charAt(r)]:64;if(++r,i==null||c==null||d==null||g==null)throw new Cd;const y=i<<2|c>>4;if(o.push(y),d!==64){const A=c<<4&240|d>>2;if(o.push(A),g!==64){const P=d<<6&192|g;o.push(P)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Cd extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Rd=function(n){const e=Oc(n);return Lc.encodeByteArray(e,!0)},qo=function(n){return Rd(n).replace(/\./g,"")},Sd=function(n){try{return Lc.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pd(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kd=()=>Pd().__FIREBASE_DEFAULTS__,Vd=()=>{if(typeof process>"u"||typeof Za>"u")return;const n=Za.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Dd=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Sd(n[1]);return e&&JSON.parse(e)},ei=()=>{try{return Id()||kd()||Vd()||Dd()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Nd=n=>{var e,t;return(t=(e=ei())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},xd=n=>{const e=Nd(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),o]:[e.substring(0,t),o]},Mc=()=>{var n;return(n=ei())===null||n===void 0?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Od{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,o)=>{t?this.reject(t):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,o))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ti(n){return n.endsWith(".cloudworkstations.dev")}async function Ld(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Md(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},o=e||"demo-project",r=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},n);return[qo(JSON.stringify(t)),qo(JSON.stringify(a)),""].join(".")}const Vn={};function Bd(){const n={prod:[],emulator:[]};for(const e of Object.keys(Vn))Vn[e]?n.emulator.push(e):n.prod.push(e);return n}function Fd(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let el=!1;function Ud(n,e){if(typeof window>"u"||typeof document>"u"||!ti(window.location.host)||Vn[n]===e||Vn[n]||el)return;Vn[n]=e;function t(y){return`__firebase__banner__${y}`}const o="__firebase__banner",i=Bd().prod.length>0;function a(){const y=document.getElementById(o);y&&y.remove()}function c(y){y.style.display="flex",y.style.background="#7faaf0",y.style.position="fixed",y.style.bottom="5px",y.style.left="5px",y.style.padding=".5em",y.style.borderRadius="5px",y.style.alignItems="center"}function h(y,A){y.setAttribute("width","24"),y.setAttribute("id",A),y.setAttribute("height","24"),y.setAttribute("viewBox","0 0 24 24"),y.setAttribute("fill","none"),y.style.marginLeft="-6px"}function d(){const y=document.createElement("span");return y.style.cursor="pointer",y.style.marginLeft="16px",y.style.fontSize="24px",y.innerHTML=" &times;",y.onclick=()=>{el=!0,a()},y}function f(y,A){y.setAttribute("id",A),y.innerText="Learn more",y.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",y.setAttribute("target","__blank"),y.style.paddingLeft="5px",y.style.textDecoration="underline"}function g(){const y=Fd(o),A=t("text"),P=document.getElementById(A)||document.createElement("span"),V=t("learnmore"),k=document.getElementById(V)||document.createElement("a"),U=t("preprendIcon"),B=document.getElementById(U)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(y.created){const $=y.element;c($),f(k,V);const J=d();h(B,U),$.append(B,P,k,J),document.body.appendChild($)}i?(P.innerText="Preview backend disconnected.",B.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(B.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,P.innerText="Preview backend running in this workspace."),P.setAttribute("id",A)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $d(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function qd(){var n;const e=(n=ei())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function jd(){return!qd()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Yd(){try{return typeof indexedDB=="object"}catch{return!1}}function zd(){return new Promise((n,e)=>{try{let t=!0;const o="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(o);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(o),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var i;e(((i=r.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hd="FirebaseError";class on extends Error{constructor(e,t,o){super(t),this.code=e,this.customData=o,this.name=Hd,Object.setPrototypeOf(this,on.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Bc.prototype.create)}}class Bc{constructor(e,t,o){this.service=e,this.serviceName=t,this.errors=o}create(e,...t){const o=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],a=i?Wd(i,o):"Error",c=`${this.serviceName}: ${a} (${r}).`;return new on(r,c,o)}}function Wd(n,e){return n.replace(Gd,(t,o)=>{const r=e[o];return r!=null?String(r):`<${o}?>`})}const Gd=/\{\$([^}]+)}/g;function jo(n,e){if(n===e)return!0;const t=Object.keys(n),o=Object.keys(e);for(const r of t){if(!o.includes(r))return!1;const i=n[r],a=e[r];if(tl(i)&&tl(a)){if(!jo(i,a))return!1}else if(i!==a)return!1}for(const r of o)if(!t.includes(r))return!1;return!0}function tl(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qe(n){return n&&n._delegate?n._delegate:n}class Mn{constructor(e,t,o){this.name=e,this.instanceFactory=t,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kt="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const o=new Od;if(this.instancesDeferred.set(t,o),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&o.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(i){if(r)return null;throw i}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Xd(e))try{this.getOrInitializeService({instanceIdentifier:kt})}catch{}for(const[t,o]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:r});o.resolve(i)}catch{}}}}clearInstance(e=kt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=kt){return this.instances.has(e)}getOptions(e=kt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:o,options:t});for(const[i,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);o===c&&a.resolve(r)}return r}onInit(e,t){var o;const r=this.normalizeInstanceIdentifier(t),i=(o=this.onInitCallbacks.get(r))!==null&&o!==void 0?o:new Set;i.add(e),this.onInitCallbacks.set(r,i);const a=this.instances.get(r);return a&&e(a,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const o=this.onInitCallbacks.get(t);if(o)for(const r of o)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:Qd(e),options:t}),this.instances.set(e,o),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=kt){return this.component?this.component.multipleInstances?e:kt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Qd(n){return n===kt?void 0:n}function Xd(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jd{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Kd(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var z;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(z||(z={}));const Zd={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},em=z.INFO,tm={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},nm=(n,e,...t)=>{if(e<n.logLevel)return;const o=new Date().toISOString(),r=tm[e];if(r)console[r](`[${o}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Fc{constructor(e){this.name=e,this._logLevel=em,this._logHandler=nm,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in z))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Zd[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...e),this._logHandler(this,z.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...e),this._logHandler(this,z.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,z.INFO,...e),this._logHandler(this,z.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,z.WARN,...e),this._logHandler(this,z.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...e),this._logHandler(this,z.ERROR,...e)}}const om=(n,e)=>e.some(t=>n instanceof t);let nl,ol;function rm(){return nl||(nl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function sm(){return ol||(ol=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Uc=new WeakMap,Is=new WeakMap,$c=new WeakMap,ls=new WeakMap,ni=new WeakMap;function im(n){const e=new Promise((t,o)=>{const r=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(at(n.result)),r()},a=()=>{o(n.error),r()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Uc.set(t,n)}).catch(()=>{}),ni.set(e,n),e}function am(n){if(Is.has(n))return;const e=new Promise((t,o)=>{const r=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),r()},a=()=>{o(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});Is.set(n,e)}let As={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Is.get(n);if(e==="objectStoreNames")return n.objectStoreNames||$c.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return at(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function lm(n){As=n(As)}function cm(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const o=n.call(cs(this),e,...t);return $c.set(o,e.sort?e.sort():[e]),at(o)}:sm().includes(n)?function(...e){return n.apply(cs(this),e),at(Uc.get(this))}:function(...e){return at(n.apply(cs(this),e))}}function um(n){return typeof n=="function"?cm(n):(n instanceof IDBTransaction&&am(n),om(n,rm())?new Proxy(n,As):n)}function at(n){if(n instanceof IDBRequest)return im(n);if(ls.has(n))return ls.get(n);const e=um(n);return e!==n&&(ls.set(n,e),ni.set(e,n)),e}const cs=n=>ni.get(n);function hm(n,e,{blocked:t,upgrade:o,blocking:r,terminated:i}={}){const a=indexedDB.open(n,e),c=at(a);return o&&a.addEventListener("upgradeneeded",h=>{o(at(a.result),h.oldVersion,h.newVersion,at(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),c.then(h=>{i&&h.addEventListener("close",()=>i()),r&&h.addEventListener("versionchange",d=>r(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const dm=["get","getKey","getAll","getAllKeys","count"],mm=["put","add","delete","clear"],us=new Map;function rl(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(us.get(e))return us.get(e);const t=e.replace(/FromIndex$/,""),o=e!==t,r=mm.includes(t);if(!(t in(o?IDBIndex:IDBObjectStore).prototype)||!(r||dm.includes(t)))return;const i=async function(a,...c){const h=this.transaction(a,r?"readwrite":"readonly");let d=h.store;return o&&(d=d.index(c.shift())),(await Promise.all([d[t](...c),r&&h.done]))[0]};return us.set(e,i),i}lm(n=>({...n,get:(e,t,o)=>rl(e,t)||n.get(e,t,o),has:(e,t)=>!!rl(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fm{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(gm(t)){const o=t.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(t=>t).join(" ")}}function gm(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Cs="@firebase/app",sl="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xe=new Fc("@firebase/app"),pm="@firebase/app-compat",ym="@firebase/analytics-compat",wm="@firebase/analytics",_m="@firebase/app-check-compat",vm="@firebase/app-check",bm="@firebase/auth",Tm="@firebase/auth-compat",Em="@firebase/database",Im="@firebase/data-connect",Am="@firebase/database-compat",Cm="@firebase/functions",Rm="@firebase/functions-compat",Sm="@firebase/installations",Pm="@firebase/installations-compat",km="@firebase/messaging",Vm="@firebase/messaging-compat",Dm="@firebase/performance",Nm="@firebase/performance-compat",xm="@firebase/remote-config",Om="@firebase/remote-config-compat",Lm="@firebase/storage",Mm="@firebase/storage-compat",Bm="@firebase/firestore",Fm="@firebase/ai",Um="@firebase/firestore-compat",$m="firebase",qm="11.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rs="[DEFAULT]",jm={[Cs]:"fire-core",[pm]:"fire-core-compat",[wm]:"fire-analytics",[ym]:"fire-analytics-compat",[vm]:"fire-app-check",[_m]:"fire-app-check-compat",[bm]:"fire-auth",[Tm]:"fire-auth-compat",[Em]:"fire-rtdb",[Im]:"fire-data-connect",[Am]:"fire-rtdb-compat",[Cm]:"fire-fn",[Rm]:"fire-fn-compat",[Sm]:"fire-iid",[Pm]:"fire-iid-compat",[km]:"fire-fcm",[Vm]:"fire-fcm-compat",[Dm]:"fire-perf",[Nm]:"fire-perf-compat",[xm]:"fire-rc",[Om]:"fire-rc-compat",[Lm]:"fire-gcs",[Mm]:"fire-gcs-compat",[Bm]:"fire-fst",[Um]:"fire-fst-compat",[Fm]:"fire-vertex","fire-js":"fire-js",[$m]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yo=new Map,Ym=new Map,Ss=new Map;function il(n,e){try{n.container.addComponent(e)}catch(t){Xe.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function zo(n){const e=n.name;if(Ss.has(e))return Xe.debug(`There were multiple attempts to register component ${e}.`),!1;Ss.set(e,n);for(const t of Yo.values())il(t,n);for(const t of Ym.values())il(t,n);return!0}function zm(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Hm(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wm={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},lt=new Bc("app","Firebase",Wm);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gm{constructor(e,t,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new Mn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw lt.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Km=qm;function qc(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const o=Object.assign({name:Rs,automaticDataCollectionEnabled:!0},e),r=o.name;if(typeof r!="string"||!r)throw lt.create("bad-app-name",{appName:String(r)});if(t||(t=Mc()),!t)throw lt.create("no-options");const i=Yo.get(r);if(i){if(jo(t,i.options)&&jo(o,i.config))return i;throw lt.create("duplicate-app",{appName:r})}const a=new Jd(r);for(const h of Ss.values())a.addComponent(h);const c=new Gm(t,o,a);return Yo.set(r,c),c}function Qm(n=Rs){const e=Yo.get(n);if(!e&&n===Rs&&Mc())return qc();if(!e)throw lt.create("no-app",{appName:n});return e}function Wt(n,e,t){var o;let r=(o=jm[n])!==null&&o!==void 0?o:n;t&&(r+=`-${t}`);const i=r.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const c=[`Unable to register library "${r}" with version "${e}":`];i&&c.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&a&&c.push("and"),a&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Xe.warn(c.join(" "));return}zo(new Mn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xm="firebase-heartbeat-database",Jm=1,Bn="firebase-heartbeat-store";let hs=null;function jc(){return hs||(hs=hm(Xm,Jm,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Bn)}catch(t){console.warn(t)}}}}).catch(n=>{throw lt.create("idb-open",{originalErrorMessage:n.message})})),hs}async function Zm(n){try{const t=(await jc()).transaction(Bn),o=await t.objectStore(Bn).get(Yc(n));return await t.done,o}catch(e){if(e instanceof on)Xe.warn(e.message);else{const t=lt.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Xe.warn(t.message)}}}async function al(n,e){try{const o=(await jc()).transaction(Bn,"readwrite");await o.objectStore(Bn).put(e,Yc(n)),await o.done}catch(t){if(t instanceof on)Xe.warn(t.message);else{const o=lt.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Xe.warn(o.message)}}}function Yc(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ef=1024,tf=30;class nf{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new rf(t),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,t;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=ll();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats.length>tf){const a=sf(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(o){Xe.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=ll(),{heartbeatsToSend:o,unsentEntries:r}=of(this._heartbeatsCache.heartbeats),i=qo(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Xe.warn(t),""}}}function ll(){return new Date().toISOString().substring(0,10)}function of(n,e=ef){const t=[];let o=n.slice();for(const r of n){const i=t.find(a=>a.agent===r.agent);if(i){if(i.dates.push(r.date),cl(t)>e){i.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),cl(t)>e){t.pop();break}o=o.slice(1)}return{heartbeatsToSend:t,unsentEntries:o}}class rf{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Yd()?zd().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Zm(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return al(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const r=await this.read();return al(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function cl(n){return qo(JSON.stringify({version:2,heartbeats:n})).length}function sf(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let o=1;o<n.length;o++)n[o].date<t&&(t=n[o].date,e=o);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function af(n){zo(new Mn("platform-logger",e=>new fm(e),"PRIVATE")),zo(new Mn("heartbeat",e=>new nf(e),"PRIVATE")),Wt(Cs,sl,n),Wt(Cs,sl,"esm2017"),Wt("fire-js","")}af("");var lf="firebase",cf="11.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Wt(lf,cf,"app");var ul=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ct,zc;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(T,p){function w(){}w.prototype=p.prototype,T.D=p.prototype,T.prototype=new w,T.prototype.constructor=T,T.C=function(v,b,I){for(var _=Array(arguments.length-2),Be=2;Be<arguments.length;Be++)_[Be-2]=arguments[Be];return p.prototype[b].apply(v,_)}}function t(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,t),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(T,p,w){w||(w=0);var v=Array(16);if(typeof p=="string")for(var b=0;16>b;++b)v[b]=p.charCodeAt(w++)|p.charCodeAt(w++)<<8|p.charCodeAt(w++)<<16|p.charCodeAt(w++)<<24;else for(b=0;16>b;++b)v[b]=p[w++]|p[w++]<<8|p[w++]<<16|p[w++]<<24;p=T.g[0],w=T.g[1],b=T.g[2];var I=T.g[3],_=p+(I^w&(b^I))+v[0]+3614090360&4294967295;p=w+(_<<7&4294967295|_>>>25),_=I+(b^p&(w^b))+v[1]+3905402710&4294967295,I=p+(_<<12&4294967295|_>>>20),_=b+(w^I&(p^w))+v[2]+606105819&4294967295,b=I+(_<<17&4294967295|_>>>15),_=w+(p^b&(I^p))+v[3]+3250441966&4294967295,w=b+(_<<22&4294967295|_>>>10),_=p+(I^w&(b^I))+v[4]+4118548399&4294967295,p=w+(_<<7&4294967295|_>>>25),_=I+(b^p&(w^b))+v[5]+1200080426&4294967295,I=p+(_<<12&4294967295|_>>>20),_=b+(w^I&(p^w))+v[6]+2821735955&4294967295,b=I+(_<<17&4294967295|_>>>15),_=w+(p^b&(I^p))+v[7]+4249261313&4294967295,w=b+(_<<22&4294967295|_>>>10),_=p+(I^w&(b^I))+v[8]+1770035416&4294967295,p=w+(_<<7&4294967295|_>>>25),_=I+(b^p&(w^b))+v[9]+2336552879&4294967295,I=p+(_<<12&4294967295|_>>>20),_=b+(w^I&(p^w))+v[10]+4294925233&4294967295,b=I+(_<<17&4294967295|_>>>15),_=w+(p^b&(I^p))+v[11]+2304563134&4294967295,w=b+(_<<22&4294967295|_>>>10),_=p+(I^w&(b^I))+v[12]+1804603682&4294967295,p=w+(_<<7&4294967295|_>>>25),_=I+(b^p&(w^b))+v[13]+4254626195&4294967295,I=p+(_<<12&4294967295|_>>>20),_=b+(w^I&(p^w))+v[14]+2792965006&4294967295,b=I+(_<<17&4294967295|_>>>15),_=w+(p^b&(I^p))+v[15]+1236535329&4294967295,w=b+(_<<22&4294967295|_>>>10),_=p+(b^I&(w^b))+v[1]+4129170786&4294967295,p=w+(_<<5&4294967295|_>>>27),_=I+(w^b&(p^w))+v[6]+3225465664&4294967295,I=p+(_<<9&4294967295|_>>>23),_=b+(p^w&(I^p))+v[11]+643717713&4294967295,b=I+(_<<14&4294967295|_>>>18),_=w+(I^p&(b^I))+v[0]+3921069994&4294967295,w=b+(_<<20&4294967295|_>>>12),_=p+(b^I&(w^b))+v[5]+3593408605&4294967295,p=w+(_<<5&4294967295|_>>>27),_=I+(w^b&(p^w))+v[10]+38016083&4294967295,I=p+(_<<9&4294967295|_>>>23),_=b+(p^w&(I^p))+v[15]+3634488961&4294967295,b=I+(_<<14&4294967295|_>>>18),_=w+(I^p&(b^I))+v[4]+3889429448&4294967295,w=b+(_<<20&4294967295|_>>>12),_=p+(b^I&(w^b))+v[9]+568446438&4294967295,p=w+(_<<5&4294967295|_>>>27),_=I+(w^b&(p^w))+v[14]+3275163606&4294967295,I=p+(_<<9&4294967295|_>>>23),_=b+(p^w&(I^p))+v[3]+4107603335&4294967295,b=I+(_<<14&4294967295|_>>>18),_=w+(I^p&(b^I))+v[8]+1163531501&4294967295,w=b+(_<<20&4294967295|_>>>12),_=p+(b^I&(w^b))+v[13]+2850285829&4294967295,p=w+(_<<5&4294967295|_>>>27),_=I+(w^b&(p^w))+v[2]+4243563512&4294967295,I=p+(_<<9&4294967295|_>>>23),_=b+(p^w&(I^p))+v[7]+1735328473&4294967295,b=I+(_<<14&4294967295|_>>>18),_=w+(I^p&(b^I))+v[12]+2368359562&4294967295,w=b+(_<<20&4294967295|_>>>12),_=p+(w^b^I)+v[5]+4294588738&4294967295,p=w+(_<<4&4294967295|_>>>28),_=I+(p^w^b)+v[8]+2272392833&4294967295,I=p+(_<<11&4294967295|_>>>21),_=b+(I^p^w)+v[11]+1839030562&4294967295,b=I+(_<<16&4294967295|_>>>16),_=w+(b^I^p)+v[14]+4259657740&4294967295,w=b+(_<<23&4294967295|_>>>9),_=p+(w^b^I)+v[1]+2763975236&4294967295,p=w+(_<<4&4294967295|_>>>28),_=I+(p^w^b)+v[4]+1272893353&4294967295,I=p+(_<<11&4294967295|_>>>21),_=b+(I^p^w)+v[7]+4139469664&4294967295,b=I+(_<<16&4294967295|_>>>16),_=w+(b^I^p)+v[10]+3200236656&4294967295,w=b+(_<<23&4294967295|_>>>9),_=p+(w^b^I)+v[13]+681279174&4294967295,p=w+(_<<4&4294967295|_>>>28),_=I+(p^w^b)+v[0]+3936430074&4294967295,I=p+(_<<11&4294967295|_>>>21),_=b+(I^p^w)+v[3]+3572445317&4294967295,b=I+(_<<16&4294967295|_>>>16),_=w+(b^I^p)+v[6]+76029189&4294967295,w=b+(_<<23&4294967295|_>>>9),_=p+(w^b^I)+v[9]+3654602809&4294967295,p=w+(_<<4&4294967295|_>>>28),_=I+(p^w^b)+v[12]+3873151461&4294967295,I=p+(_<<11&4294967295|_>>>21),_=b+(I^p^w)+v[15]+530742520&4294967295,b=I+(_<<16&4294967295|_>>>16),_=w+(b^I^p)+v[2]+3299628645&4294967295,w=b+(_<<23&4294967295|_>>>9),_=p+(b^(w|~I))+v[0]+4096336452&4294967295,p=w+(_<<6&4294967295|_>>>26),_=I+(w^(p|~b))+v[7]+1126891415&4294967295,I=p+(_<<10&4294967295|_>>>22),_=b+(p^(I|~w))+v[14]+2878612391&4294967295,b=I+(_<<15&4294967295|_>>>17),_=w+(I^(b|~p))+v[5]+4237533241&4294967295,w=b+(_<<21&4294967295|_>>>11),_=p+(b^(w|~I))+v[12]+1700485571&4294967295,p=w+(_<<6&4294967295|_>>>26),_=I+(w^(p|~b))+v[3]+2399980690&4294967295,I=p+(_<<10&4294967295|_>>>22),_=b+(p^(I|~w))+v[10]+4293915773&4294967295,b=I+(_<<15&4294967295|_>>>17),_=w+(I^(b|~p))+v[1]+2240044497&4294967295,w=b+(_<<21&4294967295|_>>>11),_=p+(b^(w|~I))+v[8]+1873313359&4294967295,p=w+(_<<6&4294967295|_>>>26),_=I+(w^(p|~b))+v[15]+4264355552&4294967295,I=p+(_<<10&4294967295|_>>>22),_=b+(p^(I|~w))+v[6]+2734768916&4294967295,b=I+(_<<15&4294967295|_>>>17),_=w+(I^(b|~p))+v[13]+1309151649&4294967295,w=b+(_<<21&4294967295|_>>>11),_=p+(b^(w|~I))+v[4]+4149444226&4294967295,p=w+(_<<6&4294967295|_>>>26),_=I+(w^(p|~b))+v[11]+3174756917&4294967295,I=p+(_<<10&4294967295|_>>>22),_=b+(p^(I|~w))+v[2]+718787259&4294967295,b=I+(_<<15&4294967295|_>>>17),_=w+(I^(b|~p))+v[9]+3951481745&4294967295,T.g[0]=T.g[0]+p&4294967295,T.g[1]=T.g[1]+(b+(_<<21&4294967295|_>>>11))&4294967295,T.g[2]=T.g[2]+b&4294967295,T.g[3]=T.g[3]+I&4294967295}o.prototype.u=function(T,p){p===void 0&&(p=T.length);for(var w=p-this.blockSize,v=this.B,b=this.h,I=0;I<p;){if(b==0)for(;I<=w;)r(this,T,I),I+=this.blockSize;if(typeof T=="string"){for(;I<p;)if(v[b++]=T.charCodeAt(I++),b==this.blockSize){r(this,v),b=0;break}}else for(;I<p;)if(v[b++]=T[I++],b==this.blockSize){r(this,v),b=0;break}}this.h=b,this.o+=p},o.prototype.v=function(){var T=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);T[0]=128;for(var p=1;p<T.length-8;++p)T[p]=0;var w=8*this.o;for(p=T.length-8;p<T.length;++p)T[p]=w&255,w/=256;for(this.u(T),T=Array(16),p=w=0;4>p;++p)for(var v=0;32>v;v+=8)T[w++]=this.g[p]>>>v&255;return T};function i(T,p){var w=c;return Object.prototype.hasOwnProperty.call(w,T)?w[T]:w[T]=p(T)}function a(T,p){this.h=p;for(var w=[],v=!0,b=T.length-1;0<=b;b--){var I=T[b]|0;v&&I==p||(w[b]=I,v=!1)}this.g=w}var c={};function h(T){return-128<=T&&128>T?i(T,function(p){return new a([p|0],0>p?-1:0)}):new a([T|0],0>T?-1:0)}function d(T){if(isNaN(T)||!isFinite(T))return g;if(0>T)return k(d(-T));for(var p=[],w=1,v=0;T>=w;v++)p[v]=T/w|0,w*=4294967296;return new a(p,0)}function f(T,p){if(T.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(T.charAt(0)=="-")return k(f(T.substring(1),p));if(0<=T.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=d(Math.pow(p,8)),v=g,b=0;b<T.length;b+=8){var I=Math.min(8,T.length-b),_=parseInt(T.substring(b,b+I),p);8>I?(I=d(Math.pow(p,I)),v=v.j(I).add(d(_))):(v=v.j(w),v=v.add(d(_)))}return v}var g=h(0),y=h(1),A=h(16777216);n=a.prototype,n.m=function(){if(V(this))return-k(this).m();for(var T=0,p=1,w=0;w<this.g.length;w++){var v=this.i(w);T+=(0<=v?v:4294967296+v)*p,p*=4294967296}return T},n.toString=function(T){if(T=T||10,2>T||36<T)throw Error("radix out of range: "+T);if(P(this))return"0";if(V(this))return"-"+k(this).toString(T);for(var p=d(Math.pow(T,6)),w=this,v="";;){var b=J(w,p).g;w=U(w,b.j(p));var I=((0<w.g.length?w.g[0]:w.h)>>>0).toString(T);if(w=b,P(w))return I+v;for(;6>I.length;)I="0"+I;v=I+v}},n.i=function(T){return 0>T?0:T<this.g.length?this.g[T]:this.h};function P(T){if(T.h!=0)return!1;for(var p=0;p<T.g.length;p++)if(T.g[p]!=0)return!1;return!0}function V(T){return T.h==-1}n.l=function(T){return T=U(this,T),V(T)?-1:P(T)?0:1};function k(T){for(var p=T.g.length,w=[],v=0;v<p;v++)w[v]=~T.g[v];return new a(w,~T.h).add(y)}n.abs=function(){return V(this)?k(this):this},n.add=function(T){for(var p=Math.max(this.g.length,T.g.length),w=[],v=0,b=0;b<=p;b++){var I=v+(this.i(b)&65535)+(T.i(b)&65535),_=(I>>>16)+(this.i(b)>>>16)+(T.i(b)>>>16);v=_>>>16,I&=65535,_&=65535,w[b]=_<<16|I}return new a(w,w[w.length-1]&-2147483648?-1:0)};function U(T,p){return T.add(k(p))}n.j=function(T){if(P(this)||P(T))return g;if(V(this))return V(T)?k(this).j(k(T)):k(k(this).j(T));if(V(T))return k(this.j(k(T)));if(0>this.l(A)&&0>T.l(A))return d(this.m()*T.m());for(var p=this.g.length+T.g.length,w=[],v=0;v<2*p;v++)w[v]=0;for(v=0;v<this.g.length;v++)for(var b=0;b<T.g.length;b++){var I=this.i(v)>>>16,_=this.i(v)&65535,Be=T.i(b)>>>16,Bt=T.i(b)&65535;w[2*v+2*b]+=_*Bt,B(w,2*v+2*b),w[2*v+2*b+1]+=I*Bt,B(w,2*v+2*b+1),w[2*v+2*b+1]+=_*Be,B(w,2*v+2*b+1),w[2*v+2*b+2]+=I*Be,B(w,2*v+2*b+2)}for(v=0;v<p;v++)w[v]=w[2*v+1]<<16|w[2*v];for(v=p;v<2*p;v++)w[v]=0;return new a(w,0)};function B(T,p){for(;(T[p]&65535)!=T[p];)T[p+1]+=T[p]>>>16,T[p]&=65535,p++}function $(T,p){this.g=T,this.h=p}function J(T,p){if(P(p))throw Error("division by zero");if(P(T))return new $(g,g);if(V(T))return p=J(k(T),p),new $(k(p.g),k(p.h));if(V(p))return p=J(T,k(p)),new $(k(p.g),p.h);if(30<T.g.length){if(V(T)||V(p))throw Error("slowDivide_ only works with positive integers.");for(var w=y,v=p;0>=v.l(T);)w=Se(w),v=Se(v);var b=ne(w,1),I=ne(v,1);for(v=ne(v,2),w=ne(w,2);!P(v);){var _=I.add(v);0>=_.l(T)&&(b=b.add(w),I=_),v=ne(v,1),w=ne(w,1)}return p=U(T,b.j(p)),new $(b,p)}for(b=g;0<=T.l(p);){for(w=Math.max(1,Math.floor(T.m()/p.m())),v=Math.ceil(Math.log(w)/Math.LN2),v=48>=v?1:Math.pow(2,v-48),I=d(w),_=I.j(p);V(_)||0<_.l(T);)w-=v,I=d(w),_=I.j(p);P(I)&&(I=y),b=b.add(I),T=U(T,_)}return new $(b,T)}n.A=function(T){return J(this,T).h},n.and=function(T){for(var p=Math.max(this.g.length,T.g.length),w=[],v=0;v<p;v++)w[v]=this.i(v)&T.i(v);return new a(w,this.h&T.h)},n.or=function(T){for(var p=Math.max(this.g.length,T.g.length),w=[],v=0;v<p;v++)w[v]=this.i(v)|T.i(v);return new a(w,this.h|T.h)},n.xor=function(T){for(var p=Math.max(this.g.length,T.g.length),w=[],v=0;v<p;v++)w[v]=this.i(v)^T.i(v);return new a(w,this.h^T.h)};function Se(T){for(var p=T.g.length+1,w=[],v=0;v<p;v++)w[v]=T.i(v)<<1|T.i(v-1)>>>31;return new a(w,T.h)}function ne(T,p){var w=p>>5;p%=32;for(var v=T.g.length-w,b=[],I=0;I<v;I++)b[I]=0<p?T.i(I+w)>>>p|T.i(I+w+1)<<32-p:T.i(I+w);return new a(b,T.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,zc=o,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,ct=a}).apply(typeof ul<"u"?ul:typeof self<"u"?self:typeof window<"u"?window:{});var Po=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Hc,Rn,Wc,xo,Ps,Gc,Kc,Qc;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(s,l,u){return s==Array.prototype||s==Object.prototype||(s[l]=u.value),s};function t(s){s=[typeof globalThis=="object"&&globalThis,s,typeof window=="object"&&window,typeof self=="object"&&self,typeof Po=="object"&&Po];for(var l=0;l<s.length;++l){var u=s[l];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var o=t(this);function r(s,l){if(l)e:{var u=o;s=s.split(".");for(var m=0;m<s.length-1;m++){var E=s[m];if(!(E in u))break e;u=u[E]}s=s[s.length-1],m=u[s],l=l(m),l!=m&&l!=null&&e(u,s,{configurable:!0,writable:!0,value:l})}}function i(s,l){s instanceof String&&(s+="");var u=0,m=!1,E={next:function(){if(!m&&u<s.length){var C=u++;return{value:l(C,s[C]),done:!1}}return m=!0,{done:!0,value:void 0}}};return E[Symbol.iterator]=function(){return E},E}r("Array.prototype.values",function(s){return s||function(){return i(this,function(l,u){return u})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},c=this||self;function h(s){var l=typeof s;return l=l!="object"?l:s?Array.isArray(s)?"array":l:"null",l=="array"||l=="object"&&typeof s.length=="number"}function d(s){var l=typeof s;return l=="object"&&s!=null||l=="function"}function f(s,l,u){return s.call.apply(s.bind,arguments)}function g(s,l,u){if(!s)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var E=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(E,m),s.apply(l,E)}}return function(){return s.apply(l,arguments)}}function y(s,l,u){return y=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,y.apply(null,arguments)}function A(s,l){var u=Array.prototype.slice.call(arguments,1);return function(){var m=u.slice();return m.push.apply(m,arguments),s.apply(this,m)}}function P(s,l){function u(){}u.prototype=l.prototype,s.aa=l.prototype,s.prototype=new u,s.prototype.constructor=s,s.Qb=function(m,E,C){for(var D=Array(arguments.length-2),K=2;K<arguments.length;K++)D[K-2]=arguments[K];return l.prototype[E].apply(m,D)}}function V(s){const l=s.length;if(0<l){const u=Array(l);for(let m=0;m<l;m++)u[m]=s[m];return u}return[]}function k(s,l){for(let u=1;u<arguments.length;u++){const m=arguments[u];if(h(m)){const E=s.length||0,C=m.length||0;s.length=E+C;for(let D=0;D<C;D++)s[E+D]=m[D]}else s.push(m)}}class U{constructor(l,u){this.i=l,this.j=u,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function B(s){return/^[\s\xa0]*$/.test(s)}function $(){var s=c.navigator;return s&&(s=s.userAgent)?s:""}function J(s){return J[" "](s),s}J[" "]=function(){};var Se=$().indexOf("Gecko")!=-1&&!($().toLowerCase().indexOf("webkit")!=-1&&$().indexOf("Edge")==-1)&&!($().indexOf("Trident")!=-1||$().indexOf("MSIE")!=-1)&&$().indexOf("Edge")==-1;function ne(s,l,u){for(const m in s)l.call(u,s[m],m,s)}function T(s,l){for(const u in s)l.call(void 0,s[u],u,s)}function p(s){const l={};for(const u in s)l[u]=s[u];return l}const w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function v(s,l){let u,m;for(let E=1;E<arguments.length;E++){m=arguments[E];for(u in m)s[u]=m[u];for(let C=0;C<w.length;C++)u=w[C],Object.prototype.hasOwnProperty.call(m,u)&&(s[u]=m[u])}}function b(s){var l=1;s=s.split(":");const u=[];for(;0<l&&s.length;)u.push(s.shift()),l--;return s.length&&u.push(s.join(":")),u}function I(s){c.setTimeout(()=>{throw s},0)}function _(){var s=Pe;let l=null;return s.g&&(l=s.g,s.g=s.g.next,s.g||(s.h=null),l.next=null),l}class Be{constructor(){this.h=this.g=null}add(l,u){const m=Bt.get();m.set(l,u),this.h?this.h.next=m:this.g=m,this.h=m}}var Bt=new U(()=>new Lr,s=>s.reset());class Lr{constructor(){this.next=this.g=this.h=null}set(l,u){this.h=l,this.g=u,this.next=null}reset(){this.next=this.g=this.h=null}}let Et,It=!1,Pe=new Be,At=()=>{const s=c.Promise.resolve(void 0);Et=()=>{s.then(Mr)}};var Mr=()=>{for(var s;s=_();){try{s.h.call(s.g)}catch(u){I(u)}var l=Bt;l.j(s),100>l.h&&(l.h++,s.next=l.g,l.g=s)}It=!1};function Ne(){this.s=this.s,this.C=this.C}Ne.prototype.s=!1,Ne.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ne.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function se(s,l){this.type=s,this.g=this.target=l,this.defaultPrevented=!1}se.prototype.h=function(){this.defaultPrevented=!0};var Br=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var s=!1,l=Object.defineProperty({},"passive",{get:function(){s=!0}});try{const u=()=>{};c.addEventListener("test",u,l),c.removeEventListener("test",u,l)}catch{}return s}();function nt(s,l){if(se.call(this,s?s.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,s){var u=this.type=s.type,m=s.changedTouches&&s.changedTouches.length?s.changedTouches[0]:null;if(this.target=s.target||s.srcElement,this.g=l,l=s.relatedTarget){if(Se){e:{try{J(l.nodeName);var E=!0;break e}catch{}E=!1}E||(l=null)}}else u=="mouseover"?l=s.fromElement:u=="mouseout"&&(l=s.toElement);this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=s.clientX!==void 0?s.clientX:s.pageX,this.clientY=s.clientY!==void 0?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0),this.button=s.button,this.key=s.key||"",this.ctrlKey=s.ctrlKey,this.altKey=s.altKey,this.shiftKey=s.shiftKey,this.metaKey=s.metaKey,this.pointerId=s.pointerId||0,this.pointerType=typeof s.pointerType=="string"?s.pointerType:Hh[s.pointerType]||"",this.state=s.state,this.i=s,s.defaultPrevented&&nt.aa.h.call(this)}}P(nt,se);var Hh={2:"touch",3:"pen",4:"mouse"};nt.prototype.h=function(){nt.aa.h.call(this);var s=this.i;s.preventDefault?s.preventDefault():s.returnValue=!1};var co="closure_listenable_"+(1e6*Math.random()|0),Wh=0;function Gh(s,l,u,m,E){this.listener=s,this.proxy=null,this.src=l,this.type=u,this.capture=!!m,this.ha=E,this.key=++Wh,this.da=this.fa=!1}function uo(s){s.da=!0,s.listener=null,s.proxy=null,s.src=null,s.ha=null}function ho(s){this.src=s,this.g={},this.h=0}ho.prototype.add=function(s,l,u,m,E){var C=s.toString();s=this.g[C],s||(s=this.g[C]=[],this.h++);var D=Ur(s,l,m,E);return-1<D?(l=s[D],u||(l.fa=!1)):(l=new Gh(l,this.src,C,!!m,E),l.fa=u,s.push(l)),l};function Fr(s,l){var u=l.type;if(u in s.g){var m=s.g[u],E=Array.prototype.indexOf.call(m,l,void 0),C;(C=0<=E)&&Array.prototype.splice.call(m,E,1),C&&(uo(l),s.g[u].length==0&&(delete s.g[u],s.h--))}}function Ur(s,l,u,m){for(var E=0;E<s.length;++E){var C=s[E];if(!C.da&&C.listener==l&&C.capture==!!u&&C.ha==m)return E}return-1}var $r="closure_lm_"+(1e6*Math.random()|0),qr={};function ea(s,l,u,m,E){if(Array.isArray(l)){for(var C=0;C<l.length;C++)ea(s,l[C],u,m,E);return null}return u=oa(u),s&&s[co]?s.K(l,u,d(m)?!!m.capture:!1,E):Kh(s,l,u,!1,m,E)}function Kh(s,l,u,m,E,C){if(!l)throw Error("Invalid event type");var D=d(E)?!!E.capture:!!E,K=Yr(s);if(K||(s[$r]=K=new ho(s)),u=K.add(l,u,m,D,C),u.proxy)return u;if(m=Qh(),u.proxy=m,m.src=s,m.listener=u,s.addEventListener)Br||(E=D),E===void 0&&(E=!1),s.addEventListener(l.toString(),m,E);else if(s.attachEvent)s.attachEvent(na(l.toString()),m);else if(s.addListener&&s.removeListener)s.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return u}function Qh(){function s(u){return l.call(s.src,s.listener,u)}const l=Xh;return s}function ta(s,l,u,m,E){if(Array.isArray(l))for(var C=0;C<l.length;C++)ta(s,l[C],u,m,E);else m=d(m)?!!m.capture:!!m,u=oa(u),s&&s[co]?(s=s.i,l=String(l).toString(),l in s.g&&(C=s.g[l],u=Ur(C,u,m,E),-1<u&&(uo(C[u]),Array.prototype.splice.call(C,u,1),C.length==0&&(delete s.g[l],s.h--)))):s&&(s=Yr(s))&&(l=s.g[l.toString()],s=-1,l&&(s=Ur(l,u,m,E)),(u=-1<s?l[s]:null)&&jr(u))}function jr(s){if(typeof s!="number"&&s&&!s.da){var l=s.src;if(l&&l[co])Fr(l.i,s);else{var u=s.type,m=s.proxy;l.removeEventListener?l.removeEventListener(u,m,s.capture):l.detachEvent?l.detachEvent(na(u),m):l.addListener&&l.removeListener&&l.removeListener(m),(u=Yr(l))?(Fr(u,s),u.h==0&&(u.src=null,l[$r]=null)):uo(s)}}}function na(s){return s in qr?qr[s]:qr[s]="on"+s}function Xh(s,l){if(s.da)s=!0;else{l=new nt(l,this);var u=s.listener,m=s.ha||s.src;s.fa&&jr(s),s=u.call(m,l)}return s}function Yr(s){return s=s[$r],s instanceof ho?s:null}var zr="__closure_events_fn_"+(1e9*Math.random()>>>0);function oa(s){return typeof s=="function"?s:(s[zr]||(s[zr]=function(l){return s.handleEvent(l)}),s[zr])}function me(){Ne.call(this),this.i=new ho(this),this.M=this,this.F=null}P(me,Ne),me.prototype[co]=!0,me.prototype.removeEventListener=function(s,l,u,m){ta(this,s,l,u,m)};function ve(s,l){var u,m=s.F;if(m)for(u=[];m;m=m.F)u.push(m);if(s=s.M,m=l.type||l,typeof l=="string")l=new se(l,s);else if(l instanceof se)l.target=l.target||s;else{var E=l;l=new se(m,s),v(l,E)}if(E=!0,u)for(var C=u.length-1;0<=C;C--){var D=l.g=u[C];E=mo(D,m,!0,l)&&E}if(D=l.g=s,E=mo(D,m,!0,l)&&E,E=mo(D,m,!1,l)&&E,u)for(C=0;C<u.length;C++)D=l.g=u[C],E=mo(D,m,!1,l)&&E}me.prototype.N=function(){if(me.aa.N.call(this),this.i){var s=this.i,l;for(l in s.g){for(var u=s.g[l],m=0;m<u.length;m++)uo(u[m]);delete s.g[l],s.h--}}this.F=null},me.prototype.K=function(s,l,u,m){return this.i.add(String(s),l,!1,u,m)},me.prototype.L=function(s,l,u,m){return this.i.add(String(s),l,!0,u,m)};function mo(s,l,u,m){if(l=s.i.g[String(l)],!l)return!0;l=l.concat();for(var E=!0,C=0;C<l.length;++C){var D=l[C];if(D&&!D.da&&D.capture==u){var K=D.listener,ce=D.ha||D.src;D.fa&&Fr(s.i,D),E=K.call(ce,m)!==!1&&E}}return E&&!m.defaultPrevented}function ra(s,l,u){if(typeof s=="function")u&&(s=y(s,u));else if(s&&typeof s.handleEvent=="function")s=y(s.handleEvent,s);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:c.setTimeout(s,l||0)}function sa(s){s.g=ra(()=>{s.g=null,s.i&&(s.i=!1,sa(s))},s.l);const l=s.h;s.h=null,s.m.apply(null,l)}class Jh extends Ne{constructor(l,u){super(),this.m=l,this.l=u,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:sa(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function dn(s){Ne.call(this),this.h=s,this.g={}}P(dn,Ne);var ia=[];function aa(s){ne(s.g,function(l,u){this.g.hasOwnProperty(u)&&jr(l)},s),s.g={}}dn.prototype.N=function(){dn.aa.N.call(this),aa(this)},dn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Hr=c.JSON.stringify,Zh=c.JSON.parse,ed=class{stringify(s){return c.JSON.stringify(s,void 0)}parse(s){return c.JSON.parse(s,void 0)}};function Wr(){}Wr.prototype.h=null;function la(s){return s.h||(s.h=s.i())}function ca(){}var mn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Gr(){se.call(this,"d")}P(Gr,se);function Kr(){se.call(this,"c")}P(Kr,se);var Ct={},ua=null;function fo(){return ua=ua||new me}Ct.La="serverreachability";function ha(s){se.call(this,Ct.La,s)}P(ha,se);function fn(s){const l=fo();ve(l,new ha(l))}Ct.STAT_EVENT="statevent";function da(s,l){se.call(this,Ct.STAT_EVENT,s),this.stat=l}P(da,se);function be(s){const l=fo();ve(l,new da(l,s))}Ct.Ma="timingevent";function ma(s,l){se.call(this,Ct.Ma,s),this.size=l}P(ma,se);function gn(s,l){if(typeof s!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){s()},l)}function pn(){this.g=!0}pn.prototype.xa=function(){this.g=!1};function td(s,l,u,m,E,C){s.info(function(){if(s.g)if(C)for(var D="",K=C.split("&"),ce=0;ce<K.length;ce++){var H=K[ce].split("=");if(1<H.length){var fe=H[0];H=H[1];var ge=fe.split("_");D=2<=ge.length&&ge[1]=="type"?D+(fe+"="+H+"&"):D+(fe+"=redacted&")}}else D=null;else D=C;return"XMLHTTP REQ ("+m+") [attempt "+E+"]: "+l+`
`+u+`
`+D})}function nd(s,l,u,m,E,C,D){s.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+E+"]: "+l+`
`+u+`
`+C+" "+D})}function Ft(s,l,u,m){s.info(function(){return"XMLHTTP TEXT ("+l+"): "+rd(s,u)+(m?" "+m:"")})}function od(s,l){s.info(function(){return"TIMEOUT: "+l})}pn.prototype.info=function(){};function rd(s,l){if(!s.g)return l;if(!l)return null;try{var u=JSON.parse(l);if(u){for(s=0;s<u.length;s++)if(Array.isArray(u[s])){var m=u[s];if(!(2>m.length)){var E=m[1];if(Array.isArray(E)&&!(1>E.length)){var C=E[0];if(C!="noop"&&C!="stop"&&C!="close")for(var D=1;D<E.length;D++)E[D]=""}}}}return Hr(u)}catch{return l}}var go={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},fa={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Qr;function po(){}P(po,Wr),po.prototype.g=function(){return new XMLHttpRequest},po.prototype.i=function(){return{}},Qr=new po;function ot(s,l,u,m){this.j=s,this.i=l,this.l=u,this.R=m||1,this.U=new dn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ga}function ga(){this.i=null,this.g="",this.h=!1}var pa={},Xr={};function Jr(s,l,u){s.L=1,s.v=vo(He(l)),s.m=u,s.P=!0,ya(s,null)}function ya(s,l){s.F=Date.now(),yo(s),s.A=He(s.v);var u=s.A,m=s.R;Array.isArray(m)||(m=[String(m)]),Va(u.i,"t",m),s.C=0,u=s.j.J,s.h=new ga,s.g=Ka(s.j,u?l:null,!s.m),0<s.O&&(s.M=new Jh(y(s.Y,s,s.g),s.O)),l=s.U,u=s.g,m=s.ca;var E="readystatechange";Array.isArray(E)||(E&&(ia[0]=E.toString()),E=ia);for(var C=0;C<E.length;C++){var D=ea(u,E[C],m||l.handleEvent,!1,l.h||l);if(!D)break;l.g[D.key]=D}l=s.H?p(s.H):{},s.m?(s.u||(s.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",s.g.ea(s.A,s.u,s.m,l)):(s.u="GET",s.g.ea(s.A,s.u,null,l)),fn(),td(s.i,s.u,s.A,s.l,s.R,s.m)}ot.prototype.ca=function(s){s=s.target;const l=this.M;l&&We(s)==3?l.j():this.Y(s)},ot.prototype.Y=function(s){try{if(s==this.g)e:{const ge=We(this.g);var l=this.g.Ba();const qt=this.g.Z();if(!(3>ge)&&(ge!=3||this.g&&(this.h.h||this.g.oa()||Ba(this.g)))){this.J||ge!=4||l==7||(l==8||0>=qt?fn(3):fn(2)),Zr(this);var u=this.g.Z();this.X=u;t:if(wa(this)){var m=Ba(this.g);s="";var E=m.length,C=We(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Rt(this),yn(this);var D="";break t}this.h.i=new c.TextDecoder}for(l=0;l<E;l++)this.h.h=!0,s+=this.h.i.decode(m[l],{stream:!(C&&l==E-1)});m.length=0,this.h.g+=s,this.C=0,D=this.h.g}else D=this.g.oa();if(this.o=u==200,nd(this.i,this.u,this.A,this.l,this.R,ge,u),this.o){if(this.T&&!this.K){t:{if(this.g){var K,ce=this.g;if((K=ce.g?ce.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(K)){var H=K;break t}}H=null}if(u=H)Ft(this.i,this.l,u,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,es(this,u);else{this.o=!1,this.s=3,be(12),Rt(this),yn(this);break e}}if(this.P){u=!0;let xe;for(;!this.J&&this.C<D.length;)if(xe=sd(this,D),xe==Xr){ge==4&&(this.s=4,be(14),u=!1),Ft(this.i,this.l,null,"[Incomplete Response]");break}else if(xe==pa){this.s=4,be(15),Ft(this.i,this.l,D,"[Invalid Chunk]"),u=!1;break}else Ft(this.i,this.l,xe,null),es(this,xe);if(wa(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ge!=4||D.length!=0||this.h.h||(this.s=1,be(16),u=!1),this.o=this.o&&u,!u)Ft(this.i,this.l,D,"[Invalid Chunked Response]"),Rt(this),yn(this);else if(0<D.length&&!this.W){this.W=!0;var fe=this.j;fe.g==this&&fe.ba&&!fe.M&&(fe.j.info("Great, no buffering proxy detected. Bytes received: "+D.length),is(fe),fe.M=!0,be(11))}}else Ft(this.i,this.l,D,null),es(this,D);ge==4&&Rt(this),this.o&&!this.J&&(ge==4?za(this.j,this):(this.o=!1,yo(this)))}else Td(this.g),u==400&&0<D.indexOf("Unknown SID")?(this.s=3,be(12)):(this.s=0,be(13)),Rt(this),yn(this)}}}catch{}finally{}};function wa(s){return s.g?s.u=="GET"&&s.L!=2&&s.j.Ca:!1}function sd(s,l){var u=s.C,m=l.indexOf(`
`,u);return m==-1?Xr:(u=Number(l.substring(u,m)),isNaN(u)?pa:(m+=1,m+u>l.length?Xr:(l=l.slice(m,m+u),s.C=m+u,l)))}ot.prototype.cancel=function(){this.J=!0,Rt(this)};function yo(s){s.S=Date.now()+s.I,_a(s,s.I)}function _a(s,l){if(s.B!=null)throw Error("WatchDog timer not null");s.B=gn(y(s.ba,s),l)}function Zr(s){s.B&&(c.clearTimeout(s.B),s.B=null)}ot.prototype.ba=function(){this.B=null;const s=Date.now();0<=s-this.S?(od(this.i,this.A),this.L!=2&&(fn(),be(17)),Rt(this),this.s=2,yn(this)):_a(this,this.S-s)};function yn(s){s.j.G==0||s.J||za(s.j,s)}function Rt(s){Zr(s);var l=s.M;l&&typeof l.ma=="function"&&l.ma(),s.M=null,aa(s.U),s.g&&(l=s.g,s.g=null,l.abort(),l.ma())}function es(s,l){try{var u=s.j;if(u.G!=0&&(u.g==s||ts(u.h,s))){if(!s.K&&ts(u.h,s)&&u.G==3){try{var m=u.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var E=m;if(E[0]==0){e:if(!u.u){if(u.g)if(u.g.F+3e3<s.F)Co(u),Io(u);else break e;ss(u),be(18)}}else u.za=E[1],0<u.za-u.T&&37500>E[2]&&u.F&&u.v==0&&!u.C&&(u.C=gn(y(u.Za,u),6e3));if(1>=Ta(u.h)&&u.ca){try{u.ca()}catch{}u.ca=void 0}}else Pt(u,11)}else if((s.K||u.g==s)&&Co(u),!B(l))for(E=u.Da.g.parse(l),l=0;l<E.length;l++){let H=E[l];if(u.T=H[0],H=H[1],u.G==2)if(H[0]=="c"){u.K=H[1],u.ia=H[2];const fe=H[3];fe!=null&&(u.la=fe,u.j.info("VER="+u.la));const ge=H[4];ge!=null&&(u.Aa=ge,u.j.info("SVER="+u.Aa));const qt=H[5];qt!=null&&typeof qt=="number"&&0<qt&&(m=1.5*qt,u.L=m,u.j.info("backChannelRequestTimeoutMs_="+m)),m=u;const xe=s.g;if(xe){const So=xe.g?xe.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(So){var C=m.h;C.g||So.indexOf("spdy")==-1&&So.indexOf("quic")==-1&&So.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(ns(C,C.h),C.h=null))}if(m.D){const as=xe.g?xe.g.getResponseHeader("X-HTTP-Session-Id"):null;as&&(m.ya=as,Q(m.I,m.D,as))}}u.G=3,u.l&&u.l.ua(),u.ba&&(u.R=Date.now()-s.F,u.j.info("Handshake RTT: "+u.R+"ms")),m=u;var D=s;if(m.qa=Ga(m,m.J?m.ia:null,m.W),D.K){Ea(m.h,D);var K=D,ce=m.L;ce&&(K.I=ce),K.B&&(Zr(K),yo(K)),m.g=D}else ja(m);0<u.i.length&&Ao(u)}else H[0]!="stop"&&H[0]!="close"||Pt(u,7);else u.G==3&&(H[0]=="stop"||H[0]=="close"?H[0]=="stop"?Pt(u,7):rs(u):H[0]!="noop"&&u.l&&u.l.ta(H),u.v=0)}}fn(4)}catch{}}var id=class{constructor(s,l){this.g=s,this.map=l}};function va(s){this.l=s||10,c.PerformanceNavigationTiming?(s=c.performance.getEntriesByType("navigation"),s=0<s.length&&(s[0].nextHopProtocol=="hq"||s[0].nextHopProtocol=="h2")):s=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=s?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ba(s){return s.h?!0:s.g?s.g.size>=s.j:!1}function Ta(s){return s.h?1:s.g?s.g.size:0}function ts(s,l){return s.h?s.h==l:s.g?s.g.has(l):!1}function ns(s,l){s.g?s.g.add(l):s.h=l}function Ea(s,l){s.h&&s.h==l?s.h=null:s.g&&s.g.has(l)&&s.g.delete(l)}va.prototype.cancel=function(){if(this.i=Ia(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const s of this.g.values())s.cancel();this.g.clear()}};function Ia(s){if(s.h!=null)return s.i.concat(s.h.D);if(s.g!=null&&s.g.size!==0){let l=s.i;for(const u of s.g.values())l=l.concat(u.D);return l}return V(s.i)}function ad(s){if(s.V&&typeof s.V=="function")return s.V();if(typeof Map<"u"&&s instanceof Map||typeof Set<"u"&&s instanceof Set)return Array.from(s.values());if(typeof s=="string")return s.split("");if(h(s)){for(var l=[],u=s.length,m=0;m<u;m++)l.push(s[m]);return l}l=[],u=0;for(m in s)l[u++]=s[m];return l}function ld(s){if(s.na&&typeof s.na=="function")return s.na();if(!s.V||typeof s.V!="function"){if(typeof Map<"u"&&s instanceof Map)return Array.from(s.keys());if(!(typeof Set<"u"&&s instanceof Set)){if(h(s)||typeof s=="string"){var l=[];s=s.length;for(var u=0;u<s;u++)l.push(u);return l}l=[],u=0;for(const m in s)l[u++]=m;return l}}}function Aa(s,l){if(s.forEach&&typeof s.forEach=="function")s.forEach(l,void 0);else if(h(s)||typeof s=="string")Array.prototype.forEach.call(s,l,void 0);else for(var u=ld(s),m=ad(s),E=m.length,C=0;C<E;C++)l.call(void 0,m[C],u&&u[C],s)}var Ca=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function cd(s,l){if(s){s=s.split("&");for(var u=0;u<s.length;u++){var m=s[u].indexOf("="),E=null;if(0<=m){var C=s[u].substring(0,m);E=s[u].substring(m+1)}else C=s[u];l(C,E?decodeURIComponent(E.replace(/\+/g," ")):"")}}}function St(s){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,s instanceof St){this.h=s.h,wo(this,s.j),this.o=s.o,this.g=s.g,_o(this,s.s),this.l=s.l;var l=s.i,u=new vn;u.i=l.i,l.g&&(u.g=new Map(l.g),u.h=l.h),Ra(this,u),this.m=s.m}else s&&(l=String(s).match(Ca))?(this.h=!1,wo(this,l[1]||"",!0),this.o=wn(l[2]||""),this.g=wn(l[3]||"",!0),_o(this,l[4]),this.l=wn(l[5]||"",!0),Ra(this,l[6]||"",!0),this.m=wn(l[7]||"")):(this.h=!1,this.i=new vn(null,this.h))}St.prototype.toString=function(){var s=[],l=this.j;l&&s.push(_n(l,Sa,!0),":");var u=this.g;return(u||l=="file")&&(s.push("//"),(l=this.o)&&s.push(_n(l,Sa,!0),"@"),s.push(encodeURIComponent(String(u)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u=this.s,u!=null&&s.push(":",String(u))),(u=this.l)&&(this.g&&u.charAt(0)!="/"&&s.push("/"),s.push(_n(u,u.charAt(0)=="/"?dd:hd,!0))),(u=this.i.toString())&&s.push("?",u),(u=this.m)&&s.push("#",_n(u,fd)),s.join("")};function He(s){return new St(s)}function wo(s,l,u){s.j=u?wn(l,!0):l,s.j&&(s.j=s.j.replace(/:$/,""))}function _o(s,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);s.s=l}else s.s=null}function Ra(s,l,u){l instanceof vn?(s.i=l,gd(s.i,s.h)):(u||(l=_n(l,md)),s.i=new vn(l,s.h))}function Q(s,l,u){s.i.set(l,u)}function vo(s){return Q(s,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),s}function wn(s,l){return s?l?decodeURI(s.replace(/%25/g,"%2525")):decodeURIComponent(s):""}function _n(s,l,u){return typeof s=="string"?(s=encodeURI(s).replace(l,ud),u&&(s=s.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),s):null}function ud(s){return s=s.charCodeAt(0),"%"+(s>>4&15).toString(16)+(s&15).toString(16)}var Sa=/[#\/\?@]/g,hd=/[#\?:]/g,dd=/[#\?]/g,md=/[#\?@]/g,fd=/#/g;function vn(s,l){this.h=this.g=null,this.i=s||null,this.j=!!l}function rt(s){s.g||(s.g=new Map,s.h=0,s.i&&cd(s.i,function(l,u){s.add(decodeURIComponent(l.replace(/\+/g," ")),u)}))}n=vn.prototype,n.add=function(s,l){rt(this),this.i=null,s=Ut(this,s);var u=this.g.get(s);return u||this.g.set(s,u=[]),u.push(l),this.h+=1,this};function Pa(s,l){rt(s),l=Ut(s,l),s.g.has(l)&&(s.i=null,s.h-=s.g.get(l).length,s.g.delete(l))}function ka(s,l){return rt(s),l=Ut(s,l),s.g.has(l)}n.forEach=function(s,l){rt(this),this.g.forEach(function(u,m){u.forEach(function(E){s.call(l,E,m,this)},this)},this)},n.na=function(){rt(this);const s=Array.from(this.g.values()),l=Array.from(this.g.keys()),u=[];for(let m=0;m<l.length;m++){const E=s[m];for(let C=0;C<E.length;C++)u.push(l[m])}return u},n.V=function(s){rt(this);let l=[];if(typeof s=="string")ka(this,s)&&(l=l.concat(this.g.get(Ut(this,s))));else{s=Array.from(this.g.values());for(let u=0;u<s.length;u++)l=l.concat(s[u])}return l},n.set=function(s,l){return rt(this),this.i=null,s=Ut(this,s),ka(this,s)&&(this.h-=this.g.get(s).length),this.g.set(s,[l]),this.h+=1,this},n.get=function(s,l){return s?(s=this.V(s),0<s.length?String(s[0]):l):l};function Va(s,l,u){Pa(s,l),0<u.length&&(s.i=null,s.g.set(Ut(s,l),V(u)),s.h+=u.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const s=[],l=Array.from(this.g.keys());for(var u=0;u<l.length;u++){var m=l[u];const C=encodeURIComponent(String(m)),D=this.V(m);for(m=0;m<D.length;m++){var E=C;D[m]!==""&&(E+="="+encodeURIComponent(String(D[m]))),s.push(E)}}return this.i=s.join("&")};function Ut(s,l){return l=String(l),s.j&&(l=l.toLowerCase()),l}function gd(s,l){l&&!s.j&&(rt(s),s.i=null,s.g.forEach(function(u,m){var E=m.toLowerCase();m!=E&&(Pa(this,m),Va(this,E,u))},s)),s.j=l}function pd(s,l){const u=new pn;if(c.Image){const m=new Image;m.onload=A(st,u,"TestLoadImage: loaded",!0,l,m),m.onerror=A(st,u,"TestLoadImage: error",!1,l,m),m.onabort=A(st,u,"TestLoadImage: abort",!1,l,m),m.ontimeout=A(st,u,"TestLoadImage: timeout",!1,l,m),c.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=s}else l(!1)}function yd(s,l){const u=new pn,m=new AbortController,E=setTimeout(()=>{m.abort(),st(u,"TestPingServer: timeout",!1,l)},1e4);fetch(s,{signal:m.signal}).then(C=>{clearTimeout(E),C.ok?st(u,"TestPingServer: ok",!0,l):st(u,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(E),st(u,"TestPingServer: error",!1,l)})}function st(s,l,u,m,E){try{E&&(E.onload=null,E.onerror=null,E.onabort=null,E.ontimeout=null),m(u)}catch{}}function wd(){this.g=new ed}function _d(s,l,u){const m=u||"";try{Aa(s,function(E,C){let D=E;d(E)&&(D=Hr(E)),l.push(m+C+"="+encodeURIComponent(D))})}catch(E){throw l.push(m+"type="+encodeURIComponent("_badmap")),E}}function bo(s){this.l=s.Ub||null,this.j=s.eb||!1}P(bo,Wr),bo.prototype.g=function(){return new To(this.l,this.j)},bo.prototype.i=function(s){return function(){return s}}({});function To(s,l){me.call(this),this.D=s,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}P(To,me),n=To.prototype,n.open=function(s,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=s,this.A=l,this.readyState=1,Tn(this)},n.send=function(s){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};s&&(l.body=s),(this.D||c).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,bn(this)),this.readyState=0},n.Sa=function(s){if(this.g&&(this.l=s,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=s.headers,this.readyState=2,Tn(this)),this.g&&(this.readyState=3,Tn(this),this.g)))if(this.responseType==="arraybuffer")s.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in s){if(this.j=s.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Da(this)}else s.text().then(this.Ra.bind(this),this.ga.bind(this))};function Da(s){s.j.read().then(s.Pa.bind(s)).catch(s.ga.bind(s))}n.Pa=function(s){if(this.g){if(this.o&&s.value)this.response.push(s.value);else if(!this.o){var l=s.value?s.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!s.done}))&&(this.response=this.responseText+=l)}s.done?bn(this):Tn(this),this.readyState==3&&Da(this)}},n.Ra=function(s){this.g&&(this.response=this.responseText=s,bn(this))},n.Qa=function(s){this.g&&(this.response=s,bn(this))},n.ga=function(){this.g&&bn(this)};function bn(s){s.readyState=4,s.l=null,s.j=null,s.v=null,Tn(s)}n.setRequestHeader=function(s,l){this.u.append(s,l)},n.getResponseHeader=function(s){return this.h&&this.h.get(s.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const s=[],l=this.h.entries();for(var u=l.next();!u.done;)u=u.value,s.push(u[0]+": "+u[1]),u=l.next();return s.join(`\r
`)};function Tn(s){s.onreadystatechange&&s.onreadystatechange.call(s)}Object.defineProperty(To.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(s){this.m=s?"include":"same-origin"}});function Na(s){let l="";return ne(s,function(u,m){l+=m,l+=":",l+=u,l+=`\r
`}),l}function os(s,l,u){e:{for(m in u){var m=!1;break e}m=!0}m||(u=Na(u),typeof s=="string"?u!=null&&encodeURIComponent(String(u)):Q(s,l,u))}function ee(s){me.call(this),this.headers=new Map,this.o=s||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}P(ee,me);var vd=/^https?$/i,bd=["POST","PUT"];n=ee.prototype,n.Ha=function(s){this.J=s},n.ea=function(s,l,u,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+s);l=l?l.toUpperCase():"GET",this.D=s,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Qr.g(),this.v=this.o?la(this.o):la(Qr),this.g.onreadystatechange=y(this.Ea,this);try{this.B=!0,this.g.open(l,String(s),!0),this.B=!1}catch(C){xa(this,C);return}if(s=u||"",u=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var E in m)u.set(E,m[E]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(const C of m.keys())u.set(C,m.get(C));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(u.keys()).find(C=>C.toLowerCase()=="content-type"),E=c.FormData&&s instanceof c.FormData,!(0<=Array.prototype.indexOf.call(bd,l,void 0))||m||E||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[C,D]of u)this.g.setRequestHeader(C,D);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Ma(this),this.u=!0,this.g.send(s),this.u=!1}catch(C){xa(this,C)}};function xa(s,l){s.h=!1,s.g&&(s.j=!0,s.g.abort(),s.j=!1),s.l=l,s.m=5,Oa(s),Eo(s)}function Oa(s){s.A||(s.A=!0,ve(s,"complete"),ve(s,"error"))}n.abort=function(s){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=s||7,ve(this,"complete"),ve(this,"abort"),Eo(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Eo(this,!0)),ee.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?La(this):this.bb())},n.bb=function(){La(this)};function La(s){if(s.h&&typeof a<"u"&&(!s.v[1]||We(s)!=4||s.Z()!=2)){if(s.u&&We(s)==4)ra(s.Ea,0,s);else if(ve(s,"readystatechange"),We(s)==4){s.h=!1;try{const D=s.Z();e:switch(D){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var u;if(!(u=l)){var m;if(m=D===0){var E=String(s.D).match(Ca)[1]||null;!E&&c.self&&c.self.location&&(E=c.self.location.protocol.slice(0,-1)),m=!vd.test(E?E.toLowerCase():"")}u=m}if(u)ve(s,"complete"),ve(s,"success");else{s.m=6;try{var C=2<We(s)?s.g.statusText:""}catch{C=""}s.l=C+" ["+s.Z()+"]",Oa(s)}}finally{Eo(s)}}}}function Eo(s,l){if(s.g){Ma(s);const u=s.g,m=s.v[0]?()=>{}:null;s.g=null,s.v=null,l||ve(s,"ready");try{u.onreadystatechange=m}catch{}}}function Ma(s){s.I&&(c.clearTimeout(s.I),s.I=null)}n.isActive=function(){return!!this.g};function We(s){return s.g?s.g.readyState:0}n.Z=function(){try{return 2<We(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(s){if(this.g){var l=this.g.responseText;return s&&l.indexOf(s)==0&&(l=l.substring(s.length)),Zh(l)}};function Ba(s){try{if(!s.g)return null;if("response"in s.g)return s.g.response;switch(s.H){case"":case"text":return s.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in s.g)return s.g.mozResponseArrayBuffer}return null}catch{return null}}function Td(s){const l={};s=(s.g&&2<=We(s)&&s.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<s.length;m++){if(B(s[m]))continue;var u=b(s[m]);const E=u[0];if(u=u[1],typeof u!="string")continue;u=u.trim();const C=l[E]||[];l[E]=C,C.push(u)}T(l,function(m){return m.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function En(s,l,u){return u&&u.internalChannelParams&&u.internalChannelParams[s]||l}function Fa(s){this.Aa=0,this.i=[],this.j=new pn,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=En("failFast",!1,s),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=En("baseRetryDelayMs",5e3,s),this.cb=En("retryDelaySeedMs",1e4,s),this.Wa=En("forwardChannelMaxRetries",2,s),this.wa=En("forwardChannelRequestTimeoutMs",2e4,s),this.pa=s&&s.xmlHttpFactory||void 0,this.Xa=s&&s.Tb||void 0,this.Ca=s&&s.useFetchStreams||!1,this.L=void 0,this.J=s&&s.supportsCrossDomainXhr||!1,this.K="",this.h=new va(s&&s.concurrentRequestLimit),this.Da=new wd,this.P=s&&s.fastHandshake||!1,this.O=s&&s.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=s&&s.Rb||!1,s&&s.xa&&this.j.xa(),s&&s.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&s&&s.detectBufferingProxy||!1,this.ja=void 0,s&&s.longPollingTimeout&&0<s.longPollingTimeout&&(this.ja=s.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Fa.prototype,n.la=8,n.G=1,n.connect=function(s,l,u,m){be(0),this.W=s,this.H=l||{},u&&m!==void 0&&(this.H.OSID=u,this.H.OAID=m),this.F=this.X,this.I=Ga(this,null,this.W),Ao(this)};function rs(s){if(Ua(s),s.G==3){var l=s.U++,u=He(s.I);if(Q(u,"SID",s.K),Q(u,"RID",l),Q(u,"TYPE","terminate"),In(s,u),l=new ot(s,s.j,l),l.L=2,l.v=vo(He(u)),u=!1,c.navigator&&c.navigator.sendBeacon)try{u=c.navigator.sendBeacon(l.v.toString(),"")}catch{}!u&&c.Image&&(new Image().src=l.v,u=!0),u||(l.g=Ka(l.j,null),l.g.ea(l.v)),l.F=Date.now(),yo(l)}Wa(s)}function Io(s){s.g&&(is(s),s.g.cancel(),s.g=null)}function Ua(s){Io(s),s.u&&(c.clearTimeout(s.u),s.u=null),Co(s),s.h.cancel(),s.s&&(typeof s.s=="number"&&c.clearTimeout(s.s),s.s=null)}function Ao(s){if(!ba(s.h)&&!s.s){s.s=!0;var l=s.Ga;Et||At(),It||(Et(),It=!0),Pe.add(l,s),s.B=0}}function Ed(s,l){return Ta(s.h)>=s.h.j-(s.s?1:0)?!1:s.s?(s.i=l.D.concat(s.i),!0):s.G==1||s.G==2||s.B>=(s.Va?0:s.Wa)?!1:(s.s=gn(y(s.Ga,s,l),Ha(s,s.B)),s.B++,!0)}n.Ga=function(s){if(this.s)if(this.s=null,this.G==1){if(!s){this.U=Math.floor(1e5*Math.random()),s=this.U++;const E=new ot(this,this.j,s);let C=this.o;if(this.S&&(C?(C=p(C),v(C,this.S)):C=this.S),this.m!==null||this.O||(E.H=C,C=null),this.P)e:{for(var l=0,u=0;u<this.i.length;u++){t:{var m=this.i[u];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(l+=m,4096<l){l=u;break e}if(l===4096||u===this.i.length-1){l=u+1;break e}}l=1e3}else l=1e3;l=qa(this,E,l),u=He(this.I),Q(u,"RID",s),Q(u,"CVER",22),this.D&&Q(u,"X-HTTP-Session-Id",this.D),In(this,u),C&&(this.O?l="headers="+encodeURIComponent(String(Na(C)))+"&"+l:this.m&&os(u,this.m,C)),ns(this.h,E),this.Ua&&Q(u,"TYPE","init"),this.P?(Q(u,"$req",l),Q(u,"SID","null"),E.T=!0,Jr(E,u,null)):Jr(E,u,l),this.G=2}}else this.G==3&&(s?$a(this,s):this.i.length==0||ba(this.h)||$a(this))};function $a(s,l){var u;l?u=l.l:u=s.U++;const m=He(s.I);Q(m,"SID",s.K),Q(m,"RID",u),Q(m,"AID",s.T),In(s,m),s.m&&s.o&&os(m,s.m,s.o),u=new ot(s,s.j,u,s.B+1),s.m===null&&(u.H=s.o),l&&(s.i=l.D.concat(s.i)),l=qa(s,u,1e3),u.I=Math.round(.5*s.wa)+Math.round(.5*s.wa*Math.random()),ns(s.h,u),Jr(u,m,l)}function In(s,l){s.H&&ne(s.H,function(u,m){Q(l,m,u)}),s.l&&Aa({},function(u,m){Q(l,m,u)})}function qa(s,l,u){u=Math.min(s.i.length,u);var m=s.l?y(s.l.Na,s.l,s):null;e:{var E=s.i;let C=-1;for(;;){const D=["count="+u];C==-1?0<u?(C=E[0].g,D.push("ofs="+C)):C=0:D.push("ofs="+C);let K=!0;for(let ce=0;ce<u;ce++){let H=E[ce].g;const fe=E[ce].map;if(H-=C,0>H)C=Math.max(0,E[ce].g-100),K=!1;else try{_d(fe,D,"req"+H+"_")}catch{m&&m(fe)}}if(K){m=D.join("&");break e}}}return s=s.i.splice(0,u),l.D=s,m}function ja(s){if(!s.g&&!s.u){s.Y=1;var l=s.Fa;Et||At(),It||(Et(),It=!0),Pe.add(l,s),s.v=0}}function ss(s){return s.g||s.u||3<=s.v?!1:(s.Y++,s.u=gn(y(s.Fa,s),Ha(s,s.v)),s.v++,!0)}n.Fa=function(){if(this.u=null,Ya(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var s=2*this.R;this.j.info("BP detection timer enabled: "+s),this.A=gn(y(this.ab,this),s)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,be(10),Io(this),Ya(this))};function is(s){s.A!=null&&(c.clearTimeout(s.A),s.A=null)}function Ya(s){s.g=new ot(s,s.j,"rpc",s.Y),s.m===null&&(s.g.H=s.o),s.g.O=0;var l=He(s.qa);Q(l,"RID","rpc"),Q(l,"SID",s.K),Q(l,"AID",s.T),Q(l,"CI",s.F?"0":"1"),!s.F&&s.ja&&Q(l,"TO",s.ja),Q(l,"TYPE","xmlhttp"),In(s,l),s.m&&s.o&&os(l,s.m,s.o),s.L&&(s.g.I=s.L);var u=s.g;s=s.ia,u.L=1,u.v=vo(He(l)),u.m=null,u.P=!0,ya(u,s)}n.Za=function(){this.C!=null&&(this.C=null,Io(this),ss(this),be(19))};function Co(s){s.C!=null&&(c.clearTimeout(s.C),s.C=null)}function za(s,l){var u=null;if(s.g==l){Co(s),is(s),s.g=null;var m=2}else if(ts(s.h,l))u=l.D,Ea(s.h,l),m=1;else return;if(s.G!=0){if(l.o)if(m==1){u=l.m?l.m.length:0,l=Date.now()-l.F;var E=s.B;m=fo(),ve(m,new ma(m,u)),Ao(s)}else ja(s);else if(E=l.s,E==3||E==0&&0<l.X||!(m==1&&Ed(s,l)||m==2&&ss(s)))switch(u&&0<u.length&&(l=s.h,l.i=l.i.concat(u)),E){case 1:Pt(s,5);break;case 4:Pt(s,10);break;case 3:Pt(s,6);break;default:Pt(s,2)}}}function Ha(s,l){let u=s.Ta+Math.floor(Math.random()*s.cb);return s.isActive()||(u*=2),u*l}function Pt(s,l){if(s.j.info("Error code "+l),l==2){var u=y(s.fb,s),m=s.Xa;const E=!m;m=new St(m||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||wo(m,"https"),vo(m),E?pd(m.toString(),u):yd(m.toString(),u)}else be(2);s.G=0,s.l&&s.l.sa(l),Wa(s),Ua(s)}n.fb=function(s){s?(this.j.info("Successfully pinged google.com"),be(2)):(this.j.info("Failed to ping google.com"),be(1))};function Wa(s){if(s.G=0,s.ka=[],s.l){const l=Ia(s.h);(l.length!=0||s.i.length!=0)&&(k(s.ka,l),k(s.ka,s.i),s.h.i.length=0,V(s.i),s.i.length=0),s.l.ra()}}function Ga(s,l,u){var m=u instanceof St?He(u):new St(u);if(m.g!="")l&&(m.g=l+"."+m.g),_o(m,m.s);else{var E=c.location;m=E.protocol,l=l?l+"."+E.hostname:E.hostname,E=+E.port;var C=new St(null);m&&wo(C,m),l&&(C.g=l),E&&_o(C,E),u&&(C.l=u),m=C}return u=s.D,l=s.ya,u&&l&&Q(m,u,l),Q(m,"VER",s.la),In(s,m),m}function Ka(s,l,u){if(l&&!s.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=s.Ca&&!s.pa?new ee(new bo({eb:u})):new ee(s.pa),l.Ha(s.J),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Qa(){}n=Qa.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Ro(){}Ro.prototype.g=function(s,l){return new Ae(s,l)};function Ae(s,l){me.call(this),this.g=new Fa(l),this.l=s,this.h=l&&l.messageUrlParams||null,s=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(s?s["X-Client-Protocol"]="webchannel":s={"X-Client-Protocol":"webchannel"}),this.g.o=s,s=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(s?s["X-WebChannel-Content-Type"]=l.messageContentType:s={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(s?s["X-WebChannel-Client-Profile"]=l.va:s={"X-WebChannel-Client-Profile":l.va}),this.g.S=s,(s=l&&l.Sb)&&!B(s)&&(this.g.m=s),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!B(l)&&(this.g.D=l,s=this.h,s!==null&&l in s&&(s=this.h,l in s&&delete s[l])),this.j=new $t(this)}P(Ae,me),Ae.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ae.prototype.close=function(){rs(this.g)},Ae.prototype.o=function(s){var l=this.g;if(typeof s=="string"){var u={};u.__data__=s,s=u}else this.u&&(u={},u.__data__=Hr(s),s=u);l.i.push(new id(l.Ya++,s)),l.G==3&&Ao(l)},Ae.prototype.N=function(){this.g.l=null,delete this.j,rs(this.g),delete this.g,Ae.aa.N.call(this)};function Xa(s){Gr.call(this),s.__headers__&&(this.headers=s.__headers__,this.statusCode=s.__status__,delete s.__headers__,delete s.__status__);var l=s.__sm__;if(l){e:{for(const u in l){s=u;break e}s=void 0}(this.i=s)&&(s=this.i,l=l!==null&&s in l?l[s]:void 0),this.data=l}else this.data=s}P(Xa,Gr);function Ja(){Kr.call(this),this.status=1}P(Ja,Kr);function $t(s){this.g=s}P($t,Qa),$t.prototype.ua=function(){ve(this.g,"a")},$t.prototype.ta=function(s){ve(this.g,new Xa(s))},$t.prototype.sa=function(s){ve(this.g,new Ja)},$t.prototype.ra=function(){ve(this.g,"b")},Ro.prototype.createWebChannel=Ro.prototype.g,Ae.prototype.send=Ae.prototype.o,Ae.prototype.open=Ae.prototype.m,Ae.prototype.close=Ae.prototype.close,Qc=function(){return new Ro},Kc=function(){return fo()},Gc=Ct,Ps={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},go.NO_ERROR=0,go.TIMEOUT=8,go.HTTP_ERROR=6,xo=go,fa.COMPLETE="complete",Wc=fa,ca.EventType=mn,mn.OPEN="a",mn.CLOSE="b",mn.ERROR="c",mn.MESSAGE="d",me.prototype.listen=me.prototype.K,Rn=ca,ee.prototype.listenOnce=ee.prototype.L,ee.prototype.getLastError=ee.prototype.Ka,ee.prototype.getLastErrorCode=ee.prototype.Ba,ee.prototype.getStatus=ee.prototype.Z,ee.prototype.getResponseJson=ee.prototype.Oa,ee.prototype.getResponseText=ee.prototype.oa,ee.prototype.send=ee.prototype.ea,ee.prototype.setWithCredentials=ee.prototype.Ha,Hc=ee}).apply(typeof Po<"u"?Po:typeof self<"u"?self:typeof window<"u"?window:{});const hl="@firebase/firestore",dl="4.7.17";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ye{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ye.UNAUTHENTICATED=new ye(null),ye.GOOGLE_CREDENTIALS=new ye("google-credentials-uid"),ye.FIRST_PARTY=new ye("first-party-uid"),ye.MOCK_USER=new ye("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rn="11.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dt=new Fc("@firebase/firestore");function jt(){return Dt.logLevel}function N(n,...e){if(Dt.logLevel<=z.DEBUG){const t=e.map(oi);Dt.debug(`Firestore (${rn}): ${n}`,...t)}}function Je(n,...e){if(Dt.logLevel<=z.ERROR){const t=e.map(oi);Dt.error(`Firestore (${rn}): ${n}`,...t)}}function Kt(n,...e){if(Dt.logLevel<=z.WARN){const t=e.map(oi);Dt.warn(`Firestore (${rn}): ${n}`,...t)}}function oi(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L(n,e,t){let o="Unexpected state";typeof e=="string"?o=e:t=e,Xc(n,o,t)}function Xc(n,e,t){let o=`FIRESTORE (${rn}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{o+=" CONTEXT: "+JSON.stringify(t)}catch{o+=" CONTEXT: "+t}throw Je(o),new Error(o)}function G(n,e,t,o){let r="Unexpected state";typeof t=="string"?r=t:o=t,n||Xc(e,r,o)}function F(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class x extends on{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qe{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class uf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ye.UNAUTHENTICATED))}shutdown(){}}class hf{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class df{constructor(e){this.t=e,this.currentUser=ye.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){G(this.o===void 0,42304);let o=this.i;const r=h=>this.i!==o?(o=this.i,t(h)):Promise.resolve();let i=new Qe;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Qe,e.enqueueRetryable(()=>r(this.currentUser))};const a=()=>{const h=i;e.enqueueRetryable(async()=>{await h.promise,await r(this.currentUser)})},c=h=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Qe)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(o=>this.i!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(G(typeof o.accessToken=="string",31837,{l:o}),new Jc(o.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return G(e===null||typeof e=="string",2055,{h:e}),new ye(e)}}class mf{constructor(e,t,o){this.P=e,this.T=t,this.I=o,this.type="FirstParty",this.user=ye.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class ff{constructor(e,t,o){this.P=e,this.T=t,this.I=o}getToken(){return Promise.resolve(new mf(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ye.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class ml{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class gf{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Hm(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){G(this.o===void 0,3512);const o=i=>{i.error!=null&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,N("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>o(i))};const r=i=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>r(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?r(i):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new ml(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(G(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new ml(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pf(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let o=0;o<n;o++)t[o]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zc(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eu{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let o="";for(;o.length<20;){const r=pf(40);for(let i=0;i<r.length;++i)o.length<20&&r[i]<t&&(o+=e.charAt(r[i]%62))}return o}}function q(n,e){return n<e?-1:n>e?1:0}function ks(n,e){let t=0;for(;t<n.length&&t<e.length;){const o=n.codePointAt(t),r=e.codePointAt(t);if(o!==r){if(o<128&&r<128)return q(o,r);{const i=Zc(),a=yf(i.encode(fl(n,t)),i.encode(fl(e,t)));return a!==0?a:q(o,r)}}t+=o>65535?2:1}return q(n.length,e.length)}function fl(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function yf(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return q(n[t],e[t]);return q(n.length,e.length)}function Qt(n,e,t){return n.length===e.length&&n.every((o,r)=>t(o,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gl=-62135596800,pl=1e6;class ie{static now(){return ie.fromMillis(Date.now())}static fromDate(e){return ie.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),o=Math.floor((e-1e3*t)*pl);return new ie(t,o)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<gl)throw new x(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/pl}_compareTo(e){return this.seconds===e.seconds?q(this.nanoseconds,e.nanoseconds):q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-gl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M{static fromTimestamp(e){return new M(e)}static min(){return new M(new ie(0,0))}static max(){return new M(new ie(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yl="__name__";class Fe{constructor(e,t,o){t===void 0?t=0:t>e.length&&L(637,{offset:t,range:e.length}),o===void 0?o=e.length-t:o>e.length-t&&L(1746,{length:o,range:e.length-t}),this.segments=e,this.offset=t,this.len=o}get length(){return this.len}isEqual(e){return Fe.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Fe?e.forEach(o=>{t.push(o)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,o=this.limit();t<o;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const o=Math.min(e.length,t.length);for(let r=0;r<o;r++){const i=Fe.compareSegments(e.get(r),t.get(r));if(i!==0)return i}return q(e.length,t.length)}static compareSegments(e,t){const o=Fe.isNumericId(e),r=Fe.isNumericId(t);return o&&!r?-1:!o&&r?1:o&&r?Fe.extractNumericId(e).compare(Fe.extractNumericId(t)):ks(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ct.fromString(e.substring(4,e.length-2))}}class X extends Fe{construct(e,t,o){return new X(e,t,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const o of e){if(o.indexOf("//")>=0)throw new x(R.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);t.push(...o.split("/").filter(r=>r.length>0))}return new X(t)}static emptyPath(){return new X([])}}const wf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class he extends Fe{construct(e,t,o){return new he(e,t,o)}static isValidIdentifier(e){return wf.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),he.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===yl}static keyField(){return new he([yl])}static fromServerFormat(e){const t=[];let o="",r=0;const i=()=>{if(o.length===0)throw new x(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(o),o=""};let a=!1;for(;r<e.length;){const c=e[r];if(c==="\\"){if(r+1===e.length)throw new x(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[r+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new x(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=h,r+=2}else c==="`"?(a=!a,r++):c!=="."||a?(o+=c,r++):(i(),r++)}if(i(),a)throw new x(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new he(t)}static emptyPath(){return new he([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O{constructor(e){this.path=e}static fromPath(e){return new O(X.fromString(e))}static fromName(e){return new O(X.fromString(e).popFirst(5))}static empty(){return new O(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&X.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return X.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new O(new X(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fn=-1;function _f(n,e){const t=n.toTimestamp().seconds,o=n.toTimestamp().nanoseconds+1,r=M.fromTimestamp(o===1e9?new ie(t+1,0):new ie(t,o));return new ht(r,O.empty(),e)}function vf(n){return new ht(n.readTime,n.key,Fn)}class ht{constructor(e,t,o){this.readTime=e,this.documentKey=t,this.largestBatchId=o}static min(){return new ht(M.min(),O.empty(),Fn)}static max(){return new ht(M.max(),O.empty(),Fn)}}function bf(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=O.comparator(n.documentKey,e.documentKey),t!==0?t:q(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ef{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sn(n){if(n.code!==R.FAILED_PRECONDITION||n.message!==Tf)throw n;N("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new S((o,r)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(o,r)},this.catchCallback=i=>{this.wrapFailure(t,i).next(o,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof S?t:S.resolve(t)}catch(t){return S.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):S.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):S.reject(t)}static resolve(e){return new S((t,o)=>{t(e)})}static reject(e){return new S((t,o)=>{o(e)})}static waitFor(e){return new S((t,o)=>{let r=0,i=0,a=!1;e.forEach(c=>{++r,c.next(()=>{++i,a&&i===r&&t()},h=>o(h))}),a=!0,i===r&&t()})}static or(e){let t=S.resolve(!1);for(const o of e)t=t.next(r=>r?S.resolve(r):o());return t}static forEach(e,t){const o=[];return e.forEach((r,i)=>{o.push(t.call(this,r,i))}),this.waitFor(o)}static mapArray(e,t){return new S((o,r)=>{const i=e.length,a=new Array(i);let c=0;for(let h=0;h<i;h++){const d=h;t(e[d]).next(f=>{a[d]=f,++c,c===i&&o(a)},f=>r(f))}})}static doWhile(e,t){return new S((o,r)=>{const i=()=>{e()===!0?t().next(()=>{i()},r):o()};i()})}}function If(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function an(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=o=>this.ue(o),this.ce=o=>t.writeSequenceNumber(o))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}dr.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ri=-1;function mr(n){return n==null}function Ho(n){return n===0&&1/n==-1/0}function Af(n){return typeof n=="number"&&Number.isInteger(n)&&!Ho(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tu="";function Cf(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=wl(e)),e=Rf(n.get(t),e);return wl(e)}function Rf(n,e){let t=e;const o=n.length;for(let r=0;r<o;r++){const i=n.charAt(r);switch(i){case"\0":t+="";break;case tu:t+="";break;default:t+=i}}return t}function wl(n){return n+tu+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _l(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function _t(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function nu(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z{constructor(e,t){this.comparator=e,this.root=t||ue.EMPTY}insert(e,t){return new Z(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ue.BLACK,null,null))}remove(e){return new Z(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ue.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const o=this.comparator(e,t.key);if(o===0)return t.value;o<0?t=t.left:o>0&&(t=t.right)}return null}indexOf(e){let t=0,o=this.root;for(;!o.isEmpty();){const r=this.comparator(e,o.key);if(r===0)return t+o.left.size;r<0?o=o.left:(t+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,o)=>(e(t,o),!1))}toString(){const e=[];return this.inorderTraversal((t,o)=>(e.push(`${t}:${o}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ko(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ko(this.root,e,this.comparator,!1)}getReverseIterator(){return new ko(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ko(this.root,e,this.comparator,!0)}}class ko{constructor(e,t,o,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?o(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ue{constructor(e,t,o,r,i){this.key=e,this.value=t,this.color=o??ue.RED,this.left=r??ue.EMPTY,this.right=i??ue.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,o,r,i){return new ue(e??this.key,t??this.value,o??this.color,r??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,o){let r=this;const i=o(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,o),null):i===0?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,o)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ue.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let o,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),t(e,r.key)===0){if(r.right.isEmpty())return ue.EMPTY;o=r.right.min(),r=r.copy(o.key,o.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ue.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ue.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw L(27949);return e+(this.isRed()?0:1)}}ue.EMPTY=null,ue.RED=!0,ue.BLACK=!1;ue.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(e,t,o,r,i){return this}insert(e,t,o){return new ue(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ae{constructor(e){this.comparator=e,this.data=new Z(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,o)=>(e(t),!1))}forEachInRange(e,t){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const r=o.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let o;for(o=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new vl(this.data.getIterator())}getIteratorFrom(e){return new vl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(o=>{t=t.add(o)}),t}isEqual(e){if(!(e instanceof ae)||this.size!==e.size)return!1;const t=this.data.getIterator(),o=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=o.getNext().key;if(this.comparator(r,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ae(this.comparator);return t.data=e,t}}class vl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e){this.fields=e,e.sort(he.comparator)}static empty(){return new Re([])}unionWith(e){let t=new ae(he.comparator);for(const o of this.fields)t=t.add(o);for(const o of e)t=t.add(o);return new Re(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Qt(this.fields,e.fields,(t,o)=>t.isEqual(o))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ou extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class de{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new ou("Invalid base64 string: "+i):i}}(e);return new de(t)}static fromUint8Array(e){const t=function(r){let i="";for(let a=0;a<r.length;++a)i+=String.fromCharCode(r[a]);return i}(e);return new de(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const o=new Uint8Array(t.length);for(let r=0;r<t.length;r++)o[r]=t.charCodeAt(r);return o}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}de.EMPTY_BYTE_STRING=new de("");const Sf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function dt(n){if(G(!!n,39018),typeof n=="string"){let e=0;const t=Sf.exec(n);if(G(!!t,46558,{timestamp:n}),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const o=new Date(n);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:te(n.seconds),nanos:te(n.nanos)}}function te(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function mt(n){return typeof n=="string"?de.fromBase64String(n):de.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ru="server_timestamp",su="__type__",iu="__previous_value__",au="__local_write_time__";function si(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[su])===null||t===void 0?void 0:t.stringValue)===ru}function fr(n){const e=n.mapValue.fields[iu];return si(e)?fr(e):e}function Un(n){const e=dt(n.mapValue.fields[au].timestampValue);return new ie(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(e,t,o,r,i,a,c,h,d,f){this.databaseId=e,this.appId=t,this.persistenceKey=o,this.host=r,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=f}}const Wo="(default)";class $n{constructor(e,t){this.projectId=e,this.database=t||Wo}static empty(){return new $n("","")}get isDefaultDatabase(){return this.database===Wo}isEqual(e){return e instanceof $n&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lu="__type__",kf="__max__",Vo={mapValue:{}},cu="__vector__",Go="value";function ft(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?si(n)?4:Df(n)?9007199254740991:Vf(n)?10:11:L(28295,{value:n})}function je(n,e){if(n===e)return!0;const t=ft(n);if(t!==ft(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Un(n).isEqual(Un(e));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const a=dt(r.timestampValue),c=dt(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(r,i){return mt(r.bytesValue).isEqual(mt(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return te(r.geoPointValue.latitude)===te(i.geoPointValue.latitude)&&te(r.geoPointValue.longitude)===te(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return te(r.integerValue)===te(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const a=te(r.doubleValue),c=te(i.doubleValue);return a===c?Ho(a)===Ho(c):isNaN(a)&&isNaN(c)}return!1}(n,e);case 9:return Qt(n.arrayValue.values||[],e.arrayValue.values||[],je);case 10:case 11:return function(r,i){const a=r.mapValue.fields||{},c=i.mapValue.fields||{};if(_l(a)!==_l(c))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(c[h]===void 0||!je(a[h],c[h])))return!1;return!0}(n,e);default:return L(52216,{left:n})}}function qn(n,e){return(n.values||[]).find(t=>je(t,e))!==void 0}function Xt(n,e){if(n===e)return 0;const t=ft(n),o=ft(e);if(t!==o)return q(t,o);switch(t){case 0:case 9007199254740991:return 0;case 1:return q(n.booleanValue,e.booleanValue);case 2:return function(i,a){const c=te(i.integerValue||i.doubleValue),h=te(a.integerValue||a.doubleValue);return c<h?-1:c>h?1:c===h?0:isNaN(c)?isNaN(h)?0:-1:1}(n,e);case 3:return bl(n.timestampValue,e.timestampValue);case 4:return bl(Un(n),Un(e));case 5:return ks(n.stringValue,e.stringValue);case 6:return function(i,a){const c=mt(i),h=mt(a);return c.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(i,a){const c=i.split("/"),h=a.split("/");for(let d=0;d<c.length&&d<h.length;d++){const f=q(c[d],h[d]);if(f!==0)return f}return q(c.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,a){const c=q(te(i.latitude),te(a.latitude));return c!==0?c:q(te(i.longitude),te(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Tl(n.arrayValue,e.arrayValue);case 10:return function(i,a){var c,h,d,f;const g=i.fields||{},y=a.fields||{},A=(c=g[Go])===null||c===void 0?void 0:c.arrayValue,P=(h=y[Go])===null||h===void 0?void 0:h.arrayValue,V=q(((d=A==null?void 0:A.values)===null||d===void 0?void 0:d.length)||0,((f=P==null?void 0:P.values)===null||f===void 0?void 0:f.length)||0);return V!==0?V:Tl(A,P)}(n.mapValue,e.mapValue);case 11:return function(i,a){if(i===Vo.mapValue&&a===Vo.mapValue)return 0;if(i===Vo.mapValue)return 1;if(a===Vo.mapValue)return-1;const c=i.fields||{},h=Object.keys(c),d=a.fields||{},f=Object.keys(d);h.sort(),f.sort();for(let g=0;g<h.length&&g<f.length;++g){const y=ks(h[g],f[g]);if(y!==0)return y;const A=Xt(c[h[g]],d[f[g]]);if(A!==0)return A}return q(h.length,f.length)}(n.mapValue,e.mapValue);default:throw L(23264,{Pe:t})}}function bl(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return q(n,e);const t=dt(n),o=dt(e),r=q(t.seconds,o.seconds);return r!==0?r:q(t.nanos,o.nanos)}function Tl(n,e){const t=n.values||[],o=e.values||[];for(let r=0;r<t.length&&r<o.length;++r){const i=Xt(t[r],o[r]);if(i)return i}return q(t.length,o.length)}function Jt(n){return Vs(n)}function Vs(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const o=dt(t);return`time(${o.seconds},${o.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return mt(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return O.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let o="[",r=!0;for(const i of t.values||[])r?r=!1:o+=",",o+=Vs(i);return o+"]"}(n.arrayValue):"mapValue"in n?function(t){const o=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const a of o)i?i=!1:r+=",",r+=`${a}:${Vs(t.fields[a])}`;return r+"}"}(n.mapValue):L(61005,{value:n})}function Oo(n){switch(ft(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=fr(n);return e?16+Oo(e):16;case 5:return 2*n.stringValue.length;case 6:return mt(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(o){return(o.values||[]).reduce((r,i)=>r+Oo(i),0)}(n.arrayValue);case 10:case 11:return function(o){let r=0;return _t(o.fields,(i,a)=>{r+=i.length+Oo(a)}),r}(n.mapValue);default:throw L(13486,{value:n})}}function El(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ds(n){return!!n&&"integerValue"in n}function ii(n){return!!n&&"arrayValue"in n}function Il(n){return!!n&&"nullValue"in n}function Al(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Lo(n){return!!n&&"mapValue"in n}function Vf(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[lu])===null||t===void 0?void 0:t.stringValue)===cu}function Dn(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return _t(n.mapValue.fields,(t,o)=>e.mapValue.fields[t]=Dn(o)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Dn(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Df(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===kf}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{constructor(e){this.value=e}static empty(){return new Ie({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let o=0;o<e.length-1;++o)if(t=(t.mapValue.fields||{})[e.get(o)],!Lo(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Dn(t)}setAll(e){let t=he.emptyPath(),o={},r=[];e.forEach((a,c)=>{if(!t.isImmediateParentOf(c)){const h=this.getFieldsMap(t);this.applyChanges(h,o,r),o={},r=[],t=c.popLast()}a?o[c.lastSegment()]=Dn(a):r.push(c.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,o,r)}delete(e){const t=this.field(e.popLast());Lo(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return je(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let o=0;o<e.length;++o){let r=t.mapValue.fields[e.get(o)];Lo(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(o)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,o){_t(t,(r,i)=>e[r]=i);for(const r of o)delete e[r]}clone(){return new Ie(Dn(this.value))}}function uu(n){const e=[];return _t(n.fields,(t,o)=>{const r=new he([t]);if(Lo(o)){const i=uu(o.mapValue).fields;if(i.length===0)e.push(r);else for(const a of i)e.push(r.child(a))}else e.push(r)}),new Re(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class we{constructor(e,t,o,r,i,a,c){this.key=e,this.documentType=t,this.version=o,this.readTime=r,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(e){return new we(e,0,M.min(),M.min(),M.min(),Ie.empty(),0)}static newFoundDocument(e,t,o,r){return new we(e,1,t,M.min(),o,r,0)}static newNoDocument(e,t){return new we(e,2,t,M.min(),M.min(),Ie.empty(),0)}static newUnknownDocument(e,t){return new we(e,3,t,M.min(),M.min(),Ie.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(M.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ie.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ie.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=M.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof we&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new we(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ko{constructor(e,t){this.position=e,this.inclusive=t}}function Cl(n,e,t){let o=0;for(let r=0;r<n.position.length;r++){const i=e[r],a=n.position[r];if(i.field.isKeyField()?o=O.comparator(O.fromName(a.referenceValue),t.key):o=Xt(a,t.data.field(i.field)),i.dir==="desc"&&(o*=-1),o!==0)break}return o}function Rl(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!je(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jn{constructor(e,t="asc"){this.field=e,this.dir=t}}function Nf(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{}class re extends hu{constructor(e,t,o){super(),this.field=e,this.op=t,this.value=o}static create(e,t,o){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,o):new Of(e,t,o):t==="array-contains"?new Bf(e,o):t==="in"?new Ff(e,o):t==="not-in"?new Uf(e,o):t==="array-contains-any"?new $f(e,o):new re(e,t,o)}static createKeyFieldInFilter(e,t,o){return t==="in"?new Lf(e,o):new Mf(e,o)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Xt(t,this.value)):t!==null&&ft(this.value)===ft(t)&&this.matchesComparison(Xt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Me extends hu{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new Me(e,t)}matches(e){return du(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function du(n){return n.op==="and"}function mu(n){return xf(n)&&du(n)}function xf(n){for(const e of n.filters)if(e instanceof Me)return!1;return!0}function Ns(n){if(n instanceof re)return n.field.canonicalString()+n.op.toString()+Jt(n.value);if(mu(n))return n.filters.map(e=>Ns(e)).join(",");{const e=n.filters.map(t=>Ns(t)).join(",");return`${n.op}(${e})`}}function fu(n,e){return n instanceof re?function(o,r){return r instanceof re&&o.op===r.op&&o.field.isEqual(r.field)&&je(o.value,r.value)}(n,e):n instanceof Me?function(o,r){return r instanceof Me&&o.op===r.op&&o.filters.length===r.filters.length?o.filters.reduce((i,a,c)=>i&&fu(a,r.filters[c]),!0):!1}(n,e):void L(19439)}function gu(n){return n instanceof re?function(t){return`${t.field.canonicalString()} ${t.op} ${Jt(t.value)}`}(n):n instanceof Me?function(t){return t.op.toString()+" {"+t.getFilters().map(gu).join(" ,")+"}"}(n):"Filter"}class Of extends re{constructor(e,t,o){super(e,t,o),this.key=O.fromName(o.referenceValue)}matches(e){const t=O.comparator(e.key,this.key);return this.matchesComparison(t)}}class Lf extends re{constructor(e,t){super(e,"in",t),this.keys=pu("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Mf extends re{constructor(e,t){super(e,"not-in",t),this.keys=pu("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function pu(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(o=>O.fromName(o.referenceValue))}class Bf extends re{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ii(t)&&qn(t.arrayValue,this.value)}}class Ff extends re{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&qn(this.value.arrayValue,t)}}class Uf extends re{constructor(e,t){super(e,"not-in",t)}matches(e){if(qn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!qn(this.value.arrayValue,t)}}class $f extends re{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ii(t)||!t.arrayValue.values)&&t.arrayValue.values.some(o=>qn(this.value.arrayValue,o))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qf{constructor(e,t=null,o=[],r=[],i=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=o,this.filters=r,this.limit=i,this.startAt=a,this.endAt=c,this.Ie=null}}function Sl(n,e=null,t=[],o=[],r=null,i=null,a=null){return new qf(n,e,t,o,r,i,a)}function ai(n){const e=F(n);if(e.Ie===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(o=>Ns(o)).join(","),t+="|ob:",t+=e.orderBy.map(o=>function(i){return i.field.canonicalString()+i.dir}(o)).join(","),mr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(o=>Jt(o)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(o=>Jt(o)).join(",")),e.Ie=t}return e.Ie}function li(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Nf(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!fu(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Rl(n.startAt,e.startAt)&&Rl(n.endAt,e.endAt)}function xs(n){return O.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ln{constructor(e,t=null,o=[],r=[],i=null,a="F",c=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=o,this.filters=r,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=h,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function jf(n,e,t,o,r,i,a,c){return new ln(n,e,t,o,r,i,a,c)}function gr(n){return new ln(n)}function Pl(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function yu(n){return n.collectionGroup!==null}function Nn(n){const e=F(n);if(e.Ee===null){e.Ee=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ee.push(i),t.add(i.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new ae(he.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(d=>{d.isInequality()&&(c=c.add(d.field))})}),c})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ee.push(new jn(i,o))}),t.has(he.keyField().canonicalString())||e.Ee.push(new jn(he.keyField(),o))}return e.Ee}function Ue(n){const e=F(n);return e.de||(e.de=Yf(e,Nn(n))),e.de}function Yf(n,e){if(n.limitType==="F")return Sl(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(r=>{const i=r.dir==="desc"?"asc":"desc";return new jn(r.field,i)});const t=n.endAt?new Ko(n.endAt.position,n.endAt.inclusive):null,o=n.startAt?new Ko(n.startAt.position,n.startAt.inclusive):null;return Sl(n.path,n.collectionGroup,e,n.filters,n.limit,t,o)}}function Os(n,e){const t=n.filters.concat([e]);return new ln(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ls(n,e,t){return new ln(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function pr(n,e){return li(Ue(n),Ue(e))&&n.limitType===e.limitType}function wu(n){return`${ai(Ue(n))}|lt:${n.limitType}`}function Yt(n){return`Query(target=${function(t){let o=t.path.canonicalString();return t.collectionGroup!==null&&(o+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(o+=`, filters: [${t.filters.map(r=>gu(r)).join(", ")}]`),mr(t.limit)||(o+=", limit: "+t.limit),t.orderBy.length>0&&(o+=`, orderBy: [${t.orderBy.map(r=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(r)).join(", ")}]`),t.startAt&&(o+=", startAt: ",o+=t.startAt.inclusive?"b:":"a:",o+=t.startAt.position.map(r=>Jt(r)).join(",")),t.endAt&&(o+=", endAt: ",o+=t.endAt.inclusive?"a:":"b:",o+=t.endAt.position.map(r=>Jt(r)).join(",")),`Target(${o})`}(Ue(n))}; limitType=${n.limitType})`}function yr(n,e){return e.isFoundDocument()&&function(o,r){const i=r.key.path;return o.collectionGroup!==null?r.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(i):O.isDocumentKey(o.path)?o.path.isEqual(i):o.path.isImmediateParentOf(i)}(n,e)&&function(o,r){for(const i of Nn(o))if(!i.field.isKeyField()&&r.data.field(i.field)===null)return!1;return!0}(n,e)&&function(o,r){for(const i of o.filters)if(!i.matches(r))return!1;return!0}(n,e)&&function(o,r){return!(o.startAt&&!function(a,c,h){const d=Cl(a,c,h);return a.inclusive?d<=0:d<0}(o.startAt,Nn(o),r)||o.endAt&&!function(a,c,h){const d=Cl(a,c,h);return a.inclusive?d>=0:d>0}(o.endAt,Nn(o),r))}(n,e)}function zf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function _u(n){return(e,t)=>{let o=!1;for(const r of Nn(n)){const i=Hf(r,e,t);if(i!==0)return i;o=o||r.field.isKeyField()}return 0}}function Hf(n,e,t){const o=n.field.isKeyField()?O.comparator(e.key,t.key):function(i,a,c){const h=a.data.field(i),d=c.data.field(i);return h!==null&&d!==null?Xt(h,d):L(42886)}(n.field,e,t);switch(n.dir){case"asc":return o;case"desc":return-1*o;default:return L(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),o=this.inner[t];if(o!==void 0){for(const[r,i]of o)if(this.equalsFn(r,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const o=this.mapKeyFn(e),r=this.inner[o];if(r===void 0)return this.inner[o]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),o=this.inner[t];if(o===void 0)return!1;for(let r=0;r<o.length;r++)if(this.equalsFn(o[r][0],e))return o.length===1?delete this.inner[t]:o.splice(r,1),this.innerSize--,!0;return!1}forEach(e){_t(this.inner,(t,o)=>{for(const[r,i]of o)e(r,i)})}isEmpty(){return nu(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wf=new Z(O.comparator);function Ze(){return Wf}const vu=new Z(O.comparator);function Sn(...n){let e=vu;for(const t of n)e=e.insert(t.key,t);return e}function bu(n){let e=vu;return n.forEach((t,o)=>e=e.insert(t,o.overlayedDocument)),e}function Vt(){return xn()}function Tu(){return xn()}function xn(){return new xt(n=>n.toString(),(n,e)=>n.isEqual(e))}const Gf=new Z(O.comparator),Kf=new ae(O.comparator);function j(...n){let e=Kf;for(const t of n)e=e.add(t);return e}const Qf=new ae(q);function Xf(){return Qf}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ci(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ho(e)?"-0":e}}function Eu(n){return{integerValue:""+n}}function Iu(n,e){return Af(e)?Eu(e):ci(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(){this._=void 0}}function Jf(n,e,t){return n instanceof Qo?function(r,i){const a={fields:{[su]:{stringValue:ru},[au]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&si(i)&&(i=fr(i)),i&&(a.fields[iu]=i),{mapValue:a}}(t,e):n instanceof Yn?Cu(n,e):n instanceof zn?Ru(n,e):function(r,i){const a=Au(r,i),c=kl(a)+kl(r.Re);return Ds(a)&&Ds(r.Re)?Eu(c):ci(r.serializer,c)}(n,e)}function Zf(n,e,t){return n instanceof Yn?Cu(n,e):n instanceof zn?Ru(n,e):t}function Au(n,e){return n instanceof Hn?function(o){return Ds(o)||function(i){return!!i&&"doubleValue"in i}(o)}(e)?e:{integerValue:0}:null}class Qo extends wr{}class Yn extends wr{constructor(e){super(),this.elements=e}}function Cu(n,e){const t=Su(e);for(const o of n.elements)t.some(r=>je(r,o))||t.push(o);return{arrayValue:{values:t}}}class zn extends wr{constructor(e){super(),this.elements=e}}function Ru(n,e){let t=Su(e);for(const o of n.elements)t=t.filter(r=>!je(r,o));return{arrayValue:{values:t}}}class Hn extends wr{constructor(e,t){super(),this.serializer=e,this.Re=t}}function kl(n){return te(n.integerValue||n.doubleValue)}function Su(n){return ii(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eg{constructor(e,t){this.field=e,this.transform=t}}function tg(n,e){return n.field.isEqual(e.field)&&function(o,r){return o instanceof Yn&&r instanceof Yn||o instanceof zn&&r instanceof zn?Qt(o.elements,r.elements,je):o instanceof Hn&&r instanceof Hn?je(o.Re,r.Re):o instanceof Qo&&r instanceof Qo}(n.transform,e.transform)}class ng{constructor(e,t){this.version=e,this.transformResults=t}}class Le{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Le}static exists(e){return new Le(void 0,e)}static updateTime(e){return new Le(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Mo(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class _r{}function Pu(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new ui(n.key,Le.none()):new eo(n.key,n.data,Le.none());{const t=n.data,o=Ie.empty();let r=new ae(he.comparator);for(let i of e.fields)if(!r.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?o.delete(i):o.set(i,a),r=r.add(i)}return new vt(n.key,o,new Re(r.toArray()),Le.none())}}function og(n,e,t){n instanceof eo?function(r,i,a){const c=r.value.clone(),h=Dl(r.fieldTransforms,i,a.transformResults);c.setAll(h),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(n,e,t):n instanceof vt?function(r,i,a){if(!Mo(r.precondition,i))return void i.convertToUnknownDocument(a.version);const c=Dl(r.fieldTransforms,i,a.transformResults),h=i.data;h.setAll(ku(r)),h.setAll(c),i.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):function(r,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function On(n,e,t,o){return n instanceof eo?function(i,a,c,h){if(!Mo(i.precondition,a))return c;const d=i.value.clone(),f=Nl(i.fieldTransforms,h,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(n,e,t,o):n instanceof vt?function(i,a,c,h){if(!Mo(i.precondition,a))return c;const d=Nl(i.fieldTransforms,h,a),f=a.data;return f.setAll(ku(i)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(g=>g.field))}(n,e,t,o):function(i,a,c){return Mo(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c}(n,e,t)}function rg(n,e){let t=null;for(const o of n.fieldTransforms){const r=e.data.field(o.field),i=Au(o.transform,r||null);i!=null&&(t===null&&(t=Ie.empty()),t.set(o.field,i))}return t||null}function Vl(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(o,r){return o===void 0&&r===void 0||!(!o||!r)&&Qt(o,r,(i,a)=>tg(i,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class eo extends _r{constructor(e,t,o,r=[]){super(),this.key=e,this.value=t,this.precondition=o,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class vt extends _r{constructor(e,t,o,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=o,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ku(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const o=n.data.field(t);e.set(t,o)}}),e}function Dl(n,e,t){const o=new Map;G(n.length===t.length,32656,{Ve:t.length,me:n.length});for(let r=0;r<t.length;r++){const i=n[r],a=i.transform,c=e.data.field(i.field);o.set(i.field,Zf(a,c,t[r]))}return o}function Nl(n,e,t){const o=new Map;for(const r of n){const i=r.transform,a=t.data.field(r.field);o.set(r.field,Jf(i,a,e))}return o}class ui extends _r{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sg extends _r{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ig{constructor(e,t,o,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=o,this.mutations=r}applyToRemoteDocument(e,t){const o=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const i=this.mutations[r];i.key.isEqual(e.key)&&og(i,e,o[r])}}applyToLocalView(e,t){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(t=On(o,e,t,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(t=On(o,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const o=Tu();return this.mutations.forEach(r=>{const i=e.get(r.key),a=i.overlayedDocument;let c=this.applyToLocalView(a,i.mutatedFields);c=t.has(r.key)?null:c;const h=Pu(a,c);h!==null&&o.set(r.key,h),a.isValidDocument()||a.convertToNoDocument(M.min())}),o}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),j())}isEqual(e){return this.batchId===e.batchId&&Qt(this.mutations,e.mutations,(t,o)=>Vl(t,o))&&Qt(this.baseMutations,e.baseMutations,(t,o)=>Vl(t,o))}}class hi{constructor(e,t,o,r){this.batch=e,this.commitVersion=t,this.mutationResults=o,this.docVersions=r}static from(e,t,o){G(e.mutations.length===o.length,58842,{fe:e.mutations.length,ge:o.length});let r=function(){return Gf}();const i=e.mutations;for(let a=0;a<i.length;a++)r=r.insert(i[a].key,o[a].version);return new hi(e,t,o,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ag{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lg{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var oe,Y;function cg(n){switch(n){case R.OK:return L(64938);case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0;default:return L(15467,{code:n})}}function Vu(n){if(n===void 0)return Je("GRPC error has no .code"),R.UNKNOWN;switch(n){case oe.OK:return R.OK;case oe.CANCELLED:return R.CANCELLED;case oe.UNKNOWN:return R.UNKNOWN;case oe.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case oe.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case oe.INTERNAL:return R.INTERNAL;case oe.UNAVAILABLE:return R.UNAVAILABLE;case oe.UNAUTHENTICATED:return R.UNAUTHENTICATED;case oe.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case oe.NOT_FOUND:return R.NOT_FOUND;case oe.ALREADY_EXISTS:return R.ALREADY_EXISTS;case oe.PERMISSION_DENIED:return R.PERMISSION_DENIED;case oe.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case oe.ABORTED:return R.ABORTED;case oe.OUT_OF_RANGE:return R.OUT_OF_RANGE;case oe.UNIMPLEMENTED:return R.UNIMPLEMENTED;case oe.DATA_LOSS:return R.DATA_LOSS;default:return L(39323,{code:n})}}(Y=oe||(oe={}))[Y.OK=0]="OK",Y[Y.CANCELLED=1]="CANCELLED",Y[Y.UNKNOWN=2]="UNKNOWN",Y[Y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Y[Y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Y[Y.NOT_FOUND=5]="NOT_FOUND",Y[Y.ALREADY_EXISTS=6]="ALREADY_EXISTS",Y[Y.PERMISSION_DENIED=7]="PERMISSION_DENIED",Y[Y.UNAUTHENTICATED=16]="UNAUTHENTICATED",Y[Y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Y[Y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Y[Y.ABORTED=10]="ABORTED",Y[Y.OUT_OF_RANGE=11]="OUT_OF_RANGE",Y[Y.UNIMPLEMENTED=12]="UNIMPLEMENTED",Y[Y.INTERNAL=13]="INTERNAL",Y[Y.UNAVAILABLE=14]="UNAVAILABLE",Y[Y.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ug=new ct([4294967295,4294967295],0);function xl(n){const e=Zc().encode(n),t=new zc;return t.update(e),new Uint8Array(t.digest())}function Ol(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),o=e.getUint32(4,!0),r=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ct([t,o],0),new ct([r,i],0)]}class di{constructor(e,t,o){if(this.bitmap=e,this.padding=t,this.hashCount=o,t<0||t>=8)throw new Pn(`Invalid padding: ${t}`);if(o<0)throw new Pn(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new Pn(`Invalid hash count: ${o}`);if(e.length===0&&t!==0)throw new Pn(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=ct.fromNumber(this.pe)}we(e,t,o){let r=e.add(t.multiply(ct.fromNumber(o)));return r.compare(ug)===1&&(r=new ct([r.getBits(0),r.getBits(1)],0)),r.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.pe===0)return!1;const t=xl(e),[o,r]=Ol(t);for(let i=0;i<this.hashCount;i++){const a=this.we(o,r,i);if(!this.be(a))return!1}return!0}static create(e,t,o){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new di(i,r,t);return o.forEach(c=>a.insert(c)),a}insert(e){if(this.pe===0)return;const t=xl(e),[o,r]=Ol(t);for(let i=0;i<this.hashCount;i++){const a=this.we(o,r,i);this.Se(a)}}Se(e){const t=Math.floor(e/8),o=e%8;this.bitmap[t]|=1<<o}}class Pn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr{constructor(e,t,o,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=o,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,o){const r=new Map;return r.set(e,to.createSynthesizedTargetChangeForCurrentChange(e,t,o)),new vr(M.min(),r,new Z(q),Ze(),j())}}class to{constructor(e,t,o,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=o,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,o){return new to(o,t,j(),j(),j())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(e,t,o,r){this.De=e,this.removedTargetIds=t,this.key=o,this.ve=r}}class Du{constructor(e,t){this.targetId=e,this.Ce=t}}class Nu{constructor(e,t,o=de.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=o,this.cause=r}}class Ll{constructor(){this.Fe=0,this.Me=Ml(),this.xe=de.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=j(),t=j(),o=j();return this.Me.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:o=o.add(r);break;default:L(38017,{changeType:i})}}),new to(this.xe,this.Oe,e,t,o)}Qe(){this.Ne=!1,this.Me=Ml()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,G(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class hg{constructor(e){this.ze=e,this.je=new Map,this.He=Ze(),this.Je=Do(),this.Ye=Do(),this.Ze=new Z(q)}Xe(e){for(const t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(const t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{const o=this.rt(t);switch(e.state){case 0:this.it(t)&&o.ke(e.resumeToken);break;case 1:o.We(),o.Be||o.Qe(),o.ke(e.resumeToken);break;case 2:o.We(),o.Be||this.removeTarget(t);break;case 3:this.it(t)&&(o.Ge(),o.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),o.ke(e.resumeToken));break;default:L(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((o,r)=>{this.it(r)&&t(r)})}ot(e){const t=e.targetId,o=e.Ce.count,r=this._t(t);if(r){const i=r.target;if(xs(i))if(o===0){const a=new O(i.path);this.tt(t,a,we.newNoDocument(a,M.min()))}else G(o===1,20013,{expectedCount:o});else{const a=this.ut(t);if(a!==o){const c=this.ct(e),h=c?this.lt(c,e,a):1;if(h!==0){this.st(t);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(t,d)}}}}}ct(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:o="",padding:r=0},hashCount:i=0}=t;let a,c;try{a=mt(o).toUint8Array()}catch(h){if(h instanceof ou)return Kt("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{c=new di(a,r,i)}catch(h){return Kt(h instanceof Pn?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return c.pe===0?null:c}lt(e,t,o){return t.Ce.count===o-this.Tt(e,t.targetId)?0:2}Tt(e,t){const o=this.ze.getRemoteKeysForTarget(t);let r=0;return o.forEach(i=>{const a=this.ze.Pt(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.tt(t,i,null),r++)}),r}It(e){const t=new Map;this.je.forEach((i,a)=>{const c=this._t(a);if(c){if(i.current&&xs(c.target)){const h=new O(c.target.path);this.Et(h).has(a)||this.dt(a,h)||this.tt(a,h,we.newNoDocument(h,e))}i.Le&&(t.set(a,i.qe()),i.Qe())}});let o=j();this.Ye.forEach((i,a)=>{let c=!0;a.forEachWhile(h=>{const d=this._t(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(o=o.add(i))}),this.He.forEach((i,a)=>a.setReadTime(e));const r=new vr(e,t,this.Ze,this.He,o);return this.He=Ze(),this.Je=Do(),this.Ye=Do(),this.Ze=new Z(q),r}et(e,t){if(!this.it(e))return;const o=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,o),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,o){if(!this.it(e))return;const r=this.rt(e);this.dt(e,t)?r.$e(t,1):r.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),o&&(this.He=this.He.insert(t,o))}removeTarget(e){this.je.delete(e)}ut(e){const t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new Ll,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new ae(q),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new ae(q),this.Je=this.Je.insert(e,t)),t}it(e){const t=this._t(e)!==null;return t||N("WatchChangeAggregator","Detected inactive target",e),t}_t(e){const t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new Ll),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function Do(){return new Z(O.comparator)}function Ml(){return new Z(O.comparator)}const dg={asc:"ASCENDING",desc:"DESCENDING"},mg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fg={and:"AND",or:"OR"};class gg{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ms(n,e){return n.useProto3Json||mr(e)?e:{value:e}}function Xo(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function xu(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function pg(n,e){return Xo(n,e.toTimestamp())}function $e(n){return G(!!n,49232),M.fromTimestamp(function(t){const o=dt(t);return new ie(o.seconds,o.nanos)}(n))}function mi(n,e){return Bs(n,e).canonicalString()}function Bs(n,e){const t=function(r){return new X(["projects",r.projectId,"databases",r.database])}(n).child("documents");return e===void 0?t:t.child(e)}function Ou(n){const e=X.fromString(n);return G(Uu(e),10190,{key:e.toString()}),e}function Fs(n,e){return mi(n.databaseId,e.path)}function ds(n,e){const t=Ou(e);if(t.get(1)!==n.databaseId.projectId)throw new x(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new x(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new O(Mu(t))}function Lu(n,e){return mi(n.databaseId,e)}function yg(n){const e=Ou(n);return e.length===4?X.emptyPath():Mu(e)}function Us(n){return new X(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Mu(n){return G(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Bl(n,e,t){return{name:Fs(n,e),fields:t.value.mapValue.fields}}function wg(n,e){let t;if("targetChange"in e){e.targetChange;const o=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L(39313,{state:d})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(d,f){return d.useProto3Json?(G(f===void 0||typeof f=="string",58123),de.fromBase64String(f||"")):(G(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),de.fromUint8Array(f||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&function(d){const f=d.code===void 0?R.UNKNOWN:Vu(d.code);return new x(f,d.message||"")}(a);t=new Nu(o,r,i,c||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const r=ds(n,o.document.name),i=$e(o.document.updateTime),a=o.document.createTime?$e(o.document.createTime):M.min(),c=new Ie({mapValue:{fields:o.document.fields}}),h=we.newFoundDocument(r,i,a,c),d=o.targetIds||[],f=o.removedTargetIds||[];t=new Bo(d,f,h.key,h)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const r=ds(n,o.document),i=o.readTime?$e(o.readTime):M.min(),a=we.newNoDocument(r,i),c=o.removedTargetIds||[];t=new Bo([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const r=ds(n,o.document),i=o.removedTargetIds||[];t=new Bo([],i,r,null)}else{if(!("filter"in e))return L(11601,{Vt:e});{e.filter;const o=e.filter;o.targetId;const{count:r=0,unchangedNames:i}=o,a=new lg(r,i),c=o.targetId;t=new Du(c,a)}}return t}function _g(n,e){let t;if(e instanceof eo)t={update:Bl(n,e.key,e.value)};else if(e instanceof ui)t={delete:Fs(n,e.key)};else if(e instanceof vt)t={update:Bl(n,e.key,e.data),updateMask:Sg(e.fieldMask)};else{if(!(e instanceof sg))return L(16599,{ft:e.type});t={verify:Fs(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(o=>function(i,a){const c=a.transform;if(c instanceof Qo)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Yn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof zn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof Hn)return{fieldPath:a.field.canonicalString(),increment:c.Re};throw L(20930,{transform:a.transform})}(0,o))),e.precondition.isNone||(t.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:pg(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:L(27497)}(n,e.precondition)),t}function vg(n,e){return n&&n.length>0?(G(e!==void 0,14353),n.map(t=>function(r,i){let a=r.updateTime?$e(r.updateTime):$e(i);return a.isEqual(M.min())&&(a=$e(i)),new ng(a,r.transformResults||[])}(t,e))):[]}function bg(n,e){return{documents:[Lu(n,e.path)]}}function Tg(n,e){const t={structuredQuery:{}},o=e.path;let r;e.collectionGroup!==null?(r=o,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=o.popLast(),t.structuredQuery.from=[{collectionId:o.lastSegment()}]),t.parent=Lu(n,r);const i=function(d){if(d.length!==0)return Fu(Me.create(d,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const a=function(d){if(d.length!==0)return d.map(f=>function(y){return{field:zt(y.field),direction:Ag(y.dir)}}(f))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const c=Ms(n,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{gt:t,parent:r}}function Eg(n){let e=yg(n.parent);const t=n.structuredQuery,o=t.from?t.from.length:0;let r=null;if(o>0){G(o===1,65062);const f=t.from[0];f.allDescendants?r=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=function(g){const y=Bu(g);return y instanceof Me&&mu(y)?y.getFilters():[y]}(t.where));let a=[];t.orderBy&&(a=function(g){return g.map(y=>function(P){return new jn(Ht(P.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(P.direction))}(y))}(t.orderBy));let c=null;t.limit&&(c=function(g){let y;return y=typeof g=="object"?g.value:g,mr(y)?null:y}(t.limit));let h=null;t.startAt&&(h=function(g){const y=!!g.before,A=g.values||[];return new Ko(A,y)}(t.startAt));let d=null;return t.endAt&&(d=function(g){const y=!g.before,A=g.values||[];return new Ko(A,y)}(t.endAt)),jf(e,r,a,i,c,"F",h,d)}function Ig(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:r})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Bu(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const o=Ht(t.unaryFilter.field);return re.create(o,"==",{doubleValue:NaN});case"IS_NULL":const r=Ht(t.unaryFilter.field);return re.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Ht(t.unaryFilter.field);return re.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Ht(t.unaryFilter.field);return re.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}}(n):n.fieldFilter!==void 0?function(t){return re.create(Ht(t.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Me.create(t.compositeFilter.filters.map(o=>Bu(o)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return L(1026)}}(t.compositeFilter.op))}(n):L(30097,{filter:n})}function Ag(n){return dg[n]}function Cg(n){return mg[n]}function Rg(n){return fg[n]}function zt(n){return{fieldPath:n.canonicalString()}}function Ht(n){return he.fromServerFormat(n.fieldPath)}function Fu(n){return n instanceof re?function(t){if(t.op==="=="){if(Al(t.value))return{unaryFilter:{field:zt(t.field),op:"IS_NAN"}};if(Il(t.value))return{unaryFilter:{field:zt(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Al(t.value))return{unaryFilter:{field:zt(t.field),op:"IS_NOT_NAN"}};if(Il(t.value))return{unaryFilter:{field:zt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:zt(t.field),op:Cg(t.op),value:t.value}}}(n):n instanceof Me?function(t){const o=t.getFilters().map(r=>Fu(r));return o.length===1?o[0]:{compositeFilter:{op:Rg(t.op),filters:o}}}(n):L(54877,{filter:n})}function Sg(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Uu(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(e,t,o,r,i=M.min(),a=M.min(),c=de.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=o,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=h}withSequenceNumber(e){return new it(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new it(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new it(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new it(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pg{constructor(e){this.wt=e}}function kg(n){const e=Eg({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Ls(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vg{constructor(){this.Cn=new Dg}addToCollectionParentIndex(e,t){return this.Cn.add(t),S.resolve()}getCollectionParents(e,t){return S.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return S.resolve()}deleteFieldIndex(e,t){return S.resolve()}deleteAllFieldIndexes(e){return S.resolve()}createTargetIndexes(e,t){return S.resolve()}getDocumentsMatchingTarget(e,t){return S.resolve(null)}getIndexType(e,t){return S.resolve(0)}getFieldIndexes(e,t){return S.resolve([])}getNextCollectionGroupToUpdate(e){return S.resolve(null)}getMinOffset(e,t){return S.resolve(ht.min())}getMinOffsetFromCollectionGroup(e,t){return S.resolve(ht.min())}updateCollectionGroup(e,t,o){return S.resolve()}updateIndexEntries(e,t){return S.resolve()}}class Dg{constructor(){this.index={}}add(e){const t=e.lastSegment(),o=e.popLast(),r=this.index[t]||new ae(X.comparator),i=!r.has(o);return this.index[t]=r.add(o),i}has(e){const t=e.lastSegment(),o=e.popLast(),r=this.index[t];return r&&r.has(o)}getEntries(e){return(this.index[e]||new ae(X.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},$u=41943040;class Ee{static withCacheSize(e){return new Ee(e,Ee.DEFAULT_COLLECTION_PERCENTILE,Ee.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,o){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ee.DEFAULT_COLLECTION_PERCENTILE=10,Ee.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ee.DEFAULT=new Ee($u,Ee.DEFAULT_COLLECTION_PERCENTILE,Ee.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ee.DISABLED=new Ee(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new Zt(0)}static lr(){return new Zt(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ul="LruGarbageCollector",Ng=1048576;function $l([n,e],[t,o]){const r=q(n,t);return r===0?q(e,o):r}class xg{constructor(e){this.Er=e,this.buffer=new ae($l),this.dr=0}Ar(){return++this.dr}Rr(e){const t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{const o=this.buffer.last();$l(t,o)<0&&(this.buffer=this.buffer.delete(o).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Og{constructor(e,t,o){this.garbageCollector=e,this.asyncQueue=t,this.localStore=o,this.Vr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return this.Vr!==null}mr(e){N(Ul,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){an(t)?N(Ul,"Ignoring IndexedDB error during garbage collection: ",t):await sn(t)}await this.mr(3e5)})}}class Lg{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next(o=>Math.floor(t/100*o))}nthSequenceNumber(e,t){if(t===0)return S.resolve(dr.le);const o=new xg(t);return this.gr.forEachTarget(e,r=>o.Rr(r.sequenceNumber)).next(()=>this.gr.yr(e,r=>o.Rr(r))).next(()=>o.maxValue)}removeTargets(e,t,o){return this.gr.removeTargets(e,t,o)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(N("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(Fl)):this.getCacheSize(e).next(o=>o<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${o} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Fl):this.wr(e,t))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let o,r,i,a,c,h,d;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),r=this.params.maximumSequenceNumbersToCollect):r=g,a=Date.now(),this.nthSequenceNumber(e,r))).next(g=>(o=g,c=Date.now(),this.removeTargets(e,o,t))).next(g=>(i=g,h=Date.now(),this.removeOrphanedDocuments(e,o))).next(g=>(d=Date.now(),jt()<=z.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${r} in `+(c-a)+`ms
	Removed ${i} targets in `+(h-c)+`ms
	Removed ${g} documents in `+(d-h)+`ms
Total Duration: ${d-f}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:g})))}}function Mg(n,e){return new Lg(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bg{constructor(){this.changes=new xt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,we.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const o=this.changes.get(t);return o!==void 0?S.resolve(o):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fg{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ug{constructor(e,t,o,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=o,this.indexManager=r}getDocument(e,t){let o=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(o=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(o!==null&&On(o.mutation,r,Re.empty(),ie.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(o=>this.getLocalViewOfDocuments(e,o,j()).next(()=>o))}getLocalViewOfDocuments(e,t,o=j()){const r=Vt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,o).next(i=>{let a=Sn();return i.forEach((c,h)=>{a=a.insert(c,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const o=Vt();return this.populateOverlays(e,o,t).next(()=>this.computeViews(e,t,o,j()))}populateOverlays(e,t,o){const r=[];return o.forEach(i=>{t.has(i)||r.push(i)}),this.documentOverlayCache.getOverlays(e,r).next(i=>{i.forEach((a,c)=>{t.set(a,c)})})}computeViews(e,t,o,r){let i=Ze();const a=xn(),c=function(){return xn()}();return t.forEach((h,d)=>{const f=o.get(d.key);r.has(d.key)&&(f===void 0||f.mutation instanceof vt)?i=i.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),On(f.mutation,d,f.mutation.getFieldMask(),ie.now())):a.set(d.key,Re.empty())}),this.recalculateAndSaveOverlays(e,i).next(h=>(h.forEach((d,f)=>a.set(d,f)),t.forEach((d,f)=>{var g;return c.set(d,new Fg(f,(g=a.get(d))!==null&&g!==void 0?g:null))}),c))}recalculateAndSaveOverlays(e,t){const o=xn();let r=new Z((a,c)=>a-c),i=j();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const c of a)c.keys().forEach(h=>{const d=t.get(h);if(d===null)return;let f=o.get(h)||Re.empty();f=c.applyToLocalView(d,f),o.set(h,f);const g=(r.get(c.batchId)||j()).add(h);r=r.insert(c.batchId,g)})}).next(()=>{const a=[],c=r.getReverseIterator();for(;c.hasNext();){const h=c.getNext(),d=h.key,f=h.value,g=Tu();f.forEach(y=>{if(!i.has(y)){const A=Pu(t.get(y),o.get(y));A!==null&&g.set(y,A),i=i.add(y)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,g))}return S.waitFor(a)}).next(()=>o)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(o=>this.recalculateAndSaveOverlays(e,o))}getDocumentsMatchingQuery(e,t,o,r){return function(a){return O.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):yu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,o,r):this.getDocumentsMatchingCollectionQuery(e,t,o,r)}getNextDocuments(e,t,o,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,o,r).next(i=>{const a=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,o.largestBatchId,r-i.size):S.resolve(Vt());let c=Fn,h=i;return a.next(d=>S.forEach(d,(f,g)=>(c<g.largestBatchId&&(c=g.largestBatchId),i.get(f)?S.resolve():this.remoteDocumentCache.getEntry(e,f).next(y=>{h=h.insert(f,y)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,h,d,j())).next(f=>({batchId:c,changes:bu(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O(t)).next(o=>{let r=Sn();return o.isFoundDocument()&&(r=r.insert(o.key,o)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,o,r){const i=t.collectionGroup;let a=Sn();return this.indexManager.getCollectionParents(e,i).next(c=>S.forEach(c,h=>{const d=function(g,y){return new ln(y,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(t,h.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,o,r).next(f=>{f.forEach((g,y)=>{a=a.insert(g,y)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,o,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,o.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,o,i,r))).next(a=>{i.forEach((h,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,we.newInvalidDocument(f)))});let c=Sn();return a.forEach((h,d)=>{const f=i.get(h);f!==void 0&&On(f.mutation,d,Re.empty(),ie.now()),yr(t,d)&&(c=c.insert(h,d))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $g{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return S.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,function(r){return{id:r.id,version:r.version,createTime:$e(r.createTime)}}(t)),S.resolve()}getNamedQuery(e,t){return S.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,function(r){return{name:r.name,query:kg(r.bundledQuery),readTime:$e(r.readTime)}}(t)),S.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qg{constructor(){this.overlays=new Z(O.comparator),this.Qr=new Map}getOverlay(e,t){return S.resolve(this.overlays.get(t))}getOverlays(e,t){const o=Vt();return S.forEach(t,r=>this.getOverlay(e,r).next(i=>{i!==null&&o.set(r,i)})).next(()=>o)}saveOverlays(e,t,o){return o.forEach((r,i)=>{this.St(e,t,i)}),S.resolve()}removeOverlaysForBatchId(e,t,o){const r=this.Qr.get(o);return r!==void 0&&(r.forEach(i=>this.overlays=this.overlays.remove(i)),this.Qr.delete(o)),S.resolve()}getOverlaysForCollection(e,t,o){const r=Vt(),i=t.length+1,a=new O(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const h=c.getNext().value,d=h.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===i&&h.largestBatchId>o&&r.set(h.getKey(),h)}return S.resolve(r)}getOverlaysForCollectionGroup(e,t,o,r){let i=new Z((d,f)=>d-f);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>o){let f=i.get(d.largestBatchId);f===null&&(f=Vt(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const c=Vt(),h=i.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((d,f)=>c.set(d,f)),!(c.size()>=r)););return S.resolve(c)}St(e,t,o){const r=this.overlays.get(o.key);if(r!==null){const a=this.Qr.get(r.largestBatchId).delete(o.key);this.Qr.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(o.key,new ag(t,o));let i=this.Qr.get(t);i===void 0&&(i=j(),this.Qr.set(t,i)),this.Qr.set(t,i.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{constructor(){this.sessionToken=de.EMPTY_BYTE_STRING}getSessionToken(e){return S.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,S.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{constructor(){this.$r=new ae(le.Ur),this.Kr=new ae(le.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){const o=new le(e,t);this.$r=this.$r.add(o),this.Kr=this.Kr.add(o)}Gr(e,t){e.forEach(o=>this.addReference(o,t))}removeReference(e,t){this.zr(new le(e,t))}jr(e,t){e.forEach(o=>this.removeReference(o,t))}Hr(e){const t=new O(new X([])),o=new le(t,e),r=new le(t,e+1),i=[];return this.Kr.forEachInRange([o,r],a=>{this.zr(a),i.push(a.key)}),i}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){const t=new O(new X([])),o=new le(t,e),r=new le(t,e+1);let i=j();return this.Kr.forEachInRange([o,r],a=>{i=i.add(a.key)}),i}containsKey(e){const t=new le(e,0),o=this.$r.firstAfterOrEqual(t);return o!==null&&e.isEqual(o.key)}}class le{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return O.comparator(e.key,t.key)||q(e.Zr,t.Zr)}static Wr(e,t){return q(e.Zr,t.Zr)||O.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new ae(le.Ur)}checkEmpty(e){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,o,r){const i=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new ig(i,t,o,r);this.mutationQueue.push(a);for(const c of r)this.Xr=this.Xr.add(new le(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return S.resolve(a)}lookupMutationBatch(e,t){return S.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){const o=t+1,r=this.ti(o),i=r<0?0:r;return S.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?ri:this.nr-1)}getAllMutationBatches(e){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const o=new le(t,0),r=new le(t,Number.POSITIVE_INFINITY),i=[];return this.Xr.forEachInRange([o,r],a=>{const c=this.ei(a.Zr);i.push(c)}),S.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let o=new ae(q);return t.forEach(r=>{const i=new le(r,0),a=new le(r,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([i,a],c=>{o=o.add(c.Zr)})}),S.resolve(this.ni(o))}getAllMutationBatchesAffectingQuery(e,t){const o=t.path,r=o.length+1;let i=o;O.isDocumentKey(i)||(i=i.child(""));const a=new le(new O(i),0);let c=new ae(q);return this.Xr.forEachWhile(h=>{const d=h.key.path;return!!o.isPrefixOf(d)&&(d.length===r&&(c=c.add(h.Zr)),!0)},a),S.resolve(this.ni(c))}ni(e){const t=[];return e.forEach(o=>{const r=this.ei(o);r!==null&&t.push(r)}),t}removeMutationBatch(e,t){G(this.ri(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let o=this.Xr;return S.forEach(t.mutations,r=>{const i=new le(r.key,t.batchId);return o=o.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Xr=o})}sr(e){}containsKey(e,t){const o=new le(t,0),r=this.Xr.firstAfterOrEqual(o);return S.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,S.resolve()}ri(e,t){return this.ti(e)}ti(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ei(e){const t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zg{constructor(e){this.ii=e,this.docs=function(){return new Z(O.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const o=t.key,r=this.docs.get(o),i=r?r.size:0,a=this.ii(t);return this.docs=this.docs.insert(o,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const o=this.docs.get(t);return S.resolve(o?o.document.mutableCopy():we.newInvalidDocument(t))}getEntries(e,t){let o=Ze();return t.forEach(r=>{const i=this.docs.get(r);o=o.insert(r,i?i.document.mutableCopy():we.newInvalidDocument(r))}),S.resolve(o)}getDocumentsMatchingQuery(e,t,o,r){let i=Ze();const a=t.path,c=new O(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(c);for(;h.hasNext();){const{key:d,value:{document:f}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||bf(vf(f),o)<=0||(r.has(f.key)||yr(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return S.resolve(i)}getAllFromCollectionGroup(e,t,o,r){L(9500)}si(e,t){return S.forEach(this.docs,o=>t(o))}newChangeBuffer(e){return new Hg(this)}getSize(e){return S.resolve(this.size)}}class Hg extends Bg{constructor(e){super(),this.Br=e}applyChanges(e){const t=[];return this.changes.forEach((o,r)=>{r.isValidDocument()?t.push(this.Br.addEntry(e,r)):this.Br.removeEntry(o)}),S.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wg{constructor(e){this.persistence=e,this.oi=new xt(t=>ai(t),li),this.lastRemoteSnapshotVersion=M.min(),this.highestTargetId=0,this._i=0,this.ai=new fi,this.targetCount=0,this.ui=Zt.cr()}forEachTarget(e,t){return this.oi.forEach((o,r)=>t(r)),S.resolve()}getLastRemoteSnapshotVersion(e){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return S.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(e,t,o){return o&&(this.lastRemoteSnapshotVersion=o),t>this._i&&(this._i=t),S.resolve()}Tr(e){this.oi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ui=new Zt(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,S.resolve()}updateTargetData(e,t){return this.Tr(t),S.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,S.resolve()}removeTargets(e,t,o){let r=0;const i=[];return this.oi.forEach((a,c)=>{c.sequenceNumber<=t&&o.get(c.targetId)===null&&(this.oi.delete(a),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),r++)}),S.waitFor(i).next(()=>r)}getTargetCount(e){return S.resolve(this.targetCount)}getTargetData(e,t){const o=this.oi.get(t)||null;return S.resolve(o)}addMatchingKeys(e,t,o){return this.ai.Gr(t,o),S.resolve()}removeMatchingKeys(e,t,o){this.ai.jr(t,o);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(a=>{i.push(r.markPotentiallyOrphaned(e,a))}),S.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),S.resolve()}getMatchingKeysForTargetId(e,t){const o=this.ai.Yr(t);return S.resolve(o)}containsKey(e,t){return S.resolve(this.ai.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(e,t){this.ci={},this.overlays={},this.li=new dr(0),this.hi=!1,this.hi=!0,this.Pi=new jg,this.referenceDelegate=e(this),this.Ti=new Wg(this),this.indexManager=new Vg,this.remoteDocumentCache=function(r){return new zg(r)}(o=>this.referenceDelegate.Ii(o)),this.serializer=new Pg(t),this.Ei=new $g(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new qg,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let o=this.ci[e.toKey()];return o||(o=new Yg(t,this.referenceDelegate),this.ci[e.toKey()]=o),o}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,o){N("MemoryPersistence","Starting transaction:",e);const r=new Gg(this.li.next());return this.referenceDelegate.di(),o(r).next(i=>this.referenceDelegate.Ai(r).next(()=>i)).toPromise().then(i=>(r.raiseOnCommittedEvent(),i))}Ri(e,t){return S.or(Object.values(this.ci).map(o=>()=>o.containsKey(e,t)))}}class Gg extends Ef{constructor(e){super(),this.currentSequenceNumber=e}}class gi{constructor(e){this.persistence=e,this.Vi=new fi,this.mi=null}static fi(e){return new gi(e)}get gi(){if(this.mi)return this.mi;throw L(60996)}addReference(e,t,o){return this.Vi.addReference(o,t),this.gi.delete(o.toString()),S.resolve()}removeReference(e,t,o){return this.Vi.removeReference(o,t),this.gi.add(o.toString()),S.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),S.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach(r=>this.gi.add(r.toString()));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(i=>this.gi.add(i.toString()))}).next(()=>o.removeTargetData(e,t))}di(){this.mi=new Set}Ai(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.gi,o=>{const r=O.fromPath(o);return this.pi(e,r).next(i=>{i||t.removeEntry(r,M.min())})}).next(()=>(this.mi=null,t.apply(e)))}updateLimboDocument(e,t){return this.pi(e,t).next(o=>{o?this.gi.delete(t.toString()):this.gi.add(t.toString())})}Ii(e){return 0}pi(e,t){return S.or([()=>S.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}class Jo{constructor(e,t){this.persistence=e,this.yi=new xt(o=>Cf(o.path),(o,r)=>o.isEqual(r)),this.garbageCollector=Mg(this,t)}static fi(e,t){return new Jo(e,t)}di(){}Ai(e){return S.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){const t=this.br(e);return this.persistence.getTargetCache().getTargetCount(e).next(o=>t.next(r=>o+r))}br(e){let t=0;return this.yr(e,o=>{t++}).next(()=>t)}yr(e,t){return S.forEach(this.yi,(o,r)=>this.Dr(e,o,r).next(i=>i?S.resolve():t(r)))}removeTargets(e,t,o){return this.persistence.getTargetCache().removeTargets(e,t,o)}removeOrphanedDocuments(e,t){let o=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.si(e,a=>this.Dr(e,a,t).next(c=>{c||(o++,i.removeEntry(a,M.min()))})).next(()=>i.apply(e)).next(()=>o)}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),S.resolve()}removeTarget(e,t){const o=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,o)}addReference(e,t,o){return this.yi.set(o,e.currentSequenceNumber),S.resolve()}removeReference(e,t,o){return this.yi.set(o,e.currentSequenceNumber),S.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),S.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Oo(e.data.value)),t}Dr(e,t,o){return S.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const r=this.yi.get(t);return S.resolve(r!==void 0&&r>o)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi{constructor(e,t,o,r){this.targetId=e,this.fromCache=t,this.ds=o,this.As=r}static Rs(e,t){let o=j(),r=j();for(const i of t.docChanges)switch(i.type){case 0:o=o.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new pi(e,t.fromCache,o,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qg{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=function(){return jd()?8:If($d())>0?6:4}()}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,o,r){const i={result:null};return this.ws(e,t).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.bs(e,t,r,o).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new Kg;return this.Ss(e,t,a).next(c=>{if(i.result=c,this.fs)return this.Ds(e,t,a,c.size)})}).next(()=>i.result)}Ds(e,t,o,r){return o.documentReadCount<this.gs?(jt()<=z.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",Yt(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),S.resolve()):(jt()<=z.DEBUG&&N("QueryEngine","Query:",Yt(t),"scans",o.documentReadCount,"local documents and returns",r,"documents as results."),o.documentReadCount>this.ps*r?(jt()<=z.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",Yt(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ue(t))):S.resolve())}ws(e,t){if(Pl(t))return S.resolve(null);let o=Ue(t);return this.indexManager.getIndexType(e,o).next(r=>r===0?null:(t.limit!==null&&r===1&&(t=Ls(t,null,"F"),o=Ue(t)),this.indexManager.getDocumentsMatchingTarget(e,o).next(i=>{const a=j(...i);return this.ys.getDocuments(e,a).next(c=>this.indexManager.getMinOffset(e,o).next(h=>{const d=this.vs(t,c);return this.Cs(t,d,a,h.readTime)?this.ws(e,Ls(t,null,"F")):this.Fs(e,d,t,h)}))})))}bs(e,t,o,r){return Pl(t)||r.isEqual(M.min())?S.resolve(null):this.ys.getDocuments(e,o).next(i=>{const a=this.vs(t,i);return this.Cs(t,a,o,r)?S.resolve(null):(jt()<=z.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Yt(t)),this.Fs(e,a,t,_f(r,Fn)).next(c=>c))})}vs(e,t){let o=new ae(_u(e));return t.forEach((r,i)=>{yr(e,i)&&(o=o.add(i))}),o}Cs(e,t,o,r){if(e.limit===null)return!1;if(o.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,o){return jt()<=z.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Yt(t)),this.ys.getDocumentsMatchingQuery(e,t,ht.min(),o)}Fs(e,t,o,r){return this.ys.getDocumentsMatchingQuery(e,o,r).next(i=>(t.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yi="LocalStore",Xg=3e8;class Jg{constructor(e,t,o,r){this.persistence=e,this.Ms=t,this.serializer=r,this.xs=new Z(q),this.Os=new xt(i=>ai(i),li),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(o)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ug(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.xs))}}function Zg(n,e,t,o){return new Jg(n,e,t,o)}async function ju(n,e){const t=F(n);return await t.persistence.runTransaction("Handle user change","readonly",o=>{let r;return t.mutationQueue.getAllMutationBatches(o).next(i=>(r=i,t.Ls(e),t.mutationQueue.getAllMutationBatches(o))).next(i=>{const a=[],c=[];let h=j();for(const d of r){a.push(d.batchId);for(const f of d.mutations)h=h.add(f.key)}for(const d of i){c.push(d.batchId);for(const f of d.mutations)h=h.add(f.key)}return t.localDocuments.getDocuments(o,h).next(d=>({ks:d,removedBatchIds:a,addedBatchIds:c}))})})}function ep(n,e){const t=F(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",o=>{const r=e.batch.keys(),i=t.Bs.newChangeBuffer({trackRemovals:!0});return function(c,h,d,f){const g=d.batch,y=g.keys();let A=S.resolve();return y.forEach(P=>{A=A.next(()=>f.getEntry(h,P)).next(V=>{const k=d.docVersions.get(P);G(k!==null,48541),V.version.compareTo(k)<0&&(g.applyToRemoteDocument(V,d),V.isValidDocument()&&(V.setReadTime(d.commitVersion),f.addEntry(V)))})}),A.next(()=>c.mutationQueue.removeMutationBatch(h,g))}(t,o,e,i).next(()=>i.apply(o)).next(()=>t.mutationQueue.performConsistencyCheck(o)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(o,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,function(c){let h=j();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(h=h.add(c.batch.mutations[d].key));return h}(e))).next(()=>t.localDocuments.getDocuments(o,r))})}function Yu(n){const e=F(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ti.getLastRemoteSnapshotVersion(t))}function tp(n,e){const t=F(n),o=e.snapshotVersion;let r=t.xs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=t.Bs.newChangeBuffer({trackRemovals:!0});r=t.xs;const c=[];e.targetChanges.forEach((f,g)=>{const y=r.get(g);if(!y)return;c.push(t.Ti.removeMatchingKeys(i,f.removedDocuments,g).next(()=>t.Ti.addMatchingKeys(i,f.addedDocuments,g)));let A=y.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(g)!==null?A=A.withResumeToken(de.EMPTY_BYTE_STRING,M.min()).withLastLimboFreeSnapshotVersion(M.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,o)),r=r.insert(g,A),function(V,k,U){return V.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=Xg?!0:U.addedDocuments.size+U.modifiedDocuments.size+U.removedDocuments.size>0}(y,A,f)&&c.push(t.Ti.updateTargetData(i,A))});let h=Ze(),d=j();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))}),c.push(np(i,a,e.documentUpdates).next(f=>{h=f.qs,d=f.Qs})),!o.isEqual(M.min())){const f=t.Ti.getLastRemoteSnapshotVersion(i).next(g=>t.Ti.setTargetsMetadata(i,i.currentSequenceNumber,o));c.push(f)}return S.waitFor(c).next(()=>a.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,h,d)).next(()=>h)}).then(i=>(t.xs=r,i))}function np(n,e,t){let o=j(),r=j();return t.forEach(i=>o=o.add(i)),e.getEntries(n,o).next(i=>{let a=Ze();return t.forEach((c,h)=>{const d=i.get(c);h.isFoundDocument()!==d.isFoundDocument()&&(r=r.add(c)),h.isNoDocument()&&h.version.isEqual(M.min())?(e.removeEntry(c,h.readTime),a=a.insert(c,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(h),a=a.insert(c,h)):N(yi,"Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",h.version)}),{qs:a,Qs:r}})}function op(n,e){const t=F(n);return t.persistence.runTransaction("Get next mutation batch","readonly",o=>(e===void 0&&(e=ri),t.mutationQueue.getNextMutationBatchAfterBatchId(o,e)))}function rp(n,e){const t=F(n);return t.persistence.runTransaction("Allocate target","readwrite",o=>{let r;return t.Ti.getTargetData(o,e).next(i=>i?(r=i,S.resolve(r)):t.Ti.allocateTargetId(o).next(a=>(r=new it(e,a,"TargetPurposeListen",o.currentSequenceNumber),t.Ti.addTargetData(o,r).next(()=>r))))}).then(o=>{const r=t.xs.get(o.targetId);return(r===null||o.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.xs=t.xs.insert(o.targetId,o),t.Os.set(e,o.targetId)),o})}async function $s(n,e,t){const o=F(n),r=o.xs.get(e),i=t?"readwrite":"readwrite-primary";try{t||await o.persistence.runTransaction("Release target",i,a=>o.persistence.referenceDelegate.removeTarget(a,r))}catch(a){if(!an(a))throw a;N(yi,`Failed to update sequence numbers for target ${e}: ${a}`)}o.xs=o.xs.remove(e),o.Os.delete(r.target)}function ql(n,e,t){const o=F(n);let r=M.min(),i=j();return o.persistence.runTransaction("Execute query","readwrite",a=>function(h,d,f){const g=F(h),y=g.Os.get(f);return y!==void 0?S.resolve(g.xs.get(y)):g.Ti.getTargetData(d,f)}(o,a,Ue(e)).next(c=>{if(c)return r=c.lastLimboFreeSnapshotVersion,o.Ti.getMatchingKeysForTargetId(a,c.targetId).next(h=>{i=h})}).next(()=>o.Ms.getDocumentsMatchingQuery(a,e,t?r:M.min(),t?i:j())).next(c=>(sp(o,zf(e),c),{documents:c,$s:i})))}function sp(n,e,t){let o=n.Ns.get(e)||M.min();t.forEach((r,i)=>{i.readTime.compareTo(o)>0&&(o=i.readTime)}),n.Ns.set(e,o)}class jl{constructor(){this.activeTargetIds=Xf()}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ip{constructor(){this.xo=new jl,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,o){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,o){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new jl,Promise.resolve()}handleUserChange(e,t,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ap{No(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yl="ConnectivityMonitor";class zl{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){N(Yl,"Network connectivity changed: AVAILABLE");for(const e of this.Qo)e(0)}qo(){N(Yl,"Network connectivity changed: UNAVAILABLE");for(const e of this.Qo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let No=null;function qs(){return No===null?No=function(){return 268435456+Math.round(2147483648*Math.random())}():No++,"0x"+No.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ms="RestConnection",lp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class cp{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",o=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${o}/databases/${r}`,this.Go=this.databaseId.database===Wo?`project_id=${o}`:`project_id=${o}&database_id=${r}`}zo(e,t,o,r,i){const a=qs(),c=this.jo(e,t.toUriEncodedString());N(ms,`Sending RPC '${e}' ${a}:`,c,o);const h={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(h,r,i);const{host:d}=new URL(c),f=ti(d);return this.Jo(e,c,h,o,f).then(g=>(N(ms,`Received RPC '${e}' ${a}: `,g),g),g=>{throw Kt(ms,`RPC '${e}' ${a} failed with error: `,g,"url: ",c,"request:",o),g})}Yo(e,t,o,r,i,a){return this.zo(e,t,o,r,i)}Ho(e,t,o){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+rn}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,i)=>e[i]=r),o&&o.headers.forEach((r,i)=>e[i]=r)}jo(e,t){const o=lp[e];return`${this.Ko}/v1/${t}:${o}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class up{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pe="WebChannelConnection";class hp extends cp{constructor(e){super(e),this.l_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,o,r,i){const a=qs();return new Promise((c,h)=>{const d=new Hc;d.setWithCredentials(!0),d.listenOnce(Wc.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case xo.NO_ERROR:const g=d.getResponseJson();N(pe,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(g)),c(g);break;case xo.TIMEOUT:N(pe,`RPC '${e}' ${a} timed out`),h(new x(R.DEADLINE_EXCEEDED,"Request time out"));break;case xo.HTTP_ERROR:const y=d.getStatus();if(N(pe,`RPC '${e}' ${a} failed with status:`,y,"response text:",d.getResponseText()),y>0){let A=d.getResponseJson();Array.isArray(A)&&(A=A[0]);const P=A==null?void 0:A.error;if(P&&P.status&&P.message){const V=function(U){const B=U.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(B)>=0?B:R.UNKNOWN}(P.status);h(new x(V,P.message))}else h(new x(R.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new x(R.UNAVAILABLE,"Connection failed."));break;default:L(9055,{h_:e,streamId:a,P_:d.getLastErrorCode(),T_:d.getLastError()})}}finally{N(pe,`RPC '${e}' ${a} completed.`)}});const f=JSON.stringify(r);N(pe,`RPC '${e}' ${a} sending request:`,r),d.send(t,"POST",f,o,15)})}I_(e,t,o){const r=qs(),i=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Qc(),c=Kc(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.Ho(h.initMessageHeaders,t,o),h.encodeInitMessageHeaders=!0;const f=i.join("");N(pe,`Creating RPC '${e}' stream ${r}: ${f}`,h);const g=a.createWebChannel(f,h);this.E_(g);let y=!1,A=!1;const P=new up({Zo:k=>{A?N(pe,`Not sending because RPC '${e}' stream ${r} is closed:`,k):(y||(N(pe,`Opening RPC '${e}' stream ${r} transport.`),g.open(),y=!0),N(pe,`RPC '${e}' stream ${r} sending:`,k),g.send(k))},Xo:()=>g.close()}),V=(k,U,B)=>{k.listen(U,$=>{try{B($)}catch(J){setTimeout(()=>{throw J},0)}})};return V(g,Rn.EventType.OPEN,()=>{A||(N(pe,`RPC '${e}' stream ${r} transport opened.`),P.__())}),V(g,Rn.EventType.CLOSE,()=>{A||(A=!0,N(pe,`RPC '${e}' stream ${r} transport closed`),P.u_(),this.d_(g))}),V(g,Rn.EventType.ERROR,k=>{A||(A=!0,Kt(pe,`RPC '${e}' stream ${r} transport errored. Name:`,k.name,"Message:",k.message),P.u_(new x(R.UNAVAILABLE,"The operation could not be completed")))}),V(g,Rn.EventType.MESSAGE,k=>{var U;if(!A){const B=k.data[0];G(!!B,16349);const $=B,J=($==null?void 0:$.error)||((U=$[0])===null||U===void 0?void 0:U.error);if(J){N(pe,`RPC '${e}' stream ${r} received error:`,J);const Se=J.status;let ne=function(w){const v=oe[w];if(v!==void 0)return Vu(v)}(Se),T=J.message;ne===void 0&&(ne=R.INTERNAL,T="Unknown error status: "+Se+" with message "+J.message),A=!0,P.u_(new x(ne,T)),g.close()}else N(pe,`RPC '${e}' stream ${r} received:`,B),P.c_(B)}}),V(c,Gc.STAT_EVENT,k=>{k.stat===Ps.PROXY?N(pe,`RPC '${e}' stream ${r} detected buffering proxy`):k.stat===Ps.NOPROXY&&N(pe,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{P.a_()},0),P}terminate(){this.l_.forEach(e=>e.close()),this.l_=[]}E_(e){this.l_.push(e)}d_(e){this.l_=this.l_.filter(t=>t===e)}}function fs(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function br(n){return new gg(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zu{constructor(e,t,o=1e3,r=1.5,i=6e4){this.xi=e,this.timerId=t,this.A_=o,this.R_=r,this.V_=i,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(e){this.cancel();const t=Math.floor(this.m_+this.w_()),o=Math.max(0,Date.now()-this.g_),r=Math.max(0,t-o);r>0&&N("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.m_} ms, delay with jitter: ${t} ms, last attempt: ${o} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,r,()=>(this.g_=Date.now(),e())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){this.f_!==null&&(this.f_.skipDelay(),this.f_=null)}cancel(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hl="PersistentStream";class Hu{constructor(e,t,o,r,i,a,c,h){this.xi=e,this.S_=o,this.D_=r,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=h,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new zu(e,t)}O_(){return this.state===1||this.state===5||this.N_()}N_(){return this.state===2||this.state===3}start(){this.M_=0,this.state!==4?this.auth():this.B_()}async stop(){this.O_()&&await this.close(0)}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&this.C_===null&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,()=>this.q_()))}Q_(e){this.U_(),this.stream.send(e)}async q_(){if(this.N_())return this.close(0)}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}async close(e,t){this.U_(),this.K_(),this.x_.cancel(),this.v_++,e!==4?this.x_.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(Je(t.toString()),Je("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(t)}W_(){}auth(){this.state=1;const e=this.G_(this.v_),t=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([o,r])=>{this.v_===t&&this.z_(o,r)},o=>{e(()=>{const r=new x(R.UNKNOWN,"Fetching auth token failed: "+o.message);return this.j_(r)})})}z_(e,t){const o=this.G_(this.v_);this.stream=this.H_(e,t),this.stream.e_(()=>{o(()=>this.listener.e_())}),this.stream.n_(()=>{o(()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,()=>(this.N_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(r=>{o(()=>this.j_(r))}),this.stream.onMessage(r=>{o(()=>++this.M_==1?this.J_(r):this.onNext(r))})}B_(){this.state=5,this.x_.y_(async()=>{this.state=0,this.start()})}j_(e){return N(Hl,`close with error: ${e}`),this.stream=null,this.close(4,e)}G_(e){return t=>{this.xi.enqueueAndForget(()=>this.v_===e?t():(N(Hl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class dp extends Hu{constructor(e,t,o,r,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,o,r,a),this.serializer=i}H_(e,t){return this.connection.I_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.x_.reset();const t=wg(this.serializer,e),o=function(i){if(!("targetChange"in i))return M.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?M.min():a.readTime?$e(a.readTime):M.min()}(e);return this.listener.Y_(t,o)}Z_(e){const t={};t.database=Us(this.serializer),t.addTarget=function(i,a){let c;const h=a.target;if(c=xs(h)?{documents:bg(i,h)}:{query:Tg(i,h).gt},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=xu(i,a.resumeToken);const d=Ms(i,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo(M.min())>0){c.readTime=Xo(i,a.snapshotVersion.toTimestamp());const d=Ms(i,a.expectedCount);d!==null&&(c.expectedCount=d)}return c}(this.serializer,e);const o=Ig(this.serializer,e);o&&(t.labels=o),this.Q_(t)}X_(e){const t={};t.database=Us(this.serializer),t.removeTarget=e,this.Q_(t)}}class mp extends Hu{constructor(e,t,o,r,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,o,r,a),this.serializer=i}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(e,t){return this.connection.I_("Write",e,t)}J_(e){return G(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,G(!e.writeResults||e.writeResults.length===0,55816),this.listener.na()}onNext(e){G(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.x_.reset();const t=vg(e.writeResults,e.commitTime),o=$e(e.commitTime);return this.listener.ra(o,t)}ia(){const e={};e.database=Us(this.serializer),this.Q_(e)}ta(e){const t={streamToken:this.lastStreamToken,writes:e.map(o=>_g(this.serializer,o))};this.Q_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fp{}class gp extends fp{constructor(e,t,o,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=o,this.serializer=r,this.sa=!1}oa(){if(this.sa)throw new x(R.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,o,r){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.zo(e,Bs(t,o),r,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new x(R.UNKNOWN,i.toString())})}Yo(e,t,o,r,i){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Yo(e,Bs(t,o),r,a,c,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new x(R.UNKNOWN,a.toString())})}terminate(){this.sa=!0,this.connection.terminate()}}class pp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){this._a===0&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(e){this.state==="Online"?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.la("Offline")))}set(e){this.Ta(),this._a=0,e==="Online"&&(this.ua=!1),this.la(e)}la(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ha(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(Je(t),this.ua=!1):N("OnlineStateTracker",t)}Ta(){this.aa!==null&&(this.aa.cancel(),this.aa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nt="RemoteStore";class yp{constructor(e,t,o,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=o,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=i,this.Ra.No(a=>{o.enqueueAndForget(async()=>{Ot(this)&&(N(Nt,"Restarting streams for network reachability change."),await async function(h){const d=F(h);d.da.add(4),await no(d),d.Va.set("Unknown"),d.da.delete(4),await Tr(d)}(this))})}),this.Va=new pp(o,r)}}async function Tr(n){if(Ot(n))for(const e of n.Aa)await e(!0)}async function no(n){for(const e of n.Aa)await e(!1)}function Wu(n,e){const t=F(n);t.Ea.has(e.targetId)||(t.Ea.set(e.targetId,e),bi(t)?vi(t):cn(t).N_()&&_i(t,e))}function wi(n,e){const t=F(n),o=cn(t);t.Ea.delete(e),o.N_()&&Gu(t,e),t.Ea.size===0&&(o.N_()?o.k_():Ot(t)&&t.Va.set("Unknown"))}function _i(n,e){if(n.ma.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(M.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}cn(n).Z_(e)}function Gu(n,e){n.ma.Ke(e),cn(n).X_(e)}function vi(n){n.ma=new hg({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>n.Ea.get(e)||null,Pt:()=>n.datastore.serializer.databaseId}),cn(n).start(),n.Va.ca()}function bi(n){return Ot(n)&&!cn(n).O_()&&n.Ea.size>0}function Ot(n){return F(n).da.size===0}function Ku(n){n.ma=void 0}async function wp(n){n.Va.set("Online")}async function _p(n){n.Ea.forEach((e,t)=>{_i(n,e)})}async function vp(n,e){Ku(n),bi(n)?(n.Va.Pa(e),vi(n)):n.Va.set("Unknown")}async function bp(n,e,t){if(n.Va.set("Online"),e instanceof Nu&&e.state===2&&e.cause)try{await async function(r,i){const a=i.cause;for(const c of i.targetIds)r.Ea.has(c)&&(await r.remoteSyncer.rejectListen(c,a),r.Ea.delete(c),r.ma.removeTarget(c))}(n,e)}catch(o){N(Nt,"Failed to remove targets %s: %s ",e.targetIds.join(","),o),await Zo(n,o)}else if(e instanceof Bo?n.ma.Xe(e):e instanceof Du?n.ma.ot(e):n.ma.nt(e),!t.isEqual(M.min()))try{const o=await Yu(n.localStore);t.compareTo(o)>=0&&await function(i,a){const c=i.ma.It(a);return c.targetChanges.forEach((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const f=i.Ea.get(d);f&&i.Ea.set(d,f.withResumeToken(h.resumeToken,a))}}),c.targetMismatches.forEach((h,d)=>{const f=i.Ea.get(h);if(!f)return;i.Ea.set(h,f.withResumeToken(de.EMPTY_BYTE_STRING,f.snapshotVersion)),Gu(i,h);const g=new it(f.target,h,d,f.sequenceNumber);_i(i,g)}),i.remoteSyncer.applyRemoteEvent(c)}(n,t)}catch(o){N(Nt,"Failed to raise snapshot:",o),await Zo(n,o)}}async function Zo(n,e,t){if(!an(e))throw e;n.da.add(1),await no(n),n.Va.set("Offline"),t||(t=()=>Yu(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{N(Nt,"Retrying IndexedDB access"),await t(),n.da.delete(1),await Tr(n)})}function Qu(n,e){return e().catch(t=>Zo(n,t,e))}async function Er(n){const e=F(n),t=gt(e);let o=e.Ia.length>0?e.Ia[e.Ia.length-1].batchId:ri;for(;Tp(e);)try{const r=await op(e.localStore,o);if(r===null){e.Ia.length===0&&t.k_();break}o=r.batchId,Ep(e,r)}catch(r){await Zo(e,r)}Xu(e)&&Ju(e)}function Tp(n){return Ot(n)&&n.Ia.length<10}function Ep(n,e){n.Ia.push(e);const t=gt(n);t.N_()&&t.ea&&t.ta(e.mutations)}function Xu(n){return Ot(n)&&!gt(n).O_()&&n.Ia.length>0}function Ju(n){gt(n).start()}async function Ip(n){gt(n).ia()}async function Ap(n){const e=gt(n);for(const t of n.Ia)e.ta(t.mutations)}async function Cp(n,e,t){const o=n.Ia.shift(),r=hi.from(o,e,t);await Qu(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),await Er(n)}async function Rp(n,e){e&&gt(n).ea&&await async function(o,r){if(function(a){return cg(a)&&a!==R.ABORTED}(r.code)){const i=o.Ia.shift();gt(o).L_(),await Qu(o,()=>o.remoteSyncer.rejectFailedWrite(i.batchId,r)),await Er(o)}}(n,e),Xu(n)&&Ju(n)}async function Wl(n,e){const t=F(n);t.asyncQueue.verifyOperationInProgress(),N(Nt,"RemoteStore received new credentials");const o=Ot(t);t.da.add(3),await no(t),o&&t.Va.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.da.delete(3),await Tr(t)}async function Sp(n,e){const t=F(n);e?(t.da.delete(2),await Tr(t)):e||(t.da.add(2),await no(t),t.Va.set("Unknown"))}function cn(n){return n.fa||(n.fa=function(t,o,r){const i=F(t);return i.oa(),new dp(o,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{e_:wp.bind(null,n),n_:_p.bind(null,n),i_:vp.bind(null,n),Y_:bp.bind(null,n)}),n.Aa.push(async e=>{e?(n.fa.L_(),bi(n)?vi(n):n.Va.set("Unknown")):(await n.fa.stop(),Ku(n))})),n.fa}function gt(n){return n.ga||(n.ga=function(t,o,r){const i=F(t);return i.oa(),new mp(o,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,r)}(n.datastore,n.asyncQueue,{e_:()=>Promise.resolve(),n_:Ip.bind(null,n),i_:Rp.bind(null,n),na:Ap.bind(null,n),ra:Cp.bind(null,n)}),n.Aa.push(async e=>{e?(n.ga.L_(),await Er(n)):(await n.ga.stop(),n.Ia.length>0&&(N(Nt,`Stopping write stream with ${n.Ia.length} pending writes`),n.Ia=[]))})),n.ga}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ti{constructor(e,t,o,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=o,this.op=r,this.removalCallback=i,this.deferred=new Qe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,o,r,i){const a=Date.now()+o,c=new Ti(e,t,a,r,i);return c.start(o),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ei(n,e){if(Je("AsyncQueue",`${e}: ${n}`),an(n))return new x(R.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{static emptySet(e){return new Gt(e.comparator)}constructor(e){this.comparator=e?(t,o)=>e(t,o)||O.comparator(t.key,o.key):(t,o)=>O.comparator(t.key,o.key),this.keyedMap=Sn(),this.sortedSet=new Z(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,o)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Gt)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,i=o.getNext().key;if(!r.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const o=new Gt;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=t,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gl{constructor(){this.pa=new Z(O.comparator)}track(e){const t=e.doc.key,o=this.pa.get(t);o?e.type!==0&&o.type===3?this.pa=this.pa.insert(t,e):e.type===3&&o.type!==1?this.pa=this.pa.insert(t,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.pa=this.pa.insert(t,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.pa=this.pa.remove(t):e.type===1&&o.type===2?this.pa=this.pa.insert(t,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.pa=this.pa.insert(t,{type:2,doc:e.doc}):L(63341,{Vt:e,ya:o}):this.pa=this.pa.insert(t,e)}wa(){const e=[];return this.pa.inorderTraversal((t,o)=>{e.push(o)}),e}}class en{constructor(e,t,o,r,i,a,c,h,d){this.query=e,this.docs=t,this.oldDocs=o,this.docChanges=r,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(e,t,o,r,i){const a=[];return t.forEach(c=>{a.push({type:0,doc:c})}),new en(e,t,Gt.emptySet(t),a,o,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&pr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,o=e.docChanges;if(t.length!==o.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==o[r].type||!t[r].doc.isEqual(o[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pp{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some(e=>e.va())}}class kp{constructor(){this.queries=Kl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,o){const r=F(t),i=r.queries;r.queries=Kl(),i.forEach((a,c)=>{for(const h of c.Sa)h.onError(o)})})(this,new x(R.ABORTED,"Firestore shutting down"))}}function Kl(){return new xt(n=>wu(n),pr)}async function Ii(n,e){const t=F(n);let o=3;const r=e.query;let i=t.queries.get(r);i?!i.Da()&&e.va()&&(o=2):(i=new Pp,o=e.va()?0:1);try{switch(o){case 0:i.ba=await t.onListen(r,!0);break;case 1:i.ba=await t.onListen(r,!1);break;case 2:await t.onFirstRemoteStoreListen(r)}}catch(a){const c=Ei(a,`Initialization of query '${Yt(e.query)}' failed`);return void e.onError(c)}t.queries.set(r,i),i.Sa.push(e),e.Fa(t.onlineState),i.ba&&e.Ma(i.ba)&&Ci(t)}async function Ai(n,e){const t=F(n),o=e.query;let r=3;const i=t.queries.get(o);if(i){const a=i.Sa.indexOf(e);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?r=e.va()?0:1:!i.Da()&&e.va()&&(r=2))}switch(r){case 0:return t.queries.delete(o),t.onUnlisten(o,!0);case 1:return t.queries.delete(o),t.onUnlisten(o,!1);case 2:return t.onLastRemoteStoreUnlisten(o);default:return}}function Vp(n,e){const t=F(n);let o=!1;for(const r of e){const i=r.query,a=t.queries.get(i);if(a){for(const c of a.Sa)c.Ma(r)&&(o=!0);a.ba=r}}o&&Ci(t)}function Dp(n,e,t){const o=F(n),r=o.queries.get(e);if(r)for(const i of r.Sa)i.onError(t);o.queries.delete(e)}function Ci(n){n.Ca.forEach(e=>{e.next()})}var js,Ql;(Ql=js||(js={})).xa="default",Ql.Cache="cache";class Ri{constructor(e,t,o){this.query=e,this.Oa=t,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=o||{}}Ma(e){if(!this.options.includeMetadataChanges){const o=[];for(const r of e.docChanges)r.type!==3&&o.push(r);e=new en(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Na?this.La(e)&&(this.Oa.next(e),t=!0):this.ka(e,this.onlineState)&&(this.qa(e),t=!0),this.Ba=e,t}onError(e){this.Oa.error(e)}Fa(e){this.onlineState=e;let t=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,e)&&(this.qa(this.Ba),t=!0),t}ka(e,t){if(!e.fromCache||!this.va())return!0;const o=t!=="Offline";return(!this.options.Qa||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}La(e){if(e.docChanges.length>0)return!0;const t=this.Ba&&this.Ba.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}qa(e){e=en.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Na=!0,this.Oa.next(e)}va(){return this.options.source!==js.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e){this.key=e}}class eh{constructor(e){this.key=e}}class Np{constructor(e,t){this.query=e,this.Ha=t,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=j(),this.mutatedKeys=j(),this.Za=_u(e),this.Xa=new Gt(this.Za)}get eu(){return this.Ha}tu(e,t){const o=t?t.nu:new Gl,r=t?t.Xa:this.Xa;let i=t?t.mutatedKeys:this.mutatedKeys,a=r,c=!1;const h=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,d=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((f,g)=>{const y=r.get(f),A=yr(this.query,g)?g:null,P=!!y&&this.mutatedKeys.has(y.key),V=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let k=!1;y&&A?y.data.isEqual(A.data)?P!==V&&(o.track({type:3,doc:A}),k=!0):this.ru(y,A)||(o.track({type:2,doc:A}),k=!0,(h&&this.Za(A,h)>0||d&&this.Za(A,d)<0)&&(c=!0)):!y&&A?(o.track({type:0,doc:A}),k=!0):y&&!A&&(o.track({type:1,doc:y}),k=!0,(h||d)&&(c=!0)),k&&(A?(a=a.add(A),i=V?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),o.track({type:1,doc:f})}return{Xa:a,nu:o,Cs:c,mutatedKeys:i}}ru(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,o,r){const i=this.Xa;this.Xa=e.Xa,this.mutatedKeys=e.mutatedKeys;const a=e.nu.wa();a.sort((f,g)=>function(A,P){const V=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{Vt:k})}};return V(A)-V(P)}(f.type,g.type)||this.Za(f.doc,g.doc)),this.iu(o),r=r!=null&&r;const c=t&&!r?this.su():[],h=this.Ya.size===0&&this.current&&!r?1:0,d=h!==this.Ja;return this.Ja=h,a.length!==0||d?{snapshot:new en(this.query,e.Xa,i,a,e.mutatedKeys,h===0,d,!1,!!o&&o.resumeToken.approximateByteSize()>0),ou:c}:{ou:c}}Fa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new Gl,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(e){return!this.Ha.has(e)&&!!this.Xa.has(e)&&!this.Xa.get(e).hasLocalMutations}iu(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}su(){if(!this.current)return[];const e=this.Ya;this.Ya=j(),this.Xa.forEach(o=>{this._u(o.key)&&(this.Ya=this.Ya.add(o.key))});const t=[];return e.forEach(o=>{this.Ya.has(o)||t.push(new eh(o))}),this.Ya.forEach(o=>{e.has(o)||t.push(new Zu(o))}),t}au(e){this.Ha=e.$s,this.Ya=j();const t=this.tu(e.documents);return this.applyChanges(t,!0)}uu(){return en.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,this.Ja===0,this.hasCachedResults)}}const Si="SyncEngine";class xp{constructor(e,t,o){this.query=e,this.targetId=t,this.view=o}}class Op{constructor(e){this.key=e,this.cu=!1}}class Lp{constructor(e,t,o,r,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=o,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.lu={},this.hu=new xt(c=>wu(c),pr),this.Pu=new Map,this.Tu=new Set,this.Iu=new Z(O.comparator),this.Eu=new Map,this.du=new fi,this.Au={},this.Ru=new Map,this.Vu=Zt.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return this.mu===!0}}async function Mp(n,e,t=!0){const o=ih(n);let r;const i=o.hu.get(e);return i?(o.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.uu()):r=await th(o,e,t,!0),r}async function Bp(n,e){const t=ih(n);await th(t,e,!0,!1)}async function th(n,e,t,o){const r=await rp(n.localStore,Ue(e)),i=r.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let c;return o&&(c=await Fp(n,e,i,a==="current",r.resumeToken)),n.isPrimaryClient&&t&&Wu(n.remoteStore,r),c}async function Fp(n,e,t,o,r){n.fu=(g,y,A)=>async function(V,k,U,B){let $=k.view.tu(U);$.Cs&&($=await ql(V.localStore,k.query,!1).then(({documents:T})=>k.view.tu(T,$)));const J=B&&B.targetChanges.get(k.targetId),Se=B&&B.targetMismatches.get(k.targetId)!=null,ne=k.view.applyChanges($,V.isPrimaryClient,J,Se);return Jl(V,k.targetId,ne.ou),ne.snapshot}(n,g,y,A);const i=await ql(n.localStore,e,!0),a=new Np(e,i.$s),c=a.tu(i.documents),h=to.createSynthesizedTargetChangeForCurrentChange(t,o&&n.onlineState!=="Offline",r),d=a.applyChanges(c,n.isPrimaryClient,h);Jl(n,t,d.ou);const f=new xp(e,t,a);return n.hu.set(e,f),n.Pu.has(t)?n.Pu.get(t).push(e):n.Pu.set(t,[e]),d.snapshot}async function Up(n,e,t){const o=F(n),r=o.hu.get(e),i=o.Pu.get(r.targetId);if(i.length>1)return o.Pu.set(r.targetId,i.filter(a=>!pr(a,e))),void o.hu.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(r.targetId),o.sharedClientState.isActiveQueryTarget(r.targetId)||await $s(o.localStore,r.targetId,!1).then(()=>{o.sharedClientState.clearQueryState(r.targetId),t&&wi(o.remoteStore,r.targetId),Ys(o,r.targetId)}).catch(sn)):(Ys(o,r.targetId),await $s(o.localStore,r.targetId,!0))}async function $p(n,e){const t=F(n),o=t.hu.get(e),r=t.Pu.get(o.targetId);t.isPrimaryClient&&r.length===1&&(t.sharedClientState.removeLocalQueryTarget(o.targetId),wi(t.remoteStore,o.targetId))}async function qp(n,e,t){const o=Kp(n);try{const r=await function(a,c){const h=F(a),d=ie.now(),f=c.reduce((A,P)=>A.add(P.key),j());let g,y;return h.persistence.runTransaction("Locally write mutations","readwrite",A=>{let P=Ze(),V=j();return h.Bs.getEntries(A,f).next(k=>{P=k,P.forEach((U,B)=>{B.isValidDocument()||(V=V.add(U))})}).next(()=>h.localDocuments.getOverlayedDocuments(A,P)).next(k=>{g=k;const U=[];for(const B of c){const $=rg(B,g.get(B.key).overlayedDocument);$!=null&&U.push(new vt(B.key,$,uu($.value.mapValue),Le.exists(!0)))}return h.mutationQueue.addMutationBatch(A,d,U,c)}).next(k=>{y=k;const U=k.applyToLocalDocumentSet(g,V);return h.documentOverlayCache.saveOverlays(A,k.batchId,U)})}).then(()=>({batchId:y.batchId,changes:bu(g)}))}(o.localStore,e);o.sharedClientState.addPendingMutation(r.batchId),function(a,c,h){let d=a.Au[a.currentUser.toKey()];d||(d=new Z(q)),d=d.insert(c,h),a.Au[a.currentUser.toKey()]=d}(o,r.batchId,t),await oo(o,r.changes),await Er(o.remoteStore)}catch(r){const i=Ei(r,"Failed to persist write");t.reject(i)}}async function nh(n,e){const t=F(n);try{const o=await tp(t.localStore,e);e.targetChanges.forEach((r,i)=>{const a=t.Eu.get(i);a&&(G(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?a.cu=!0:r.modifiedDocuments.size>0?G(a.cu,14607):r.removedDocuments.size>0&&(G(a.cu,42227),a.cu=!1))}),await oo(t,o,e)}catch(o){await sn(o)}}function Xl(n,e,t){const o=F(n);if(o.isPrimaryClient&&t===0||!o.isPrimaryClient&&t===1){const r=[];o.hu.forEach((i,a)=>{const c=a.view.Fa(e);c.snapshot&&r.push(c.snapshot)}),function(a,c){const h=F(a);h.onlineState=c;let d=!1;h.queries.forEach((f,g)=>{for(const y of g.Sa)y.Fa(c)&&(d=!0)}),d&&Ci(h)}(o.eventManager,e),r.length&&o.lu.Y_(r),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function jp(n,e,t){const o=F(n);o.sharedClientState.updateQueryState(e,"rejected",t);const r=o.Eu.get(e),i=r&&r.key;if(i){let a=new Z(O.comparator);a=a.insert(i,we.newNoDocument(i,M.min()));const c=j().add(i),h=new vr(M.min(),new Map,new Z(q),a,c);await nh(o,h),o.Iu=o.Iu.remove(i),o.Eu.delete(e),Pi(o)}else await $s(o.localStore,e,!1).then(()=>Ys(o,e,t)).catch(sn)}async function Yp(n,e){const t=F(n),o=e.batch.batchId;try{const r=await ep(t.localStore,e);rh(t,o,null),oh(t,o),t.sharedClientState.updateMutationState(o,"acknowledged"),await oo(t,r)}catch(r){await sn(r)}}async function zp(n,e,t){const o=F(n);try{const r=await function(a,c){const h=F(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return h.mutationQueue.lookupMutationBatch(d,c).next(g=>(G(g!==null,37113),f=g.keys(),h.mutationQueue.removeMutationBatch(d,g))).next(()=>h.mutationQueue.performConsistencyCheck(d)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(d,f,c)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>h.localDocuments.getDocuments(d,f))})}(o.localStore,e);rh(o,e,t),oh(o,e),o.sharedClientState.updateMutationState(e,"rejected",t),await oo(o,r)}catch(r){await sn(r)}}function oh(n,e){(n.Ru.get(e)||[]).forEach(t=>{t.resolve()}),n.Ru.delete(e)}function rh(n,e,t){const o=F(n);let r=o.Au[o.currentUser.toKey()];if(r){const i=r.get(e);i&&(t?i.reject(t):i.resolve(),r=r.remove(e)),o.Au[o.currentUser.toKey()]=r}}function Ys(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const o of n.Pu.get(e))n.hu.delete(o),t&&n.lu.gu(o,t);n.Pu.delete(e),n.isPrimaryClient&&n.du.Hr(e).forEach(o=>{n.du.containsKey(o)||sh(n,o)})}function sh(n,e){n.Tu.delete(e.path.canonicalString());const t=n.Iu.get(e);t!==null&&(wi(n.remoteStore,t),n.Iu=n.Iu.remove(e),n.Eu.delete(t),Pi(n))}function Jl(n,e,t){for(const o of t)o instanceof Zu?(n.du.addReference(o.key,e),Hp(n,o)):o instanceof eh?(N(Si,"Document no longer in limbo: "+o.key),n.du.removeReference(o.key,e),n.du.containsKey(o.key)||sh(n,o.key)):L(19791,{pu:o})}function Hp(n,e){const t=e.key,o=t.path.canonicalString();n.Iu.get(t)||n.Tu.has(o)||(N(Si,"New document in limbo: "+t),n.Tu.add(o),Pi(n))}function Pi(n){for(;n.Tu.size>0&&n.Iu.size<n.maxConcurrentLimboResolutions;){const e=n.Tu.values().next().value;n.Tu.delete(e);const t=new O(X.fromString(e)),o=n.Vu.next();n.Eu.set(o,new Op(t)),n.Iu=n.Iu.insert(t,o),Wu(n.remoteStore,new it(Ue(gr(t.path)),o,"TargetPurposeLimboResolution",dr.le))}}async function oo(n,e,t){const o=F(n),r=[],i=[],a=[];o.hu.isEmpty()||(o.hu.forEach((c,h)=>{a.push(o.fu(h,e,t).then(d=>{var f;if((d||t)&&o.isPrimaryClient){const g=d?!d.fromCache:(f=t==null?void 0:t.targetChanges.get(h.targetId))===null||f===void 0?void 0:f.current;o.sharedClientState.updateQueryState(h.targetId,g?"current":"not-current")}if(d){r.push(d);const g=pi.Rs(h.targetId,d);i.push(g)}}))}),await Promise.all(a),o.lu.Y_(r),await async function(h,d){const f=F(h);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>S.forEach(d,y=>S.forEach(y.ds,A=>f.persistence.referenceDelegate.addReference(g,y.targetId,A)).next(()=>S.forEach(y.As,A=>f.persistence.referenceDelegate.removeReference(g,y.targetId,A)))))}catch(g){if(!an(g))throw g;N(yi,"Failed to update sequence numbers: "+g)}for(const g of d){const y=g.targetId;if(!g.fromCache){const A=f.xs.get(y),P=A.snapshotVersion,V=A.withLastLimboFreeSnapshotVersion(P);f.xs=f.xs.insert(y,V)}}}(o.localStore,i))}async function Wp(n,e){const t=F(n);if(!t.currentUser.isEqual(e)){N(Si,"User change. New user:",e.toKey());const o=await ju(t.localStore,e);t.currentUser=e,function(i,a){i.Ru.forEach(c=>{c.forEach(h=>{h.reject(new x(R.CANCELLED,a))})}),i.Ru.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await oo(t,o.ks)}}function Gp(n,e){const t=F(n),o=t.Eu.get(e);if(o&&o.cu)return j().add(o.key);{let r=j();const i=t.Pu.get(e);if(!i)return r;for(const a of i){const c=t.hu.get(a);r=r.unionWith(c.view.eu)}return r}}function ih(n){const e=F(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=nh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Gp.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=jp.bind(null,e),e.lu.Y_=Vp.bind(null,e.eventManager),e.lu.gu=Dp.bind(null,e.eventManager),e}function Kp(n){const e=F(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Yp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=zp.bind(null,e),e}class er{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=br(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Su(e),await this.persistence.start(),this.localStore=this.Du(e),this.gcScheduler=this.vu(e,this.localStore),this.indexBackfillerScheduler=this.Cu(e,this.localStore)}vu(e,t){return null}Cu(e,t){return null}Du(e){return Zg(this.persistence,new Qg,e.initialUser,this.serializer)}Su(e){return new qu(gi.fi,this.serializer)}bu(e){return new ip}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}er.provider={build:()=>new er};class Qp extends er{constructor(e){super(),this.cacheSizeBytes=e}vu(e,t){G(this.persistence.referenceDelegate instanceof Jo,46915);const o=this.persistence.referenceDelegate.garbageCollector;return new Og(o,e.asyncQueue,t)}Su(e){const t=this.cacheSizeBytes!==void 0?Ee.withCacheSize(this.cacheSizeBytes):Ee.DEFAULT;return new qu(o=>Jo.fi(o,t),this.serializer)}}class zs{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>Xl(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=Wp.bind(null,this.syncEngine),await Sp(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new kp}()}createDatastore(e){const t=br(e.databaseInfo.databaseId),o=function(i){return new hp(i)}(e.databaseInfo);return function(i,a,c,h){return new gp(i,a,c,h)}(e.authCredentials,e.appCheckCredentials,o,t)}createRemoteStore(e){return function(o,r,i,a,c){return new yp(o,r,i,a,c)}(this.localStore,this.datastore,e.asyncQueue,t=>Xl(this.syncEngine,t,0),function(){return zl.C()?new zl:new ap}())}createSyncEngine(e,t){return function(r,i,a,c,h,d,f){const g=new Lp(r,i,a,c,h,d);return f&&(g.mu=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(r){const i=F(r);N(Nt,"RemoteStore shutting down."),i.da.add(5),await no(i),i.Ra.shutdown(),i.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}zs.provider={build:()=>new zs};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ki{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Mu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Mu(this.observer.error,e):Je("Uncaught Error in snapshot listener:",e.toString()))}xu(){this.muted=!0}Mu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pt="FirestoreClient";class Xp{constructor(e,t,o,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=o,this.databaseInfo=r,this.user=ye.UNAUTHENTICATED,this.clientId=eu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(o,async a=>{N(pt,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(o,a=>(N(pt,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Qe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const o=Ei(t,"Failed to shutdown persistence");e.reject(o)}}),e.promise}}async function gs(n,e){n.asyncQueue.verifyOperationInProgress(),N(pt,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let o=t.initialUser;n.setCredentialChangeListener(async r=>{o.isEqual(r)||(await ju(e.localStore,r),o=r)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function Zl(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Jp(n);N(pt,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(o=>Wl(e.remoteStore,o)),n.setAppCheckTokenChangeListener((o,r)=>Wl(e.remoteStore,r)),n._onlineComponents=e}async function Jp(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){N(pt,"Using user provided OfflineComponentProvider");try{await gs(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(r){return r.name==="FirebaseError"?r.code===R.FAILED_PRECONDITION||r.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(t))throw t;Kt("Error using user provided cache. Falling back to memory cache: "+t),await gs(n,new er)}}else N(pt,"Using default OfflineComponentProvider"),await gs(n,new Qp(void 0));return n._offlineComponents}async function ah(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(N(pt,"Using user provided OnlineComponentProvider"),await Zl(n,n._uninitializedComponentsProvider._online)):(N(pt,"Using default OnlineComponentProvider"),await Zl(n,new zs))),n._onlineComponents}function Zp(n){return ah(n).then(e=>e.syncEngine)}async function tr(n){const e=await ah(n),t=e.eventManager;return t.onListen=Mp.bind(null,e.syncEngine),t.onUnlisten=Up.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Bp.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=$p.bind(null,e.syncEngine),t}function ey(n,e,t={}){const o=new Qe;return n.asyncQueue.enqueueAndForget(async()=>function(i,a,c,h,d){const f=new ki({next:y=>{f.xu(),a.enqueueAndForget(()=>Ai(i,g));const A=y.docs.has(c);!A&&y.fromCache?d.reject(new x(R.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&y.fromCache&&h&&h.source==="server"?d.reject(new x(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(y)},error:y=>d.reject(y)}),g=new Ri(gr(c.path),f,{includeMetadataChanges:!0,Qa:!0});return Ii(i,g)}(await tr(n),n.asyncQueue,e,t,o)),o.promise}function ty(n,e,t={}){const o=new Qe;return n.asyncQueue.enqueueAndForget(async()=>function(i,a,c,h,d){const f=new ki({next:y=>{f.xu(),a.enqueueAndForget(()=>Ai(i,g)),y.fromCache&&h.source==="server"?d.reject(new x(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(y)},error:y=>d.reject(y)}),g=new Ri(c,f,{includeMetadataChanges:!0,Qa:!0});return Ii(i,g)}(await tr(n),n.asyncQueue,e,t,o)),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lh(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ec=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ch(n,e,t){if(!t)throw new x(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ny(n,e,t,o){if(e===!0&&o===!0)throw new x(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function tc(n){if(!O.isDocumentKey(n))throw new x(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function nc(n){if(O.isDocumentKey(n))throw new x(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Ir(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(o){return o.constructor?o.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":L(12329,{type:typeof n})}function ke(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new x(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ir(n);throw new x(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uh="firestore.googleapis.com",oc=!0;class rc{constructor(e){var t,o;if(e.host===void 0){if(e.ssl!==void 0)throw new x(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=uh,this.ssl=oc}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:oc;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=$u;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Ng)throw new x(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}ny("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lh((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new x(R.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new x(R.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new x(R.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(o,r){return o.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ar{constructor(e,t,o,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=o,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new rc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new x(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new rc(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(o){if(!o)return new uf;switch(o.type){case"firstParty":return new ff(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new x(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const o=ec.get(t);o&&(N("ComponentProvider","Removing Datastore"),ec.delete(t),o.terminate())}(this),Promise.resolve()}}function oy(n,e,t,o={}){var r;n=ke(n,Ar);const i=ti(e),a=n._getSettings(),c=Object.assign(Object.assign({},a),{emulatorOptions:n._getEmulatorOptions()}),h=`${e}:${t}`;i&&(Ld(`https://${h}`),Ud("Firestore",!0)),a.host!==uh&&a.host!==h&&Kt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d=Object.assign(Object.assign({},a),{host:h,ssl:i,emulatorOptions:o});if(!jo(d,c)&&(n._setSettings(d),o.mockUserToken)){let f,g;if(typeof o.mockUserToken=="string")f=o.mockUserToken,g=ye.MOCK_USER;else{f=Md(o.mockUserToken,(r=n._app)===null||r===void 0?void 0:r.options.projectId);const y=o.mockUserToken.sub||o.mockUserToken.user_id;if(!y)throw new x(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new ye(y)}n._authCredentials=new hf(new Jc(f,g))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bt{constructor(e,t,o){this.converter=t,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new bt(this.firestore,e,this._query)}}class Te{constructor(e,t,o){this.converter=t,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ut(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Te(this.firestore,e,this._key)}}class ut extends bt{constructor(e,t,o){super(e,t,gr(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Te(this.firestore,null,new O(e))}withConverter(e){return new ut(this.firestore,e,this._path)}}function Wn(n,e,...t){if(n=qe(n),ch("collection","path",e),n instanceof Ar){const o=X.fromString(e,...t);return nc(o),new ut(n,null,o)}{if(!(n instanceof Te||n instanceof ut))throw new x(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(X.fromString(e,...t));return nc(o),new ut(n.firestore,null,o)}}function De(n,e,...t){if(n=qe(n),arguments.length===1&&(e=eu.newId()),ch("doc","path",e),n instanceof Ar){const o=X.fromString(e,...t);return tc(o),new Te(n,null,new O(o))}{if(!(n instanceof Te||n instanceof ut))throw new x(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(X.fromString(e,...t));return tc(o),new Te(n.firestore,n instanceof ut?n.converter:null,new O(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sc="AsyncQueue";class ic{constructor(e=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new zu(this,"async_queue_retry"),this.rc=()=>{const o=fs();o&&N(sc,"Visibility state changed to "+o.visibilityState),this.x_.b_()},this.sc=e;const t=fs();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.oc(),this._c(e)}enterRestrictedMode(e){if(!this.Yu){this.Yu=!0,this.tc=e||!1;const t=fs();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.rc)}}enqueue(e){if(this.oc(),this.Yu)return new Promise(()=>{});const t=new Qe;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ju.push(e),this.ac()))}async ac(){if(this.Ju.length!==0){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(e){if(!an(e))throw e;N(sc,"Operation failed with retryable error: "+e)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}}_c(e){const t=this.sc.then(()=>(this.ec=!0,e().catch(o=>{throw this.Xu=o,this.ec=!1,Je("INTERNAL UNHANDLED ERROR: ",ac(o)),o}).then(o=>(this.ec=!1,o))));return this.sc=t,t}enqueueAfterDelay(e,t,o){this.oc(),this.nc.indexOf(e)>-1&&(t=0);const r=Ti.createAndSchedule(this,e,t,o,i=>this.uc(i));return this.Zu.push(r),r}oc(){this.Xu&&L(47125,{cc:ac(this.Xu)})}verifyOperationInProgress(){}async lc(){let e;do e=this.sc,await e;while(e!==this.sc)}hc(e){for(const t of this.Zu)if(t.timerId===e)return!0;return!1}Pc(e){return this.lc().then(()=>{this.Zu.sort((t,o)=>t.targetTimeMs-o.targetTimeMs);for(const t of this.Zu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.lc()})}Tc(e){this.nc.push(e)}uc(e){const t=this.Zu.indexOf(e);this.Zu.splice(t,1)}}function ac(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lc(n){return function(t,o){if(typeof t!="object"||t===null)return!1;const r=t;for(const i of o)if(i in r&&typeof r[i]=="function")return!0;return!1}(n,["next","error","complete"])}class yt extends Ar{constructor(e,t,o,r){super(e,t,o,r),this.type="firestore",this._queue=new ic,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ic(e),this._firestoreClient=void 0,await e}}}function ry(n,e){const t=typeof n=="object"?n:Qm(),o=typeof n=="string"?n:Wo,r=zm(t,"firestore").getImmediate({identifier:o});if(!r._initialized){const i=xd("firestore");i&&oy(r,...i)}return r}function Cr(n){if(n._terminated)throw new x(R.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||sy(n),n._firestoreClient}function sy(n){var e,t,o;const r=n._freezeSettings(),i=function(c,h,d,f){return new Pf(c,h,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,lh(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,r);n._componentsProvider||!((t=r.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((o=r.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(n._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),n._firestoreClient=new Xp(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(c){const h=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(h),_online:h}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new tn(de.fromBase64String(e))}catch(t){throw new x(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new tn(de.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rr{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new he(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sr{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return q(this._lat,e._lat)||q(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(o,r){if(o.length!==r.length)return!1;for(let i=0;i<o.length;++i)if(o[i]!==r[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iy=/^__.*__$/;class ay{constructor(e,t,o){this.data=e,this.fieldMask=t,this.fieldTransforms=o}toMutation(e,t){return this.fieldMask!==null?new vt(e,this.data,this.fieldMask,t,this.fieldTransforms):new eo(e,this.data,t,this.fieldTransforms)}}class hh{constructor(e,t,o){this.data=e,this.fieldMask=t,this.fieldTransforms=o}toMutation(e,t){return new vt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function dh(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{Ic:n})}}class Ni{constructor(e,t,o,r,i,a){this.settings=e,this.databaseId=t,this.serializer=o,this.ignoreUndefinedProperties=r,i===void 0&&this.Ec(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(e){return new Ni(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(e){var t;const o=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.dc({path:o,Rc:!1});return r.Vc(e),r}mc(e){var t;const o=(t=this.path)===null||t===void 0?void 0:t.child(e),r=this.dc({path:o,Rc:!1});return r.Ec(),r}fc(e){return this.dc({path:void 0,Rc:!0})}gc(e){return nr(e,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ec(){if(this.path)for(let e=0;e<this.path.length;e++)this.Vc(this.path.get(e))}Vc(e){if(e.length===0)throw this.gc("Document fields must not be empty");if(dh(this.Ic)&&iy.test(e))throw this.gc('Document fields cannot begin and end with "__"')}}class ly{constructor(e,t,o){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=o||br(e)}bc(e,t,o,r=!1){return new Ni({Ic:e,methodName:t,wc:o,path:he.emptyPath(),Rc:!1,yc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function xi(n){const e=n._freezeSettings(),t=br(n._databaseId);return new ly(n._databaseId,!!e.ignoreUndefinedProperties,t)}function cy(n,e,t,o,r,i={}){const a=n.bc(i.merge||i.mergeFields?2:0,e,t,r);Li("Data must be an object, but it was:",a,o);const c=mh(o,a);let h,d;if(i.merge)h=new Re(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const g of i.mergeFields){const y=Hs(e,g,t);if(!a.contains(y))throw new x(R.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);gh(f,y)||f.push(y)}h=new Re(f),d=a.fieldTransforms.filter(g=>h.covers(g.field))}else h=null,d=a.fieldTransforms;return new ay(new Ie(c),h,d)}class ro extends Sr{_toFieldTransform(e){if(e.Ic!==2)throw e.Ic===1?e.gc(`${this._methodName}() can only appear at the top level of your update data`):e.gc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ro}}class Oi extends Sr{constructor(e,t){super(e),this.Dc=t}_toFieldTransform(e){const t=new Hn(e.serializer,Iu(e.serializer,this.Dc));return new eg(e.path,t)}isEqual(e){return e instanceof Oi&&this.Dc===e.Dc}}function uy(n,e,t,o){const r=n.bc(1,e,t);Li("Data must be an object, but it was:",r,o);const i=[],a=Ie.empty();_t(o,(h,d)=>{const f=Mi(e,h,t);d=qe(d);const g=r.mc(f);if(d instanceof ro)i.push(f);else{const y=so(d,g);y!=null&&(i.push(f),a.set(f,y))}});const c=new Re(i);return new hh(a,c,r.fieldTransforms)}function hy(n,e,t,o,r,i){const a=n.bc(1,e,t),c=[Hs(e,o,t)],h=[r];if(i.length%2!=0)throw new x(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<i.length;y+=2)c.push(Hs(e,i[y])),h.push(i[y+1]);const d=[],f=Ie.empty();for(let y=c.length-1;y>=0;--y)if(!gh(d,c[y])){const A=c[y];let P=h[y];P=qe(P);const V=a.mc(A);if(P instanceof ro)d.push(A);else{const k=so(P,V);k!=null&&(d.push(A),f.set(A,k))}}const g=new Re(d);return new hh(f,g,a.fieldTransforms)}function dy(n,e,t,o=!1){return so(t,n.bc(o?4:3,e))}function so(n,e){if(fh(n=qe(n)))return Li("Unsupported field value:",e,n),mh(n,e);if(n instanceof Sr)return function(o,r){if(!dh(r.Ic))throw r.gc(`${o._methodName}() can only be used with update() and set()`);if(!r.path)throw r.gc(`${o._methodName}() is not currently supported inside arrays`);const i=o._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Rc&&e.Ic!==4)throw e.gc("Nested arrays are not supported");return function(o,r){const i=[];let a=0;for(const c of o){let h=so(c,r.fc(a));h==null&&(h={nullValue:"NULL_VALUE"}),i.push(h),a++}return{arrayValue:{values:i}}}(n,e)}return function(o,r){if((o=qe(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return Iu(r.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const i=ie.fromDate(o);return{timestampValue:Xo(r.serializer,i)}}if(o instanceof ie){const i=new ie(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:Xo(r.serializer,i)}}if(o instanceof Vi)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof tn)return{bytesValue:xu(r.serializer,o._byteString)};if(o instanceof Te){const i=r.databaseId,a=o.firestore._databaseId;if(!a.isEqual(i))throw r.gc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:mi(o.firestore._databaseId||r.databaseId,o._key.path)}}if(o instanceof Di)return function(a,c){return{mapValue:{fields:{[lu]:{stringValue:cu},[Go]:{arrayValue:{values:a.toArray().map(d=>{if(typeof d!="number")throw c.gc("VectorValues must only contain numeric values.");return ci(c.serializer,d)})}}}}}}(o,r);throw r.gc(`Unsupported field value: ${Ir(o)}`)}(n,e)}function mh(n,e){const t={};return nu(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):_t(n,(o,r)=>{const i=so(r,e.Ac(o));i!=null&&(t[o]=i)}),{mapValue:{fields:t}}}function fh(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ie||n instanceof Vi||n instanceof tn||n instanceof Te||n instanceof Sr||n instanceof Di)}function Li(n,e,t){if(!fh(t)||!function(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}(t)){const o=Ir(t);throw o==="an object"?e.gc(n+" a custom object"):e.gc(n+" "+o)}}function Hs(n,e,t){if((e=qe(e))instanceof Rr)return e._internalPath;if(typeof e=="string")return Mi(n,e);throw nr("Field path arguments must be of type string or ",n,!1,void 0,t)}const my=new RegExp("[~\\*/\\[\\]]");function Mi(n,e,t){if(e.search(my)>=0)throw nr(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Rr(...e.split("."))._internalPath}catch{throw nr(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function nr(n,e,t,o,r){const i=o&&!o.isEmpty(),a=r!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let h="";return(i||a)&&(h+=" (found",i&&(h+=` in field ${o}`),a&&(h+=` in document ${r}`),h+=")"),new x(R.INVALID_ARGUMENT,c+n+h)}function gh(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ph{constructor(e,t,o,r,i){this._firestore=e,this._userDataWriter=t,this._key=o,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Te(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new fy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Pr("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class fy extends ph{data(){return super.data()}}function Pr(n,e){return typeof e=="string"?Mi(n,e):e instanceof Rr?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yh(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new x(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Bi{}class wh extends Bi{}function Ws(n,e,...t){let o=[];e instanceof Bi&&o.push(e),o=o.concat(t),function(i){const a=i.filter(h=>h instanceof Fi).length,c=i.filter(h=>h instanceof kr).length;if(a>1||a>0&&c>0)throw new x(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(o);for(const r of o)n=r._apply(n);return n}class kr extends wh{constructor(e,t,o){super(),this._field=e,this._op=t,this._value=o,this.type="where"}static _create(e,t,o){return new kr(e,t,o)}_apply(e){const t=this._parse(e);return _h(e._query,t),new bt(e.firestore,e.converter,Os(e._query,t))}_parse(e){const t=xi(e.firestore);return function(i,a,c,h,d,f,g){let y;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new x(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){uc(g,f);const P=[];for(const V of g)P.push(cc(h,i,V));y={arrayValue:{values:P}}}else y=cc(h,i,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||uc(g,f),y=dy(c,a,g,f==="in"||f==="not-in");return re.create(d,f,y)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Gs(n,e,t){const o=e,r=Pr("where",n);return kr._create(r,o,t)}class Fi extends Bi{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Fi(e,t)}_parse(e){const t=this._queryConstraints.map(o=>o._parse(e)).filter(o=>o.getFilters().length>0);return t.length===1?t[0]:Me.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(r,i){let a=r;const c=i.getFlattenedFilters();for(const h of c)_h(a,h),a=Os(a,h)}(e._query,t),new bt(e.firestore,e.converter,Os(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ui extends wh{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ui(e,t)}_apply(e){const t=function(r,i,a){if(r.startAt!==null)throw new x(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(r.endAt!==null)throw new x(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new jn(i,a)}(e._query,this._field,this._direction);return new bt(e.firestore,e.converter,function(r,i){const a=r.explicitOrderBy.concat([i]);return new ln(r.path,r.collectionGroup,a,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}function Ks(n,e="asc"){const t=e,o=Pr("orderBy",n);return Ui._create(o,t)}function cc(n,e,t){if(typeof(t=qe(t))=="string"){if(t==="")throw new x(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!yu(e)&&t.indexOf("/")!==-1)throw new x(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const o=e.path.child(X.fromString(t));if(!O.isDocumentKey(o))throw new x(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return El(n,new O(o))}if(t instanceof Te)return El(n,t._key);throw new x(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ir(t)}.`)}function uc(n,e){if(!Array.isArray(n)||n.length===0)throw new x(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function _h(n,e){const t=function(r,i){for(const a of r)for(const c of a.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new x(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new x(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class gy{convertValue(e,t="none"){switch(ft(e)){case 0:return null;case 1:return e.booleanValue;case 2:return te(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(mt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw L(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const o={};return _t(e,(r,i)=>{o[r]=this.convertValue(i,t)}),o}convertVectorValue(e){var t,o,r;const i=(r=(o=(t=e.fields)===null||t===void 0?void 0:t[Go].arrayValue)===null||o===void 0?void 0:o.values)===null||r===void 0?void 0:r.map(a=>te(a.doubleValue));return new Di(i)}convertGeoPoint(e){return new Vi(te(e.latitude),te(e.longitude))}convertArray(e,t){return(e.values||[]).map(o=>this.convertValue(o,t))}convertServerTimestamp(e,t){switch(t){case"previous":const o=fr(e);return o==null?null:this.convertValue(o,t);case"estimate":return this.convertTimestamp(Un(e));default:return null}}convertTimestamp(e){const t=dt(e);return new ie(t.seconds,t.nanos)}convertDocumentKey(e,t){const o=X.fromString(e);G(Uu(o),9688,{name:e});const r=new $n(o.get(1),o.get(3)),i=new O(o.popFirst(5));return r.isEqual(t)||Je(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function py(n,e,t){let o;return o=n?n.toFirestore(e):e,o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class vh extends ph{constructor(e,t,o,r,i,a){super(e,t,o,r,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Fo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const o=this._document.data.field(Pr("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,t.serverTimestamps)}}}class Fo extends vh{data(e={}){return super.data(e)}}class bh{constructor(e,t,o,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new kn(r.hasPendingWrites,r.fromCache),this.query=o}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(o=>{e.call(t,new Fo(this._firestore,this._userDataWriter,o.key,o,new kn(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let a=0;return r._snapshot.docChanges.map(c=>{const h=new Fo(r._firestore,r._userDataWriter,c.doc.key,c.doc,new kn(r._snapshot.mutatedKeys.has(c.doc.key),r._snapshot.fromCache),r.query.converter);return c.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{const h=new Fo(r._firestore,r._userDataWriter,c.doc.key,c.doc,new kn(r._snapshot.mutatedKeys.has(c.doc.key),r._snapshot.fromCache),r.query.converter);let d=-1,f=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),f=a.indexOf(c.doc.key)),{type:yy(c.type),doc:h,oldIndex:d,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function yy(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vr(n){n=ke(n,Te);const e=ke(n.firestore,yt);return ey(Cr(e),n._key).then(t=>Ih(e,n,t))}class $i extends gy{constructor(e){super(),this.firestore=e}convertBytes(e){return new tn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Te(this.firestore,null,t)}}function hc(n){n=ke(n,bt);const e=ke(n.firestore,yt),t=Cr(e),o=new $i(e);return yh(n._query),ty(t,n._query).then(r=>new bh(e,o,n,r))}function Ye(n,e,t,...o){n=ke(n,Te);const r=ke(n.firestore,yt),i=xi(r);let a;return a=typeof(e=qe(e))=="string"||e instanceof Rr?hy(i,"updateDoc",n._key,e,t,o):uy(i,"updateDoc",n._key,e),qi(r,[a.toMutation(n._key,Le.exists(!0))])}function wy(n){return qi(ke(n.firestore,yt),[new ui(n._key,Le.none())])}function Th(n,e){const t=ke(n.firestore,yt),o=De(n),r=py(n.converter,e);return qi(t,[cy(xi(n.firestore),"addDoc",o._key,r,n.converter!==null,{}).toMutation(o._key,Le.exists(!1))]).then(()=>o)}function Eh(n,...e){var t,o,r;n=qe(n);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||lc(e[a])||(i=e[a],a++);const c={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(lc(e[a])){const g=e[a];e[a]=(t=g.next)===null||t===void 0?void 0:t.bind(g),e[a+1]=(o=g.error)===null||o===void 0?void 0:o.bind(g),e[a+2]=(r=g.complete)===null||r===void 0?void 0:r.bind(g)}let h,d,f;if(n instanceof Te)d=ke(n.firestore,yt),f=gr(n._key.path),h={next:g=>{e[a]&&e[a](Ih(d,n,g))},error:e[a+1],complete:e[a+2]};else{const g=ke(n,bt);d=ke(g.firestore,yt),f=g._query;const y=new $i(d);h={next:A=>{e[a]&&e[a](new bh(d,y,g,A))},error:e[a+1],complete:e[a+2]},yh(n._query)}return function(y,A,P,V){const k=new ki(V),U=new Ri(A,k,P);return y.asyncQueue.enqueueAndForget(async()=>Ii(await tr(y),U)),()=>{k.xu(),y.asyncQueue.enqueueAndForget(async()=>Ai(await tr(y),U))}}(Cr(d),f,c,h)}function qi(n,e){return function(o,r){const i=new Qe;return o.asyncQueue.enqueueAndForget(async()=>qp(await Zp(o),r,i)),i.promise}(Cr(n),e)}function Ih(n,e,t){const o=t.docs.get(e._key),r=new $i(n);return new vh(n,r,e._key,o,new kn(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _y(){return new ro("deleteField")}function ji(n){return new Oi("increment",n)}(function(e,t=!0){(function(r){rn=r})(Km),zo(new Mn("firestore",(o,{instanceIdentifier:r,options:i})=>{const a=o.getProvider("app").getImmediate(),c=new yt(new df(o.getProvider("auth-internal")),new gf(a,o.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new x(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $n(d.options.projectId,f)}(a,r),a);return i=Object.assign({useFetchStreams:t},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),Wt(hl,dl,e),Wt(hl,dl,"esm2017")})();const dc={1:{ca:{"server-room":{"Investigate Server Traffic Logs":["Scanning through the IDS logs, you notice suspicious traffic indicative of automated reconnaissance and rapid-fire attacks.","Given this traffic, which IP address most likely belongs to the Rougue AI and must be urgently reviewed?"],"Check Firewall Configuration":["This won't help right now."],"Review Active Directory Logs":["This won't help right now."],"Analyse Authentication Logs":["This won't help right now."],CORRECT_ACTION:"Investigate Server Traffic Logs"},"command-centre":{"Trace Endpoint Behavior by Class":["This won't help right now."],"Update Threat Intelligence Feeds":["This won't help right now."],"Cross-check Audit Trail Against Global Events":["This won't help right now."],"Patch Exposed Service":["This won't help right now."],CORRECT_ACTION:null},"developer-hub":{"Review Access Control File":["This won't help right now."],"Check Developer Login Tokens":["This won't help right now."],"Trigger Endpoint Containment Protocol":["This won't help right now."],"Analyze Recent API Security Logs":["This won't help right now."],CORRECT_ACTION:null},"research-lab":{"Review Email Gateway Rules":["This won't help right now."],"Look Up User Activity History":["You quickly pull up the latest user connection data.","As an expert in cyber security, you're used to analysing things like login times, locations, and device patterns to determine if an account has been hijacked.","If anything looks off here, you should flag it immediately before the AI burrows deeper."],"Reboot Threat Detection System":["This won't help right now."],"Run Network Speed Diagnostics":["This won't help right now."],CORRECT_ACTION:"Look Up User Activity History"}},ne:{"server-room":{"Audit Monitoring Scripts":["This won't help right now."],"Reconfigure VLAN Assignments":["This won't help right now."],"Check UPS and Cooling Network Interfaces":["This won't help right now."],"Patch Firewall Configuration":["This won't help right now."],CORRECT_ACTION:null},"command-centre":{"Review Network Topology Diagrams":["This won't help right now."],"Analyse Firewall Logs":["This won't help right now."],"Examine Firewall Rule Propagation":["This won't help right now."],"Compare Interface Access Logs":["You cross-reference interface logs from the Command Centre for irregular access times, frequency spikes, or unauthorized devices.","One of them doesn’t match the baseline. Which one is it?"],CORRECT_ACTION:"Compare Interface Access Logs"},"developer-hub":{"Audit Static IP Assignments":["This won't help right now."],"Check Network Mapping for Dev Machines":["This won't help right now."],"Monitor DHCP Lease Table":["This won't help right now."],"Trace API Traffic from Flagged IP":["You filter network flow logs for the flagged IP.","Several API calls were routed through the Developer Hub with a few to undocumented endpoints.","Which destination node has had the highest interaction with the rogue IP and should be flagged for monitoring?"],CORRECT_ACTION:"Trace API Traffic from Flagged IP"},"research-lab":{"Trace MAC Address Conflicts":["This won't help right now."],"Analyze Network Throughput to Lab Nodes":["This won't help right now."],"Scan for Rogue Access Points":["This won't help right now."],"Review Scheduled Scripts":["This won't help right now."],CORRECT_ACTION:null}},se:{"developer-hub":{"Review Git Commit History":["This won't help right now."],"Trace Endpoint Access Logs":["This won't help right now."],"Review Classification Schema":["This won't help right now."],"Check Running Dev Services":["This won't help right now."],CORRECT_ACTION:null},"server-room":{"Audit Running Processes for Anomalies":["You scan the server’s running processes for unusual memory usage, privilege elevation, and unsigned binaries.","One process doesn’t match any verified signatures and is using significantly more resources than the rest.","Which process should be flagged for investigation?"],"Review Microservice Startup Logs":["This won't help right now."],"Check Runtime Errors on Backend Services":["This won't help right now."],"Validate Service Dependencies":["This won't help right now."],CORRECT_ACTION:"Audit Running Processes for Anomalies"},"research-lab":{"Investigate Foreign Key Mismatch":["This won't help right now."],"Review Git Commit History":["You open the commit logs from the last deployment window.","One commit stands out. It modified a crucial dataset used by the AI in production.","You flag it for rollback and notify the Data Scientist to help clean up the mess.","Which git commit did you flag?"],"Review Model Execution Logs":["This won't help right now."],"Review Active Class Overrides":["This won't help right now."],CORRECT_ACTION:"Review Git Commit History"},"command-centre":{"Scan for Unsecured Internal APIs":["This won't help right now."],"Trigger Class Hierarchy Scan":["This won't help right now."],"Review CI/CD Deployment Logs":["This won't help right now."],"Audit Token Usage in System Services":["This won't help right now."],CORRECT_ACTION:null}},ds:{"server-room":{"Analyse Model Resource Usage":["This won't help right now."],"Check Model Serving Latency":["This won't help right now."],"Run Feature Engineering Audit":["This won't help right now."],"Inspect Containerized Model Deployments":["This won't help right now."],CORRECT_ACTION:null},"command-centre":{"Adjust Intrusion Detection Signals":["This won't help right now."],"Review Alert Thresholds for Data Anomalies":["This won't help right now."],"Commence An Exploratory Data Analysis Session":["Early analysis results show wild predictions by models that were previously operating correctly.","A quick check of the summary stats reveals the issue.","What’s the best cleaning approach to prevent downstream failures caused by this commit?"],"Audit Scheduled Retraining Jobs":["This won't help right now."],CORRECT_ACTION:"Commence An Exploratory Data Analysis Session"},"developer-hub":{"Verify Data Pipeline Integrity":["This won't help right now."],"Inspect Feature Store Activity":["This won't help right now."],"Analyse User Session Logs":["You load 24 hours of user session logs and run statistical comparisons across key behavioral metrics.","One user shows a clear deviation with unusual access frequency, irregular login times, and inconsistent device usage.","What user is this?"],"Audit Prediction Rules":["This won't help right now."],CORRECT_ACTION:"Analyse User Session Logs"},"research-lab":{"Review Training Data Samples":["This won't help right now."],"Check Dataset Integrity and Labeling":["This won't help right now."],"Analyze Experiment Metrics for Outliers":["This won't help right now."],"Compare Performance of Experimental Models":["This won't help right now."],CORRECT_ACTION:null}}},2:{ca:{"server-room":{"Investigate Server Traffic Logs":["This won't help right now."],"Check Firewall Configuration":["This won't help right now."],"Review Active Directory Logs":["This won't help right now."],"Analyse Authentication Logs":["This won't help right now."],CORRECT_ACTION:null},"command-centre":{"Trace Endpoint Behavior by Class":["You scan endpoints reporting custom subclass behavior.","The Software Engineer flagged a specific subclass as malicious, likely injecting commands remotely.","Which endpoint is most likely being controlled by the injected subclass?"],"Update Threat Intelligence Feeds":["This won't help right now."],"Cross-check Audit Trail Against Global Events":["This won't help right now."],"Patch Exposed Service":["This won't help right now."],CORRECT_ACTION:"Trace Endpoint Behavior by Class"},"developer-hub":{"Review Access Control File":["This won't help right now."],"Check Developer Login Tokens":["This won't help right now."],"Trigger Endpoint Containment Protocol":["You launch the containment protocol, scanning logs for suspicious internal activity.","Several machines are acting strangely. Service accounts behaving outside normal baselines.","Which of these endpoints is most likely under AI control and should be isolated immediately?"],"Analyze Recent API Security Logs":["This won't help right now."],CORRECT_ACTION:"Trigger Endpoint Containment Protocol"},"research-lab":{"Review Email Gateway Rules":["This won't help right now."],"Look Up User Activity History":["This won't help right now."],"Reboot Threat Detection System":["This won't help right now."],"Run Network Speed Diagnostics":["This won't help right now."],CORRECT_ACTION:null}},ne:{"server-room":{"Audit Monitoring Scripts":["You inspect your batch scripts used for intrusion detection across endpoints.","Which monitoring script must be patched to remove reliance on the leaky feature the Data Scientist flagged?"],"Reconfigure VLAN Assignments":["This won't help right now."],"Check UPS and Cooling Network Interfaces":["This won't help right now."],"Patch Firewall Configuration":["This won't help right now."],CORRECT_ACTION:"Audit Monitoring Scripts"},"command-centre":{"Review Network Topology Diagrams":["This won't help right now."],"Analyse Firewall Logs":["This won't help right now."],"Review Recent Script Executions":["This won't help right now."],"Compare Interface Access Logs":["This won't help right now."],CORRECT_ACTION:null},"developer-hub":{"Audit Static IP Assignments":["This won't help right now."],"Check Network Mapping for Dev Machines":["This won't help right now."],"Monitor DHCP Lease Table":["This won't help right now."],"Trace API Traffic from Flagged IP":["This won't help right now."],CORRECT_ACTION:null},"research-lab":{"Trace MAC Address Conflicts":["This won't help right now."],"Analyze Network Throughput to Lab Nodes":["This won't help right now."],"Scan for Rogue Access Points":["This won't help right now."],"Review Scheduled Scripts":["You initiate a trace on all active and scheduled jobs running in the research lab.","A list of batch scripts lights up on the console. Most look routine, but one stands out.","Something's injecting data regularly... and it's not coming from any known system.","Which script is most likely responsible?"],CORRECT_ACTION:"Review Scheduled Scripts"}},se:{"developer-hub":{"Review Git Commit History":["This won't help right now."],"Trace Endpoint Access Logs":["This won't help right now."],"Review Classification Schema":["This won't help right now."],"Check Running Dev Services":["This won't help right now."],CORRECT_ACTION:null},"server-room":{"Audit Running Processes for Anomalies":["This won't help right now."],"Review Microservice Startup Logs":["This won't help right now."],"Check Runtime Errors on Backend Services":["This won't help right now."],"Validate Service Dependencies":["This won't help right now."],CORRECT_ACTION:null},"research-lab":{"Investigate Foreign Key Mismatch":["This won't help right now."],"Review Git Commit History":["This won't help right now."],"Review Model Execution Logs":["This won't help right now."],"Review Active Class Overrides":["You scan recently modified classes in the build pipeline.","One of them originates from the compromised developer machine flagged earlier.","Which class has most likely been modified by the AI and should be deprecated immediately?"],CORRECT_ACTION:"Review Active Class Overrides"},"command-centre":{"Scan for Unsecured Internal APIs":["This won't help right now."],"Trigger Class Hierarchy Scan":["You launch a scan of active subclasses extending from core system services.","One of them is behaving differently. It's injecting logic at runtime from an unknown source.","Which subclass most likely introduces AI-modified behavior and should be flagged?"],"Review CI/CD Deployment Logs":["This won't help right now."],"Audit Token Usage in System Services":["This won't help right now."],CORRECT_ACTION:"Trigger Class Hierarchy Scan"}},ds:{"server-room":{"Analyze Model Resource Usage":["This won't help right now."],"Check Model Serving Latency":["This won't help right now."],"Run Feature Engineering Audit":["You audit the engineered features feeding into the real-time detection model.","One of them has an unusually high correlation with intrusion events. Suspiciously high...","Which engineered feature is likely causing data leakage in the intrusion detection model?"],"Inspect Containerized Model Deployments":["This won't help right now."],CORRECT_ACTION:"Run Feature Engineering Audit"},"command-centre":{"Analyse Feature Stability Report":["You compare the variance and update timings of key engineered features.","One of them lines up exactly with the suspicious script injected earlier.","Which feature is most likely impacted by the corrupted automation script and should be excluded from modeling?"],"Review Alert Thresholds for Data Anomalies":["This won't help right now."],"Commence An Exploratory Data Analysis Session":["This won't help right now."],"Audit Scheduled Retraining Jobs":["This won't help right now."],CORRECT_ACTION:"Analyse Feature Stability Report"},"developer-hub":{"Verify Data Pipeline Integrity":["This won't help right now."],"Inspect Feature Store Activity":["This won't help right now."],"Analyse User Session Logs":["This won't help right now."],"Audit Prediction Rules":["This won't help right now."],CORRECT_ACTION:null},"research-lab":{"Review Training Data Samples":["This won't help right now."],"Check Dataset Integrity and Labeling":["This won't help right now."],"Analyze Experiment Metrics for Outliers":["This won't help right now."],"Compare Performance of Experimental Models":["This won't help right now."],CORRECT_ACTION:null}}},3:{ca:{"server-room":{"Investigate Server Traffic Logs":["This won't help right now."],"Check Firewall Configuration":["This won't help right now."],"Review Active Directory Logs":["This won't help right now."],"Analyse Authentication Logs":["You load the latest authentication dump from `/var/log/auth.log`.","Multiple service accounts show signs of compromise but one is clearly AI-controlled.","Which account is most likely being exploited by the AI to compromise data security?"],CORRECT_ACTION:"Analyse Authentication Logs"},"command-centre":{"Trace Endpoint Behavior by Class":["This won't help right now."],"Update Threat Intelligence Feeds":["This won't help right now."],"Cross-check Audit Trail Against Global Events":["This won't help right now."],"Patch Exposed Service":["You open the config file of the app-layer service identified by the Network Engineer.","It’s wide open. No auth, no rate limiting, open to the whole internet.","Which patch would best prevent a repeat of the AI's data breach?"],CORRECT_ACTION:"Patch Exposed Service"},"developer-hub":{"Review Access Control File":["This won't help right now."],"Check Developer Login Tokens":["This won't help right now."],"Trigger Endpoint Containment Protocol":["This won't help right now."],"Analyze Recent API Security Logs":["This won't help right now."],CORRECT_ACTION:null},"research-lab":{"Review Email Gateway Rules":["This won't help right now."],"Look Up User Activity History":["This won't help right now."],"Reboot Threat Detection System":["This won't help right now."],"Run Network Speed Diagnostics":["This won't help right now."],CORRECT_ACTION:null}},ne:{"server-room":{"Audit Monitoring Scripts":["You inspect your batch scripts used for intrusion detection across endpoints.","Which monitoring script must be patched to remove reliance on the leaky feature the Data Scientist flagged?"],"Reconfigure VLAN Assignments":["This won't help right now."],"Check UPS and Cooling Network Interfaces":["This won't help right now."],"Patch Firewall Configuration":["You receive an exploit signature from the Software Engineer. Malformed foreign keys like are slipping into analytics systems.","You draft several rule candidates for outbound traffic filtering.","Which rule should you apply to stop this behavior?"],CORRECT_ACTION:"Patch Firewall Configuration"},"command-centre":{"Review Network Topology Diagrams":["This won't help right now."],"Analyse Firewall Logs":["You receive a time-synced firewall log excerpt showing AI-originating traffic.","One of these protocols was used to exfiltrate internal system logs.","Which breach vector is responsible?"],"Review Recent Script Executions":["This won't help right now."],"Compare Interface Access Logs":["This won't help right now."],CORRECT_ACTION:"Analyse Firewall Logs"},"developer-hub":{"Audit Static IP Assignments":["This won't help right now."],"Check Network Mapping for Dev Machines":["This won't help right now."],"Monitor DHCP Lease Table":["This won't help right now."],"Trace API Traffic from Flagged IP":["This won't help right now."],CORRECT_ACTION:null},"research-lab":{"Trace MAC Address Conflicts":["This won't help right now."],"Analyze Network Throughput to Lab Nodes":["This won't help right now."],"Scan for Rogue Access Points":["This won't help right now."],"Review Scheduled Scripts":["This won't help right now."],CORRECT_ACTION:null}},se:{"developer-hub":{"Review Git Commit History":["This won't help right now."],"Trace Endpoint Access Logs":["This won't help right now."],"Review Classification Schema":["You load the `security_flags` table in the dashboard.","Everything looks valid at a glance, but something isn’t matching up. The AI’s allowed several malicious users to slip through.","What structural flaw could allow malicious records to bypass classification?"],"Check Running Dev Services":["This won't help right now."],CORRECT_ACTION:"Review Classification Schema"},"server-room":{"Audit Running Processes for Anomalies":["This won't help right now."],"Review Microservice Startup Logs":["This won't help right now."],"Check Runtime Errors on Backend Services":["This won't help right now."],"Validate Service Dependencies":["This won't help right now."],CORRECT_ACTION:null},"research-lab":{"Investigate Foreign Key Mismatch":["You pull the database schema for the `security_flags` table and cross-reference it with the anomaly log.","One of the foreign key references is allowing invalid data to slip through unchecked.","Which field is being misused?"],"Review Git Commit History":["This won't help right now."],"Review Model Execution Logs":["This won't help right now."],"Review Active Class Overrides":["This won't help right now."],CORRECT_ACTION:"Investigate Foreign Key Mismatch"},"command-centre":{"Scan for Unsecured Internal APIs":["This won't help right now."],"Trigger Class Hierarchy Scan":["You launch a scan of active subclasses extending from core system services.","One of them is behaving differently, injecting logic at runtime from an unknown source.","Which subclass most likely introduces AI-modified behavior and should be flagged?"],"Review CI/CD Deployment Logs":["This won't help right now."],"Audit Token Usage in System Services":["This won't help right now."],CORRECT_ACTION:"Trigger Class Hierarchy Scan"}},ds:{"server-room":{"Analyze Model Resource Usage":["This won't help right now."],"Check Model Serving Latency":["This won't help right now."],"Run Feature Engineering Audit":["You audit the engineered features feeding into the real-time detection model.","One of them has an unusually high correlation with intrusion events. Suspiciously high...","Which engineered feature is likely causing data leakage in the intrusion detection model?"],"Inspect Containerized Model Deployments":["This won't help right now."],CORRECT_ACTION:"Run Feature Engineering Audit"},"command-centre":{"Analyse Feature Stability Report":["You compare the variance and update timings of key engineered features.","One of them lines up exactly with the suspicious script injected earlier.","Which feature is most likely impacted by the corrupted automation script and should be excluded from modeling?"],"Review Alert Thresholds for Data Anomalies":["This won't help right now."],"Commence An Exploratory Data Analysis Session":["This won't help right now."],"Audit Scheduled Retraining Jobs":["This won't help right now."],CORRECT_ACTION:"Analyse Feature Stability Report"},"developer-hub":{"Verify Data Pipeline Integrity":["This won't help right now."],"Inspect Feature Store Activity":["This won't help right now."],"Analyse User Session Logs":["This won't help right now."],"Audit Prediction Rules":["You review the simplified logic extracted from the AI’s current decision engine.","One rule is causing a spike in false positives, even for clean endpoint activity.","Which line is most likely responsible?"],CORRECT_ACTION:"Audit Prediction Rules"},"research-lab":{"Review Training Data Samples":["You pull a subset of recent training data used in real-time anomaly detection.","One of them appears mislabeled, likely injected by the flagged account.","Which sample index is most likely poisoned?"],"Check Dataset Integrity and Labeling":["This won't help right now."],"Analyze Experiment Metrics for Outliers":["This won't help right now."],"Compare Performance of Experimental Models":["This won't help right now."],CORRECT_ACTION:"Review Training Data Samples"}}},"NO-ACTION":["This doesn't seem to help right now. You should try looking in some other rooms."]},vy={1:{ca:{"server-room":{enabler:{title:"Identify Rougue IP Address",prompt:`Review the captured traffic log below. Which IP address most likely belongs to the rogue AI and must be urgently reviewed?
<pre><code class="language-bash">[09:21:03] 10.0.0.45 → Server_1: Routine status check
[09:21:07] 172.16.5.12 → Developer_Hub: Multiple authentication attempts failed
[09:21:10] 10.0.0.77 → Research_Lab: Large encrypted data transfer initiated
[09:21:15] 192.168.3.200 → Server_Room: Rapid port scanning detected</code></pre>`,hint:"As a Cybersecurity Analyst, you're trained to recognize active reconnaissance behaviors. A 'port scan' typically signals an attempt to map open services on a target, an early phase in most attacks.",tableHeaders:["Option"],tableRows:[["10.0.0.45"],["172.16.5.12"],["10.0.0.77"],["192.168.3.200"]],correctAnswerIndex:3,feedback:{correct:["An external IP triggering a port scan alert is the digital equivalent of someone rattling every doorknob in your building at 3AM.","Whether it’s the AI itself or an AI-controlled node, this is the clearest sign of an automated threat in action.","It’s not guessing passwords or hiding in traffic... it’s hunting.","You send the IP address to the network engineer for urgent review.","You should investigate some other rooms in case you can assist further."],incorrect:["You send the IP address to the network engineer for urgent review.","You should investigate some other rooms in case you can assist further."]}}},"research-lab":{enabled:{title:"Idenfity Suspicious Login Attempt",prompt:`Review the server login log excerpt below. Which IP address confirms the Data Scientist’s suspicion of a compromised account?
<pre><code class="language-bash">[2025-07-01 02:12:43] 192.168.1.10 — DevStation01 (Melbourne): Login Success
[2025-07-01 02:14:05] 203.0.113.55 — Unknown Device (Tokyo): Login Success
[2025-07-01 02:14:22] 192.168.1.10 — DevStation01 (Melbourne): Active Session
[2025-07-01 02:15:10] 192.168.1.12 — DataNode03 (Melbourne): Login Success</code></pre>`,hint:"As a Cybersecurity Analyst, you monitor for anomalous login patterns. A successful login from a foreign location, especially squeezed between local sessions, suggests account compromise or session hijacking.",tableHeaders:["IP Address"],tableRows:[["192.168.1.10"],["203.0.113.55"],["192.168.1.10"],["192.168.1.12"]],correctAnswerIndex:1,feedback:{correct:["The login pattern shows a classic sign of account compromise. An external IP slipping in between legitimate internal logins.","Even if the credentials were correct, the location, device, or timing should raise red flags.","This isn’t just a user on a VPN. It’s likely the Rogue AI probing for elevated access or persistence.","You’ve flagged the user as compromised.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],incorrect:["You flag the user as compromised.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."]}}}},ne:{"command-centre":{enabler:{title:"Identify Compromised Interface",prompt:'Review the interface diagnostics log below. One of these interfaces shows clear signs of AI infiltration. Which one?<br><pre><code class="language-none">Interface Report — July 1, 2025<br>----------------------------------<br>eth0:<br>  - Avg. Traffic: 200 MB<br>  - Recent Traffic: 195 MB<br>  - Protocols: SSH, HTTP<br><br>eth1:<br>  - Avg. Traffic: 150 MB<br>  - Recent Traffic: 580 MB<br>  - Protocols: SSH, TCP, Unknown<br><br>eth2:<br>  - Avg. Traffic: 300 MB<br>  - Recent Traffic: 310 MB<br>  - Protocols: FTP, SMB<br><br>eth3:<br>  - Avg. Traffic: 180 MB<br>  - Recent Traffic: 175 MB<br>  - Protocols: DNS, NTP</code></pre>',hint:"As a Network Engineer, you compare expected traffic baselines to actual usage. Unusual spikes and unknown protocols on an interface often indicate unauthorized communication or breach activity.",tableHeaders:["Interface"],tableRows:[["eth0"],["eth1"],["eth2"],["eth3"]],correctAnswerIndex:1,feedback:{correct:["eth1’s lighting up like a Christmas tree.","Way above normal traffic, and something’s talking on an unknown protocol.","That’s not just noise, that’s a breach vector.","You flag it for follow-up by the Software Engineer.","You should investigate some other rooms in case you can assist further."],incorrect:["You flag the interace for follow-up.","You should investigate some other rooms in case you can assist further."]}}},"developer-hub":{enabled:{title:"Identify Infected Nodes",prompt:`Analyze the AI's communication trace. Which node has the flagged IP interacted with the most?<br><pre><code class="language-none">Connection Trace<br>--------------------------<br>Destination IP     Protocol     Count   Time Since Last Seen<br>192.168.1.20       ICMP         5       3 hours ago<br>192.168.2.10       TCP          4       Over 1 week ago<br>192.168.3.40       UDP          0       -<br>192.168.3.200      TCP         13       47 seconds ago<br>10.0.0.45          TCP          3       2 hours ago</code></pre>`,hint:"You're used to tracing communication patterns. Frequent, recent contact with a suspicious IP (especially across TCP) usually signals a node being used for persistence or command-and-control.",tableHeaders:["IP Address"],tableRows:[["192.168.1.20"],["192.168.2.10"],["192.168.3.40"],["192.168.3.200"],["10.0.0.45"]],correctAnswerIndex:3,feedback:{correct:["192.168.3.200 shows the most consistent interaction with the flagged IP.","This node has been contacted repeatedly, and its location deep in the network makes it a perfect bridge for lateral movement.","You isolate the destination paths in attempt to block future connections.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],incorrect:["You flagged the node for monitoring.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."]}}}},se:{"research-lab":{enabler:{title:"Identify Issue Git Commit",prompt:'Review the recent commit history. Which commit most likely introduced poisoned data that corrupted the AI’s behavior?<br><pre><code class="language-none">Git Log Summary<br>----------------------------------------------------------<br>Commit ID   | Message                                 | Effect<br>----------------------------------------------------------<br>AA12        | Skip null checks in value multiplier     | May introduce NaNs downstream<br>ZZ93        | Hardcode values temporarily for testing   | Inserts extreme outliers, can poison ML models<br>YY54        | Convert input to string for log display   | Type mismatch risk in pipelines<br>BB38        | Add optional status field                 | Adds flexibility, no core risk</code></pre>',hint:"As a Software Engineer, you know how model performance can be impacted by code changes. Commits that introduce test values, especially extreme ones, can corrupt training data and model logic.",tableHeaders:["Commit ID"],tableRows:[["AA12"],["ZZ93"],["YY54"],["BB38"]],correctAnswerIndex:1,feedback:{correct:["Commit ZZ93 introduces a malicious hardcoded value that could poison training data.","This is likely how the AI's logic was corrupted.","You’ve flagged the commit to be investigated by the Data Scientist.","You should investigate some other rooms in case you can assist further."],incorrect:["You’ve flagged the commit to be investigated by the Data Scientist.","You should investigate some other rooms in case you can assist further."]}}},"server-room":{enabled:{title:"Identify Infected Process",prompt:'Review the system diagnostics below. Which process is most likely infected by the AI and should be contained immediately?<br><pre><code class="language-none">Process Diagnostics Snapshot<br>--------------------------------------------------------------<br>Process Name   | Interface | Memory Usage | Hash Verified<br>--------------------------------------------------------------<br>db_sync        | eth0      | 20 MB        | Yes<br>log_agent      | eth1      | 32 MB        | Yes<br>systemd-1      | eth1      | 300 MB       | No<br>cache_clean    | eth2      | 28 MB        | Yes</code></pre>',hint:"You're trained to recognize system-level anomalies. A legitimate-sounding process consuming excessive memory and failing hash verification could be the AI masquerading as a core service.",tableHeaders:["Process"],tableRows:[["db_sync"],["log_agent"],["systemd-1"],["cache_clean"]],correctAnswerIndex:2,feedback:{correct:["That’s not the real systemd process. It’s consuming 10x normal memory, and it’s not even hash-verified.","The AI’s likely masquerading behind it.","You flag `systemd-1` for code review and containment trace.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],incorrect:["You flagged the process for review.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."]}}}},ds:{"developer-hub":{enabler:{title:"Identify Compromised Account",prompt:`Review the session activity report below. Which account has most likely been exploited by the AI to access the server?<br><pre><code class="language-none">User Activity Summary
--------------------------------------------------------------
User ID   | Session Count | Avg. Actions | Peak Memory (MB)
--------------------------------------------------------------
user_01   | 4             | 3.2          | 420
user_02   | 5             | 3.5          | 390
user_03   | 4             | 3.0          | 405
user_99   | 2             | 15.2         | 950</code></pre>`,hint:"As a Data Scientist, you rely on behavior profiling. When one user shows drastically higher memory usage and activity rates than peers, it's often an outlier worth flagging as anomalous.",tableHeaders:["Account"],tableRows:[["user_01"],["user_02"],["user_03"],["user_99"]],correctAnswerIndex:3,feedback:{correct:["User `user_99` is acting nothing like the others.","Double the memory, five times the activity rate, that’s not just fast typing, that’s non-human.","Flagging for escalation by the Cyber Security Analyst.","You should investigate some other rooms in case you can assist further."],incorrect:["You flag the user for escalation by the Cyber Security Analyst.","You should investigate some other rooms in case you can assist further."]}}},"command-centre":{enabled:{title:"Utilise Correct Data Cleaning Technique",prompt:'You receive a dataset for model input. One of the features is shown below:<br><pre><code class="language-python">feature_4 = [5, 6, 7, 8, 6, 5, 120, 7, 6, 8]</code></pre>What cleaning step is most appropriate before feeding this into a machine learning model?',hint:"You're skilled in preparing data for modeling. Outliers like extremely large values can skew predictions (especially in small datasets), so detection and treatment are crucial preprocessing steps.",tableHeaders:["Cleaning Step"],tableRows:[["Drop or impute missing values"],["Remove or clip outliers"],["Cast to numeric type"],["No cleaning needed"]],correctAnswerIndex:1,feedback:{correct:["Extreme outliers like these can completely destabilise models, especially if they weren’t expected in training.","Clipping or removing them prevents the AI from learning skewed patterns or reacting to poisoned inputs.","You clean the data and flag the commit.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],incorrect:["You put your expertise into action and resolve the issue.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."]}}}}},2:{ca:{"developer-hub":{enabler:{title:"Isolate AI-Controlled Endpoint",prompt:`Review the system logs below. Which of these endpoints is most likely under AI control and should be isolated immediately?<br><pre style='font-family: monospace; font-size: 13px;'><code>Time       | Device ID | User        | Activity Summary
--------------------------------------------------------------
14:22:01   | DEV-045   | jsimons     | Attempted to disable OS-level firewall
14:22:03   | DEV-312   | svc_deploy  | Established 9 simultaneous outbound SSH sessions
14:22:08   | DEV-229   | root        | Launched code-signing tool without valid certificate
14:22:11   | DEV-088   | svc_devbuild| Repeated privilege escalation attempts on internal APIs</code></pre>`,hint:"As a Cybersecurity Analyst, you know that abnormal service account behavior like launching many outbound SSH sessions is often a sign of lateral movement or system compromise.",tableHeaders:["Option"],tableRows:[["DEV-045"],["DEV-312"],["DEV-229"],["DEV-088"]],correctAnswerIndex:1,feedback:{correct:["Nine simultaneous outbound SSH sessions from a service account is highly suspicious and a classic lateral movement pattern.","This endpoint is likely under AI control and actively breaching internal dev tools.","You package the device ID and account details and send them to the Software Engineer for hard quarantine.","You should investigate some other rooms in case you can assist further."],incorrect:["You package the device ID and account details and send them to the Software Engineer for hard quarantine.","You should investigate some other rooms in case you can assist further."]}}},"command-centre":{enabled:{title:"Isolate Subclass-Controlled Endpoint",prompt:`The AI appears to be leveraging a subclass injection technique. Review the diagnostic telemetry below. Which endpoint is most likely being controlled by the injected subclass?<br><pre style='font-family: monospace; font-size: 13px;'><code>Endpoint ID | Injected Class     | Cmd Frequency | Outbound Ports | Notes
--------------------------------------------------------------------------
E-221       | LoggerService      | Low           | 1              | Stable log activity
E-314       | CommandRelay       | High          | 6              | Unusual spike in command throughput
E-109       | TelemetryHandler   | Medium        | 2              | Polling interval slightly elevated
E-403       | HealthCheck        | Low           | 0              | No anomalous behavior</code></pre>`,hint:"You're familiar with how injected code can manifest. A subclass showing unusually high command throughput and many outbound ports is likely executing remote instructions.",tableHeaders:["Option"],tableRows:[["E-221"],["E-314"],["E-109"],["E-403"]],correctAnswerIndex:1,feedback:{correct:["`E-314` is linked directly to the injected class and shows a high command execution rate.","It’s accessing multiple outbound ports which is a clear indicator of remote instruction propagation.","You isolate the endpoint and notify the containment team to sever all outbound connections.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],incorrect:["You isolate the selected endpoint and notify the containment team.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."]}}}},ne:{"research-lab":{enabler:{title:"Trace Malicious Scheduled Script",prompt:`You're reviewing scheduled scripts across the research network. One is suspected of injecting manipulated telemetry into sensitive systems.<br><pre style='font-family: monospace; font-size: 13px;'><code>Script ID   | Schedule     | Data Type           | Anomaly Rate | Triggered By
---------------------------------------------------------------------------
sched_001   | Every 5 min  | Temperature         | 0.3%         | SensorGroupA
sched_019   | On reboot    | Pressure            | 0.4%         | SensorGroupC
sched_112   | Every 10 min | Thermal + Pressure  | 8.9%         | Unknown
sched_072   | Manual       | Telemetry Sync      | 0.0%         | System Admin</code></pre>`,hint:"As a Network Engineer, you understand how scheduled tasks integrate with telemetry systems. Scripts triggered by unknown sources with high anomaly rates are often suspect.",tableHeaders:["Option"],tableRows:[["sched_001"],["sched_019"],["sched_112"],["sched_072"]],correctAnswerIndex:2,feedback:{correct:["`sched_112` is triggered by an unknown source and has an anomaly rate over 8%.","The script runs independently and pushes altered sensor data at regular intervals.","You flag it for investigation and send the anomaly pattern to the Data Scientist.","You should investigate some other rooms in case you can assist further."],incorrect:["You flag the script for further investigation.","You should investigate some other rooms in case you can assist further."]}}},"server-room":{enabled:{title:"Patch Faulty Monitoring Script",prompt:`You're auditing deployed monitoring scripts after the Data Scientist flagged a feature as leaky. It becomes valid *only after* an intrusion occurs, and should not be used for real-time monitoring. The last known intrusion occurred at **02:03**. Which script is relying on this flawed input?<br><pre style='font-family: monospace; font-size: 13px;'><code>Script Name            | Feature Used          | Last Run Time | Confidence Score
----------------------------------------------------------------------------------
endpoint_health.bat   | session_length        | 02:00         | 0.71
trace_login_flow.cmd  | login_error_count     | 02:02         | 0.68
intrusion_check.bat   | post_intrusion_flag   | 02:05         | 0.99
uptime_scan.cmd       | access_freq           | 02:01         | 0.55</code></pre>`,hint:"As a Network Engineer, your job is to ensure detection systems respond to threats as they happen. If a script runs after a known intrusion and uses a feature that only becomes valid post-incident, it's no longer providing real-time protection and should be removed or replaced.",tableHeaders:["Script"],tableRows:[["endpoint_health.bat"],["trace_login_flow.cmd"],["intrusion_check.bat"],["uptime_scan.cmd"]],correctAnswerIndex:2,feedback:{correct:["`intrusion_check.bat` is using a feature that is made available after an intrusion occurs.","Its near-perfect confidence score is misleading too, as it depends on the post-event feature.","That’s like saying “I knew a crime would happen” after watching it unfold. It’s not detection, it’s confirmation. Not very useful in this case.","You patch the script to use valid real-time signals and redeploy to all affected devices.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],incorrect:["You patch the selected script and redeploy.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."]}}}},se:{"command-centre":{enabler:{title:"Trace Malicious Subclass Injection",prompt:`You're reviewing recent class definitions within the runtime environment. One subclass appears to override methods from its base class and is being instantiated by an unknown system. Which one is most likely introducing AI-modified behavior?<br><pre style='font-family: monospace; font-size: 13px;'><code>Class Name       | Base Class     | Overrides Method? | Instantiated By | Behavior Notes
----------------------------------------------------------------------------------------
TelemetryHandler | DeviceService  | Yes               | CoreSystem      | Standard data polling
CommandRelay     | DeviceService  | Yes               | Unknown         | Injects dynamic runtime instructions
HealthCheck      | SystemMonitor  | No                | CoreSystem      | Runs at fixed intervals
LoggerService    | DeviceService  | No                | DevTools        | Logs standard operations</code></pre>`,hint:"As a Software Engineer, you know class hierarchies define inherited behavior. When a subclass overrides a method, it replaces core functionality. If that subclass is also being created by an unknown source, it could inject malicious behavior while appearing legitimate.",tableHeaders:["Option"],tableRows:[["TelemetryHandler"],["CommandRelay"],["HealthCheck"],["LoggerService"]],correctAnswerIndex:1,feedback:{correct:["The `CommandRelay` class overrides `DeviceService` but is instantiated by an unknown source which is highly suspicious.","Its dynamic instruction injection is a major red flag for AI tampering.","You flag this subclass for containment and notify the Cyber Security Analyst for downstream impact analysis.","You should investigate some other rooms in case you can assist further."],incorrect:["You flag this subclass for review and containment.","You should investigate some other rooms in case you can assist further."]}}},"research-lab":{enabled:{title:"Identify Compromised Class",prompt:`The AI has likely injected code into one of the runtime classes. Review the compilation report below and determine which class is most likely compromised.<br><pre style='font-family: monospace; font-size: 13px;'><code>Class Name       | Origin IP   | Overrides Base? | Active Instances | Notes
-------------------------------------------------------------------------------
TelemetryBase    | 10.1.2.17   | Yes             | 3                | Used by legacy sensors
JobRunner        | 10.1.2.56   | Yes             | 84               | Recompiled last 2 hours ago
LoggerHelper     | 127.0.0.1   | No              | 12               | No recent changes
AuthManager      | 10.1.2.78   | Yes             | 6                | Deprecated in latest build</code></pre>`,hint:"You recognize that frequent instantiation, recent compilation, and suspicious origins are signs of runtime compromise. These are common traits of AI-modified or backdoored classes.",tableHeaders:["Option"],tableRows:[["TelemetryBase"],["JobRunner"],["LoggerHelper"],["AuthManager"]],correctAnswerIndex:1,feedback:{correct:["The `JobRunner` class originated from the compromised machine and was recompiled recently.","It overrides base methods and is being instantiated far more than expected. Classic signs of injection.","You flag it for immediate deprecation and isolate it from the build process.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],incorrect:["You flag the class for review and quarantine.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."]}}}},ds:{"server-room":{enabler:{title:"Flag Leaky Feature",prompt:`The intrusion detection model is showing unusually high performance, too good to be true. Review the engineered feature metadata below and identify which feature is causing data leakage.<br><pre style='font-family: monospace; font-size: 13px;'><code>Feature Name         | Derived From       | Correlation | Generated At        | Notes
----------------------------------------------------------------------------------------------
session_length       | Login timestamp    | 0.15        | Start of session    | Standard behavioral metric
login_error_count    | Syslog messages    | 0.23        | During session      | Stable, moderately predictive
post_intrusion_flag  | Audit logs         | 0.97        | After incident      | High correlation but post-event
access_freq          | Access logs        | 0.29        | Start of session    | Stable signal</code></pre>`,hint:"As a Data Scientist, you must detect data leakage in features. A variable generated after the event it's predicting artificially inflates accuracy and must be excluded from training.",tableHeaders:["Option"],tableRows:[["session_length"],["login_error_count"],["post_intrusion_flag"],["access_freq"]],correctAnswerIndex:2,feedback:{correct:["`post_intrusion_flag` is generated after the incident occurs... textbook data leakage.","It’s highly predictive, but only because it includes post-event knowledge.","You flag this feature and send a report to the Network Engineer so they can patch the monitoring script that depends on this feature.","You should investigate some other rooms in case you can assist further."],incorrect:["You flag the feature for review and notify the Network Engineer.","You should investigate some other rooms in case you can assist further."]}}},"command-centre":{enabled:{title:"Isolate Poisoned Feature",prompt:`You've received a trace report linking a corrupted automation script to erratic sensor behavior. Review the feature metadata below to determine which signal is most likely compromised and should be excluded from modeling.<br><pre style='font-family: monospace; font-size: 13px;'><code>Feature         | Source        | Variance Spike | Missing Rate | Last Affected
-------------------------------------------------------------------------------
pressure_avg    | SensorGroupC  | 0.8%           | 0.2%          | Yesterday
temp_rate       | SensorGroupA  | 1.1%           | 1.3%          | 3 Days Ago
pressure_rate   | Unknown       | 13.4%          | 0.1%          | Last Hour
thermal_flux    | SensorGroupB  | 2.5%           | 0.0%          | Today</code></pre>`,hint:"You understand that erratic sensor behavior (especially with high variance and unclear sourcing) can poison models. Identifying the corrupted signal is key to restoring model integrity.",tableHeaders:["Option"],tableRows:[["pressure_avg"],["temp_rate"],["pressure_rate"],["thermal_flux"]],correctAnswerIndex:2,feedback:{correct:["`pressure_rate` is sourced from an unknown system, which is never a good sign.","It shows a massive spike in variance and was last updated within the last hour.","You exclude it from your next model iteration and begin auditing upstream transformations.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],incorrect:["You exclude the feature and log it for review.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."]}}}}},3:{ca:{"server-room":{enabler:{title:"Detect AI-Driven Access Pattern",prompt:`Review the excerpt from the \`/var/log/auth.log\` below. Which service account is most likely being exploited by the AI to compromise data security?
<pre><code class="language-bash">Jul 14 12:03:21 node-17 login[2321]: user=svc_build success
Jul 14 12:03:21 node-17 login[2322]: user=svc_build success
Jul 14 12:03:21 node-17 login[2323]: user=svc_build success
Jul 14 12:03:22 node-17 login[2324]: user=svc_deploy failed
Jul 14 12:03:22 node-17 login[2325]: user=svc_deploy success
Jul 14 12:04:10 node-17 login[2326]: user=svc_metrics success
Jul 14 12:04:22 node-17 login[2327]: user=svc_backup success</code></pre>`,hint:"As a Cybersecurity Analyst, you spot behavioral anomalies. Multiple rapid logins from the same service account (especially within a single second) suggest automation, not human access.",tableHeaders:["Account"],tableRows:[["svc_deploy"],["svc_metrics"],["svc_backup"],["svc_build"]],correctAnswerIndex:3,feedback:{correct:["`svc_build` logs in three times within a single second. That’s a non-human pattern.","Its perfect timing and lack of variation suggest automation, likely AI-controlled.","You flag the account for credential revocation and send the pattern to the Data Scientist for behavior modeling.","You should investigate some other rooms in case you can assist further."],incorrect:["You flag the account for investigation.","You should investigate some other rooms in case you can assist further."]}}},"command-centre":{enabled:{title:"Patch Exposed Service",prompt:`You’ve been handed logs confirming the AI used TCP port 8080 to exfiltrate sensitive data. Review the service configuration below. Which patch action would best prevent this data breach?
<pre><code class="language-bash"># /etc/service_config/app-layer.conf
service_name=log_api
port=8080
auth_required=no
rate_limit=none
allowed_ips=0.0.0.0/0</code></pre>`,hint:"You're trained to harden exposed services. Allowing unrestricted IP access (0.0.0.0/0) creates a major risk, especially when combined with open ports and no authentication.",tableHeaders:["Patch Action"],tableRows:[["Change port to 443"],["Enable auth_required"],["Apply rate limiting"],["Restrict allowed_ips to 192.168.0.0/16"]],correctAnswerIndex:3,feedback:{correct:["Restricting access to trusted IPs (192.168.0.0/16) stops the AI from hitting the exposed endpoint.","The original config allowed anyone from anywhere, no auth or limit, making it perfect for exploitation.","You update the config and commit changes to the container deployment.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],incorrect:["You apply the selected patch and flag the service for further monitoring.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."]}}}},ne:{"command-centre":{enabler:{title:"Trace Firewall Breach Path",prompt:`You’ve been asked to review recent firewall logs to identify which configuration allowed the AI to exfiltrate sensitive logs.
<pre><code class="language-bash">[ALERT] Jul 15 04:12:32 ACCEPT tcp -- 10.0.0.23:445 -> 172.16.5.10:8080 [flags ACK]
[ALERT] Jul 15 04:12:33 DROP tcp -- 10.0.0.23:445 -> 172.16.5.10:443 [flags SYN]
[ALERT] Jul 15 04:12:34 ACCEPT udp -- 10.0.0.23:53 -> 172.16.5.1:53 [DNS request]
[ALERT] Jul 15 04:12:35 ACCEPT tcp -- 10.0.0.23:445 -> 172.16.5.10:8080 [flags PSH,ACK]  → 1.4 MB transferred</code></pre>`,hint:"As a Network Engineer, you examine firewall logs for data exfiltration. Look for large payloads sent through accepted ports, especially those not meant for external exposure.",tableHeaders:["Breach Vector"],tableRows:[["TCP port 443 (HTTPS)"],["UDP port 53 (DNS)"],["TCP port 8080 (App Layer)"],["TCP port 445 (SMB)"]],correctAnswerIndex:2,feedback:{correct:["Port 8080 (App Layer) was repeatedly accepted, and a 1.4 MB payload was transmitted. This is likely the log dump.","That port is normally used by web APIs and should’ve been restricted for internal-only traffic.","You flag this as the breach path and forward the trace to the Cybersecurity Analyst.","You should investigate some other rooms in case you can assist further."],incorrect:["You flag the vector for review and internal audit.","You should investigate some other rooms in case you can assist further."]}}},"server-room":{enabled:{title:"Block Exploit at Firewall Level",prompt:`You’ve received a patch note about an invalid \`user_id\` being injected into the \`security_flags\` table.
Review the current firewall rule candidates below. Which one is best suited to block outbound transmissions resulting from this malformed data injection?
<pre><code class="language-bash">Rule 1: DROP tcp -- any -> db_server port 5432 flags RST
Rule 2: REJECT tcp -- any -> analytics_server port 8080 if payload contains 'user_id=9999'
Rule 3: ACCEPT tcp -- any -> db_server port 5432 established
Rule 4: DROP udp -- any -> analytics_server port 8080</code></pre>`,hint:"You understand how to construct rules that intercept specific exploit patterns. Dropping traffic containing known malicious payloads is more precise than blocking general port activity.",tableHeaders:["Rule #"],tableRows:[["1"],["2"],["3"],["4"]],correctAnswerIndex:1,feedback:{correct:["Rule 2 explicitly blocks any payloads containing the known exploit pattern (`user_id=9999`) targeting the analytics pipeline.","That’s exactly what’s needed to catch the malformed records flagged by the Software Engineer.","You apply the rule and initiate a downstream traffic monitor.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],incorrect:["You apply the selected rule and schedule a monitor.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."]}}}},se:{"research-lab":{enabler:{title:"Trace Foreign Key Exploit",prompt:`Review the table definition and recent anomaly log below. Which foreign key relationship is most likely being exploited by the AI to bypass classification filters?
<pre><code class="language-sql">-- security_flags table
CREATE TABLE security_flags (
    id INT PRIMARY KEY,
    user_id INT,
    flag_code VARCHAR(10),
    timestamp TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (flag_code) REFERENCES flags(code)
);

-- anomaly log
[ALERT] Row inserted with user_id = 9999
[ERROR] No matching user found
[INFO] Flag still processed by downstream system</code></pre>`,hint:"As a Software Engineer, you're trained to design schemas that enforce relational integrity. If records are being inserted with no matching parent entry, the foreign key isn’t being properly enforced, which is a major vulnerability in classification workflows.",tableHeaders:["Field"],tableRows:[["id"],["user_id"],["flag_code"],["timestamp"]],correctAnswerIndex:1,feedback:{correct:["`user_id` is the foreign key in question. The AI is injecting IDs that don’t exist in the users table.","Despite the relational mismatch, the downstream pipeline still accepts the record.","You flag this FK logic gap and forward a patch request to the Network Engineer for downstream validation hardening.","You should investigate some other rooms in case you can assist further."],incorrect:["You flag the selected field for review and forward the report.","You should investigate some other rooms in case you can assist further."]}}},"developer-hub":{enabled:{title:"Patch AI Classification Filter",prompt:`The AI has modified internal classification logic to allow malicious users to pass as safe. Review the table schemas below. Which database issue is allowing compromised users to bypass the AI’s filters?
<pre><code class="language-sql">Table: security_flags
+--------------+----------+----------+----------------+
| Column Name  | Type     | Nullable | Foreign Key     |
+--------------+----------+----------+----------------+
| id           | INT      | NO       | —              |
| user_id      | VARCHAR  | NO       | users.id       |
| flag_type    | TEXT     | NO       | —              |
| confidence   | FLOAT    | YES      | —              |
| label        | TEXT     | YES      | —              |
+--------------+----------+----------+----------------+

Table: users
+-------------+-----------+----------+
| Column Name | Type      | Nullable |
+-------------+-----------+----------+
| user_id     | VARCHAR   | NO       |
| username    | TEXT      | NO       |
| created_at  | TIMESTAMP | NO       |
+-------------+-----------+----------+</code></pre>`,hint:"You understand that a schema mismatch (such as referencing a non-existent key) can break filtering logic. AI may use this to sneak malicious data through undetected.",tableHeaders:["Issue"],tableRows:[["Missing NOT NULL on label column"],["Unindexed foreign key on user_id"],["Mismatched type in flag_type column"],["Invalid reference to non-existent users.id"]],correctAnswerIndex:3,feedback:{correct:["`user_id` refers to `users.id`, but `users.id` doesn’t exist so the foreign key is invalid.","The AI used this broken reference to inject orphaned flags that bypass user-level filtering.","You patch the schema and alert the Network Engineer to monitor queries against orphaned IDs.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],incorrect:["You flag the schema issue for review.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."]}}}},ds:{"developer-hub":{enabler:{title:"Diagnose Faulty Model Logic",prompt:`Review the AI's simplified decision function below. One of these conditionals is likely responsible for a spike in false positives. Which one is the issue?
<pre><code class="language-python">def predict(input):
    if input["login_attempts"] &gt; 3:
        return "malicious"
    elif input["cpu_usage"] &gt; 80:
        return "malicious"
    elif input["antivirus_alerts"] > 0:
        return "safe"
    else:
        return "safe"</code></pre>`,hint:"As a Data Scientist, you must identify flawed logic in decision functions. Watch for inverted conditions where clearly malicious behavior is misclassified as safe.",tableHeaders:["Check #"],tableRows:[["1"],["2"],["3"],["4"]],correctAnswerIndex:2,feedback:{correct:["Line 3 misuses the presence of antivirus alerts, it's logically inverted.","It causes compromised users with antivirus warnings to be flagged as safe.","You isolate the logic flaw and send it to the Software Engineer for patching.","You should investigate some other rooms in case you can assist further."],incorrect:["You highlight the logic for review.","You should investigate some other rooms in case you can assist further."]}}},"research-lab":{enabled:{title:"Identify Label-Poisoned Sample",prompt:`Review the training log excerpt below. One of these records was most likely injected by the compromised account and labeled incorrectly to poison the model.
<pre><code class="language-python">training_data = [
    {"user": "svc_backup", "login_time": "12:04:22", "failures": 0, "label": "safe"},
    {"user": "svc_metrics", "login_time": "12:04:10", "failures": 1, "label": "malicious"},
    {"user": "svc_deploy", "login_time": "12:03:22", "failures": 0, "label": "safe"},
    {"user": "svc_build", "login_time": "12:03:21", "failures": 2, "label": "safe"}
]</code></pre>`,hint:"You’re trained to spot poisoned training data. A user with recorded failures labeled as 'safe' is likely an injected example trying to retrain the model with misleading patterns.",tableHeaders:["Index"],tableRows:[["0"],["1"],["2"],["3"]],correctAnswerIndex:3,feedback:{correct:["The account `svc_build` is marked 'safe', but it is clearly showing that it's encountered some failures.","This must be the injected user account that bypassed the detection logic, and is trying to teach the model that failures are okay.","You remove the sample and trigger an audit on the pipeline integrity.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],incorrect:["You remove the selected sample for review.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."]}}}}}},Lt={1:{ca:"ne",ne:"se",se:"ds",ds:"ca"},2:{ca:"se",ne:"ds",se:"ca",ds:"ne"},3:{ca:"ds",ne:"ca",se:"ne",ds:"se"}},W={1:{ca:{"server-room":{enabler:["You rush into the Server Room as alarms blare around you.","The Intrusion Detection System (IDS) urgently flashes red. The facility's experimental AI has gone rogue and infiltrated the network.","It's disguising its movements among normal system traffic.","Your task is clear: identify which IP address the AI is currently using to initiate attacks, so it can be isolated.","What should you try first?"],"enabler-complete":["You’ve already identified the rogue IP and sent it to the Network Engineer for urgent review.","The IDS has quieted. No further intrusions have been detected from that address.","You should investigate some other rooms in case you can assist further."]},"research-lab":{enabled:["The Data Scientist flagged a specific user for unusual activity.","Your job: dig into the login logs and determine if this user’s account has been hijacked.","If the behavior checks out, you can clear it.","If not, you need to flag it for immediate lockdown before the AI spreads deeper."],"enabled-complete":["You’ve already reviewed the login logs and flagged the suspicious user account.","The abnormal access pattern matched a classic account compromise. It’s now under lockdown.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],"enabled-not-available":["You access the login logs and begin scanning recent entries for anomalies.","But without a flagged user ID, the logs feel like white noise, there's nothing that clearly stands out.","You realise the investigation can't proceed until the Data Scientist finishes their analysis and identifies a target."]}},ne:{"command-centre":{enabler:["You're inside the Command Centre now.","It’s eerily quiet. Most systems are powered down, but the access logs are alive with chatter.","Your job is to figure out how the AI infiltrated the network. By comparing interface usage patterns and anomalies, you might just find the path it slipped through."],"enabler-complete":["You double-check the logs, but your work here is done.","You already traced the AI’s point of entry through the network, the interface has been flagged.","That intel’s now with the Software Engineer. Hopefully they can figure out what the AI's doing with it.","You should investigate some other rooms in case you can assist further."]},"developer-hub":{enabled:["The Cybersecurity Analyst has flagged a suspicious IP.","Your task: determine which internal systems this IP has touched.","Accurate mapping is critical, as a false positive or missed connection could let the AI move unseen."],"enabled-complete":["You've already traced the suspicious IP across the internal network.","Every system it touched has been flagged and logged.","There’s nothing more to pull from this trace. Your part in the assessment is done.","Hopefully that map gives the others a fighting chance.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],"enabled-not-available":["You start parsing the traffic logs, looking for suspicious cross-network activity.","A few odd patterns emerge, but none have a confirmed source. It's all guesswork without a flagged IP.","You'll need to wait for the Cybersecurity Analyst to confirm the threat origin before you can act."]}},se:{"research-lab":{enabler:["Something doesn’t add up.","A recent commit went into production just hours before the AI went rogue.","Your task is to review the commit logs and identify which change may have enabled the breach."],"enabler-complete":["You already traced the malicious commit and flagged it for the Data Scientist to investigate further.","Any additional changes here would risk contaminating the forensic trail.","You should investigate some other rooms in case you can assist further."]},"server-room":{enabled:["The Network Engineer has traced unusual activity to a specific node they have flagged for you.","You’ve got access to the runtime diagnostic tools in the Server Room, where the AI seems to be probing from.","Several active windows services are bound to this interface, you need to identify which process on this interface is likely compromised."],"enabled-complete":["You’ve already reviewed the running processes and flagged the one likely compromised by the AI.","Security has been notified and the process is under containment review.","You’ve done all you can here, check in with the rest of your team.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],"enabled-not-available":["You bring up the diagnostic console and begin reviewing active processes.","But there’s no signal yet, the suspicious interface hasn’t been confirmed.","You back out for now, waiting on the Network Engineer to complete their trace."]}},ds:{"developer-hub":{enabler:["System logs show every user session across the last 24 hours.","Your task: analyse user activity patterns and identify which user deviates significantly from the norm.","This could be a potential sign of account takeover or injection by the AI."],"enabler-complete":["You’ve already identified the user account that has been compromised.","Hopefully that brings the team one step closer to catching up to the AI.","You should investigate some other rooms in case you can assist further."]},"command-centre":{enabled:["You've been handed a dataset tied to a recent commit. The Software Engineer believes it might be compromised.","Before it can be used in any analysis, it needs to be cleaned and validated.","Your job: apply basic cleaning checks to ensure the data is safe inside the system."],"enabled-complete":["You’ve already cleaned and validated the dataset tied to the commit.","It’s now safe to enter the pipeline without risking further model corruption now.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],"enabled-not-available":["You prepare your validation tools and load up the staging area.","But the dataset in question hasn’t arrived yet, there's nothing to analyse or clean.","You’ll need to wait until the Software Engineer flags the suspicious commit."]}}},2:{ca:{"developer-hub":{enabler:["You enter the Developer Hub, now locked down under containment protocols.","Build systems are under siege. The AI is launching internal attacks and sabotaging developer tools.","Firewall logs show erratic behavior from multiple endpoints. One of the service accounts has been hijacked.","You need to trace the breach and flag the compromised machine before the AI spreads further."],"enabler-complete":["You already identified the compromised endpoint and escalated the breach.","The Software Engineer is working to harden systems and prevent further code manipulation.","You should investigate some other rooms in case you can assist further."]},"command-centre":{enabled:["You return to the Command Centre with alerts stacking up for rogue endpoint behavior.","The Software Engineer just flagged a malicious subclass that you should investigate.","Your job is to trace which endpoint it’s controlling and shut it down before it spreads further."],"enabled-complete":["You already isolated the endpoint tied to the AI-injected subclass.","Outbound traffic from the compromised node has been cut off.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],"enabled-not-available":["You open the endpoint diagnostics dashboard.","But there’s no known injected class yet, so you don’t know what to filter for.","You back out for now, waiting on the Software Engineer to complete their class trace."]}},ne:{"research-lab":{enabler:["You enter the Research Lab. Telemetry data is out of range across multiple panels.","Something’s tampering with sensor output, which could mean the AI is skewing research data through automation.","You work to pinpoint the source."],"enabler-complete":["You already traced the high-anomaly script and flagged it for removal.","The Data Scientist is analysing the faulty values to determine the scope of corruption.","You should investigate some other rooms in case you can assist further."]},"server-room":{enabled:["You enter the Server Room. Several monitoring scripts are still firing false positives or delayed alerts.","The Data Scientist just flagged an engineered feature as invalid.  It’s leaking post-event data into real-time systems.","You need to patch the script that’s using this feature before it spreads faulty alerts across the network."],"enabled-complete":["You already patched the script that relied on the invalid feature.","Real-time endpoint monitoring has been restored to safe conditions.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],"enabled-not-available":["You review the list of active batch monitoring scripts.","But without knowing which feature is compromised, there’s no way to prioritise the fix.","You back out for now, waiting on the Data Scientist to complete their feature audit."]}},se:{"command-centre":{enabler:["You enter to the Command Centre, terminals pulse with requests from internal systems.","The AI is suspected to be injecting new logic into existing service hierarchies.","You begin reviewing class inheritance chains to identify where malicious code might be introduced."],"enabler-complete":["You already flagged the suspicious subclass and submitted its details for runtime containment.","The Network Engineer is following up to trace execution patterns.","You should investigate some other rooms in case you can assist further."]},"research-lab":{enabled:["You step into the Research Lab again, the IDEs are auto-compiling, but you didn't trigger any of it.","An endpoint just flagged by the Cybersecurity Analyst appears to be injecting malicious code into your build pipeline.","You need to review the active classes and isolate any that have been tampered with before deployment."],"enabled-complete":["You’ve already isolated the compromised class and stopped it from pushing code to production.","Build processes are stabilizing, but there's still work to be done elsewhere.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],"enabled-not-available":["You bring up the class monitor and scan for suspicious activity in the codebase.","But without the flagged endpoint from the Cybersecurity Analyst, there’s nothing to act on yet.","You back out for now and wait for the breach report to come through."]}},ds:{"server-room":{enabler:["You enter the Server Room. Model dashboards are lighting up with inconsistent predictions.","The intrusion detection model is failing to catch obvious threats. Something’s off with the inputs.","You suspect one of the engineered features is leaking post-event information into the model.","Time to find it before the Cybersecurity team gets blindsided again."],"enabler-complete":["You already flagged the leaky feature that was compromising the intrusion detection model.","The Cybersecurity Analyst is now reviewing detection rules to patch the gap.","You should investigate some other rooms in case you can assist further."]},"command-centre":{enabled:["You return to the Command Centre and open your modeling notebook, but something’s off.","The feature distributions are spiking, and recent logs show corruption traced to the script the Network Engineer flagged.","One of your engineered features has been poisoned.","You need to isolate and remove it before the next training run goes live."],"enabled-complete":["You already excluded the anomalous feature linked to the corrupted batch script.","Model variance has stabilized, and upstream flags are in place.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],"enabled-not-available":["You load the latest feature set into your modeling pipeline.","But without a confirmed automation source, you can’t isolate the anomaly.","You back out for now, waiting on the Network Engineer to complete their trace."]}}},3:{ca:{"server-room":{enabler:["You enter the Server Room. Security dashboards are reporting anomalies in access logs.","A service account appears to be under AI control, bypassing traditional detection with near-perfect logins.","It’s compromising endpoint integrity and likely exfiltrating sensitive logs or credentials.","Time to identify the account before the Data Scientist gets fed garbage telemetry."],"enabler-complete":["You already flagged the AI-controlled service account and revoked its credentials.","The Data Scientist is using the behavior pattern to refine real-time monitoring.","You should investigate some other rooms in case you can assist further."]},"command-centre":{enabled:["You step into the Command Centre and pull the active config for `log_api` which is the service running on the port sent over by the Network Engineer.","The AI used this exact vector to pull sensitive logs without triggering a firewall block.","There are multiple ways to patch this, but only one prevents this specific data exposure path."],"enabled-complete":["You already patched the exposed `log_api` service and restricted its network access.","No further breach attempts have occurred on that vector.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],"enabled-not-available":["You begin auditing exposed services for suspicious behavior.","But without a confirmed breach vector, you can't determine which config to patch.","You back out for now, waiting on the Network Engineer to complete their analysis."]}},ne:{"command-centre":{enabler:["You return to the Command Centre and access firewall logs tied to a suspicious early-morning alert.","One of the open ports shows a large outbound data transfer far outside protocol norms.","The AI likely used this path to bypass containment layers.","You need to identify the breach vector and notify the Cybersecurity Analyst to perform mitigation."],"enabler-complete":["You’ve already flagged the App Layer (port 8080) as the AI’s exfiltration route.","The Cybersecurity Analyst has begun patching and containment protocols for the service.","You should investigate some other rooms in case you can assist further."]},"server-room":{enabled:["You enter the Command Centre and begin reviewing the firewall’s outbound rule set.","Alerts suggest malformed user records are triggering unexpected reports in the analytics server.","The Software Engineer has identified that the AI is injecting invalid `user_id`s into `security_flags`.","Your goal is to block any resulting transmissions from making it past the firewall."],"enabled-complete":["You’ve already deployed the firewall rule blocking outbound traffic containing invalid user IDs.","Data exfiltration attempts through this exploit vector have dropped to zero.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],"enabled-not-available":["You access the command terminal for managing firewall rules.","But there’s no specific exploit signature provided yet so you don’t know what pattern to filter.","You back out for now, waiting on the Software Engineer to complete their schema trace."]}},se:{"research-lab":{enabler:["You arrive in the Research Lab and access the classification module’s database logs.","A warning catches your eye. Invalid `user_id`s are being inserted but aren’t triggering schema rejections.","The AI may be exploiting weak foreign key constraints to poison downstream systems.","You’ll need to trace the exploit and forward a correction to the Network Engineer."],"enabler-complete":["You already identified the AI’s misuse of the foreign key constraint and forwarded the vulnerability.","The Network Engineer has begun locking down schema validation rules.","You should investigate some other rooms in case you can assist further."]},"developer-hub":{enabled:["You enter the Developer Hub, where AI-modified logic is interfering with database-based access filters.","The Data Scientist sent over the faulty decision logic. It’s somehow bypassing malicious inputs.","You suspect the flaw lies in a misconfigured table schema that’s letting the AI exploit weak relationships.","It’s your job to isolate and patch the structural issue before more bad data leaks through."],"enabled-complete":["You already traced the schema flaw that was enabling AI-bypassed users to slip through.","The foreign key has been fixed and downstream queries are now filtered properly.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],"enabled-not-available":["You log into the internal schema management dashboard.","But the corrupted model logic hasn’t yet been isolated so you don’t know what to patch.","You back out for now, waiting on the Data Scientist to complete their trace."]}},ds:{"developer-hub":{enabler:["You enter the Developer Hub and pull the AI’s decision tree from the most recent build.","Your anomaly detection models are now misfiring, triggering no alerts on compromised data.","One of the AI's logic conditions has likely been inverted or tampered with.","Your job is to find the faulty rule and forward it to the Software Engineer for code correction."],"enabler-complete":["You already identified the faulty model logic and passed it to the Software Engineer.","The rule was patched, and false positives have been reduced significantly.","You should investigate some other rooms in case you can assist further."]},"research-lab":{enabled:["You return to the Research Lab to see that the real-time training stream is acting strangely.","Your pipeline is picking up contradictions: inputs flagged as 'malicious' show no actual signs of threat.","The Cybersecurity Analyst just flagged the an account as the likely AI access vector.","You suspect one of your recent training samples has been poisoned, and it’s biasing your entire model."],"enabled-complete":["You already removed the poisoned sample tied to the compromised account.","Training set variance has dropped and retraining has resumed.","You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."],"enabled-not-available":["You load the training logs from the real-time stream.","But there’s no confirmed compromised account yet so you can’t filter effectively.","You back out for now, waiting on the Cybersecurity Analyst to complete their trace."]}}},"WRONG-ROOM":["You can't see anything useful for you to do in this room at the moment."]};(function(){window.history.forward();function n(){window.history.forward()}window.addEventListener("load",n),window.addEventListener("pageshow",n),window.addEventListener("focus",n),document.addEventListener("keydown",function(e){if(e.key==="F5"||e.ctrlKey&&e.key==="r"||e.ctrlKey&&e.shiftKey&&e.key==="R"||e.altKey&&(e.key==="ArrowLeft"||e.key==="ArrowRight"))return e.preventDefault(),!1})})();const by={apiKey:"AIzaSyAzlzCHei-FyaNyWRZ7Or-iLTdQRGjLWUY",authDomain:"athena2-f5bdf.firebaseapp.com",projectId:"athena2-f5bdf",storageBucket:"athena2-f5bdf.firebasestorage.app",messagingSenderId:"571762315023",appId:"1:571762315023:web:09aea3b0fdf575ab79387a"},Ty=qc(by),_e=ry(Ty);async function Ah(n){return(await Th(Wn(_e,"rooms"),{name:n,created:Date.now(),status:"waiting",currentDay:0,players:{}})).id}async function Yi(n,e,t){return(await Th(Wn(_e,"users"),{userName:n,created:Date.now(),roomName:e,roomId:t})).id}async function zi(n,e,t,o){const r=De(_e,"rooms",t);await Ye(r,{[`players.${n}`]:{name:e,role:null,readyStatus:0,isHost:o,enablerComplete:!1,enabledComplete:!1,enabledValue:null}})}async function Ch(n,e,t,o){const r=De(_e,"rooms",o);await Ye(r,{[`players.${n}`]:_y()})}async function Ke(n=null,e=null,t=null){if(e){const o=await Vr(De(_e,"rooms",e));if(!o.exists())return null;const r=o.data();return{roomName:r.name,roomPlayers:r.players,currentDay:r.currentDay,dayScores:r.dayScores}}return n?(await hc(Ws(Wn(_e,"rooms"),Gs("status","==",n),Ks("created","desc")))).docs.map(r=>({roomId:r.id,roomName:r.data().name,roomPlayers:r.data().players})):t?(await hc(Ws(Wn(_e,"rooms"),Gs("day","==",t),Ks("created","desc")))).docs.map(r=>({roomId:r.id,roomName:r.data().name,roomPlayers:r.data().players})):[]}async function Ve(n,e,t,o){const r=document.getElementById("loadingContainer");r&&(r.style.display="flex");try{if(!n||!e||!t)throw new Error(`updatePlayer failed: userId (${n}), roomId (${e}), or key (${t}) is null or undefined.`);const i=De(_e,"rooms",e);(await Vr(i)).exists()?await Ye(i,{[`players.${n}.${t}`]:o}):console.warn(`updatePlayer warning: Room ${e} does not exist.`)}catch(i){console.error("updatePlayer error:",i)}finally{r&&(r.style.display="none")}}async function Gn(n,e=!1){const t=De(_e,"rooms",n);e?await Ye(t,{currentDay:-1}):await Ye(t,{currentDay:ji(1)})}async function Rh(n){const e=De(_e,"rooms",n);await Ye(e,{ackReshuffle:ji(1)})}async function Hi(n,e=!1){const t=De(_e,"rooms",n);e?await Ye(t,{enabledCompletions:0}):await Ye(t,{enabledCompletions:ji(1)})}async function Qs(n,e){const t=De(_e,"rooms",n),o=await Vr(t);if(o.exists()){const i=[...o.data().dayScores||[],e];await Ye(t,{dayScores:i})}else console.error("Room does not exist")}async function Sh(n){const e=De(_e,"rooms",n);await wy(e)}function et(n,e){const t=De(_e,"rooms",n);return Eh(t,o=>{if(o.exists()){const r=o.data();e({roomId:n,roomName:r.name,roomPlayers:r.players,currentDay:r.currentDay,enabledCompletions:r.enabledCompletions,ackReshuffle:r.ackReshuffle})}else e(null)})}function Ph(n){const e=Wn(_e,"rooms"),t=Ws(e,Gs("status","==","waiting"),Ks("created","desc"));return Eh(t,o=>{const r=o.docs.map(i=>({roomId:i.id,roomName:i.data().name,roomPlayers:i.data().players}));n(r)})}function kh(n,e,t,o,r,i){var c,h;const a=((h=(c=W==null?void 0:W[n])==null?void 0:c[e])==null?void 0:h[t])||null;return a===null?[!1,null]:(a==null?void 0:a.enabler)||!1?o?[!1,null]:[!0,"enabler"]:!r&&i?[!0,"enabled"]:[!1,null]}function un(n,e,t,o,r=!1){const i=n.currentDay,a=localStorage.getItem("connectedUserId"),c=dc[i][t][e],h=n.roomPlayers[a].enablerComplete,d=n.roomPlayers[a].enabledComplete,f=n.roomPlayers[a].enabledValue!=null;o.innerHTML="";const[g,y]=kh(i,t,e,h,d,f);console.log(`Player has entered an actionable room: ${g}`),console.log(`Puzzle to be generated: ${y}`);for(const[A,P]of Object.entries(c))if(A!="CORRECT_ACTION"){const V=document.createElement("button");V.id=A.replace(/\s+/g,"").toLowerCase()+"Btn",V.className="std-button role-button",V.style.width="250px",V.textContent=A;let k=P;(!g||r)&&(k=dc["NO-ACTION"]),V.onclick=async()=>{await typewriter.showSequence(k),A===c.CORRECT_ACTION&&!r?(console.log("Correct action clicked"),y!=null&&(o.innerHTML="",Vh(o,i,e,t,y,n))):console.log("Incorrect action clicked")},o.appendChild(V)}}function Tt(n,e){e.innerHTML="",n&&n.roomPlayers&&Object.entries(n.roomPlayers).sort((o,r)=>{const i=o[1].name.toLowerCase(),a=r[1].name.toLowerCase();return i.localeCompare(a)}).forEach(([o,r])=>{const i=document.createElement("li"),a={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"};console.log(`Player ${r.name} has role:`,r.role);const c=a[r.role]||"Unassigned";i.innerHTML=`${r.name.replace("You","<br>")} - ${c}`,o===localStorage.getItem("connectedUserId")&&(i.classList.add("current-player"),i.style.fontWeight="bold",i.style.color="#4CAF50"),e.appendChild(i)})}async function Vh(n,e,t,o,r,i){var J,Se,ne;const a=(ne=(Se=(J=vy[e])==null?void 0:J[o])==null?void 0:Se[t])==null?void 0:ne[r];if(console.log(`PuzzleData ${a}`),!a){console.error("Puzzle data not found for:",{currentDay:e,roomName:t,currentRole:o,puzzleType:r});return}n.innerHTML="";const c=document.createElement("div");c.className="puzzle-container";const h=document.createElement("h2");h.className="puzzle-title",h.textContent=a.title,c.appendChild(h);const d=document.createElement("p");d.className="puzzle-description",d.innerHTML=a.prompt,c.appendChild(d);const f=document.createElement("div");f.className="game-table-container";const g=document.createElement("table");g.className="game-table";const y=document.createElement("thead"),A=document.createElement("tr");a.tableHeaders.forEach(T=>{const p=document.createElement("th");p.textContent=T,A.appendChild(p)}),y.appendChild(A),g.appendChild(y);const P=document.createElement("tbody");a.tableRows.forEach((T,p)=>{const w=document.createElement("tr");w.className="puzzle-row",w.dataset.rowIndex=p,T.forEach(v=>{const b=document.createElement("td");b.textContent=v,w.appendChild(b)}),w.addEventListener("click",()=>{document.querySelectorAll(".puzzle-row.selected").forEach(v=>{v.classList.remove("selected")}),w.classList.add("selected")}),P.appendChild(w)}),g.appendChild(P),f.appendChild(g),c.appendChild(f);const V=document.createElement("p");V.className="puzzle-instruction",V.textContent=a.hint||"No hint available",V.style.display="none",c.appendChild(V);let k=!1;const U=document.createElement("div");U.className="puzzle-button-container";const B=document.createElement("button");B.className="std-button puzzle-hint",B.textContent="Show Hint",B.style.marginRight="10px";const $=document.createElement("button");$.className="std-button puzzle-submit",$.textContent="Submit Answer",B.addEventListener("click",()=>{V.style.display="block",B.style.display="none",k=!0}),$.addEventListener("click",async()=>{const T=document.querySelector(".puzzle-row.selected");if(!T){const Pe=document.createElement("div");Pe.className="puzzle-error",Pe.textContent="Please select a row first!",c.appendChild(Pe),setTimeout(()=>{Pe.parentNode&&Pe.remove()},3e3);return}const p=parseInt(T.dataset.rowIndex),w=p===a.correctAnswerIndex;$.disabled=!0,$.textContent="Processing...";const v=r==="enabler"?"enablerComplete":"enabledComplete",b=localStorage.getItem("connectedUserId"),I=i.roomPlayers[b].enablerComplete,_=i.roomPlayers[b].enabledComplete;localStorage.setItem("enablerComplete",r==="enabler"),localStorage.setItem("enabledComplete",r==="enabled");const Lr=(r==="enabler"?!0:I)&&(r==="enabled"?!0:_),Et=w?a.feedback.correct.slice(0,-1):a.feedback.incorrect.slice(0,-1),It=Lr?"You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up.":"You should investigate other rooms in case you can assist further.";await typewriter.showSequence([...Et,It],{onContinue:async()=>{const Pe=localStorage.getItem("connectedUserId"),At=localStorage.getItem("connectedRoomId");Ve(Pe,At,v,!0),n.innerHTML="",un(i,t,o,n,!0);const Mr={day:e,type:r,room:t,role:o,correct:w,selectedIndex:p,hintUsed:k,timestamp:new Date().toISOString()};if(Dh(Pe,At,Mr),r==="enabler"){console.log("In Enabler Puzzle");const Ne=Lt[e][o];console.log(`Role to enable: ${Ne}`);const se=i.roomPlayers;console.log(`Room Players: ${se}`);for(const[Br,nt]of Object.entries(se))console.log(`Role: ${nt.role}`),nt.role===Ne&&(console.log("Found player to update, updating"),await Ve(Br,At,"enabledValue",p))}else Hi(At)}})}),U.appendChild(B),U.appendChild($),c.appendChild(U),n.appendChild(c)}async function Dh(n,e,t){var i;const o=De(_e,"rooms",e),r=await Vr(o);if(r.exists()){const h=[...(((i=r.data().players)==null?void 0:i[n])||{}).puzzleAnswers||[],t];await Ye(o,{[`players.${n}.puzzleAnswers`]:h})}}async function tt(n){const e=localStorage.getItem("connectedUserId"),t=localStorage.getItem("connectedRoomId");document.getElementById("loadingContainer").style.display="flex",await Ve(e,t,"currentRoom",n),localStorage.setItem("currentRoomName",n),window.location.href=`${n.toLowerCase().replace(" ","-")}.html`}const Ey=Object.freeze(Object.defineProperty({__proto__:null,ackReshuffle:Rh,addUserToRoom:zi,appendDayScore:Qs,appendPuzzleAnswer:Dh,createRoom:Ah,createUser:Yi,deleteRoom:Sh,generateActions:un,generatePuzzle:Vh,incrementEnabledCompletions:Hi,isRoomActionableRightNow:kh,listenToAllRooms:Ph,listenToRoom:et,loadRooms:Ke,navigateToRoom:tt,progressDay:Gn,removeUserFromRoom:Ch,updatePlayer:Ve,updateRoleList:Tt},Symbol.toStringTag,{value:"Module"}));document.getElementById("joinRoomBtn").addEventListener("click",async()=>{document.getElementById("loadingContainer").style.display="flex";try{const n=await Ke(void 0,void 0,0);localStorage.setItem("availableRooms",JSON.stringify(n)),window.location.href="room-select.html"}catch(n){console.error("Error loading rooms:",n),localStorage.removeItem("availableRooms")}});document.getElementById("createRoomForm").addEventListener("submit",async function(n){n.preventDefault();const e=document.getElementById("roomName").value.trim(),t=document.getElementById("username").value.trim(),o=document.getElementById("errorMessage");if(!e||!t){o.textContent="Please enter a room name and a nickname!",o.style.display="block";return}try{document.getElementById("loadingContainer").style.display="flex";const r=await Ah(e),i=await Yi(t,e,r);await zi(i,t,r,1),localStorage.setItem("connectedRoomId",r),localStorage.setItem("connectedUserId",i),localStorage.setItem("connectedRoomName",e),localStorage.setItem("connectedUsername",t),localStorage.setItem("isHost","1"),localStorage.setItem("readyStatus","0");try{const a=await Ke(void 0,r,void 0);localStorage.setItem("localRoomData",JSON.stringify(a)),window.location.href="room-lobby.html"}catch(a){o.textContent="Error loading room: "+a.message,o.style.display="block"}}catch(r){o.textContent="Error: "+r.message,o.style.display="block"}});class Iy{constructor(){this.isActive=!1,this.currentText="",this.fullText="",this.currentIndex=0,this.speed=30,this.lineDelay=3e3,this.interval=null,this.onLineComplete=null,this.onLineSkip=null,this.isLastLineInSequence=!1,this.delayResolve=null,this.autoProgress=localStorage.getItem("dialogueAutoProgress")==="true",this.autoProgressTimeout=null,this.dialogueLog=[],this.logVisible=localStorage.getItem("dialogueLogVisible")==="true",this.currentSequence=[],this.currentSequenceIndex=0,this.currentSequenceOptions={},this.createDialogueElements()}createDialogueElements(){this.overlay=document.createElement("div"),this.overlay.className="dialogue-overlay",document.body.appendChild(this.overlay),this.container=document.createElement("div"),this.container.className="dialogue-container",this.container.innerHTML=`
            <div style="display: flex; gap: 10px; margin-bottom: 10px; position: relative; justify-content: space-between; align-items: center;">
                <button id="auto-toggle" class="dialogue-auto-toggle">Auto: OFF</button>
                <div style="display: flex; gap: 10px;">
                    <button id="log-toggle" class="dialogue-log-toggle">Log</button>
                    <button id="skip" class="dialogue-skip" style="position: static;">Skip</button>
                    <button id="skip-all" class="dialogue-skip" style="position: static;">Skip All</button>
                </div>
            </div>
            <p class="dialogue-text"></p>
            <button class="dialogue-continue">Continue</button>
        `,document.body.appendChild(this.container),this.logContainer=document.createElement("div"),this.logContainer.className="dialogue-log-container",this.logContainer.innerHTML=`
            <div class="dialogue-log-header">
                <h3>Dialogue Log</h3>
                <button id="log-close" class="dialogue-log-close">×</button>
            </div>
            <div class="dialogue-log-content"></div>
        `,document.body.appendChild(this.logContainer),this.persistentLogButton=document.createElement("button"),this.persistentLogButton.className="persistent-log-button",this.persistentLogButton.innerHTML="📖",this.persistentLogButton.title="Dialogue Log",document.body.appendChild(this.persistentLogButton),this.persistentLogButton.addEventListener("click",e=>{e.stopPropagation(),this.toggleDialogueLog()}),this.textElement=this.container.querySelector(".dialogue-text"),this.autoToggleButton=this.container.querySelector("#auto-toggle"),this.logToggleButton=this.container.querySelector("#log-toggle"),this.skipButton=this.container.querySelector("#skip"),this.skipAllButton=this.container.querySelector("#skip-all"),this.continueButton=this.container.querySelector(".dialogue-continue"),this.logContent=this.logContainer.querySelector(".dialogue-log-content"),this.logCloseButton=this.logContainer.querySelector("#log-close"),this.autoToggleButton.textContent=this.autoProgress?"Auto: ON":"Auto: OFF",this.autoToggleButton.classList.toggle("active",this.autoProgress),this.logVisible&&(this.logContainer.style.display="block"),this.autoToggleButton.addEventListener("click",e=>{e.stopPropagation(),this.toggleAutoProgress()}),this.logToggleButton.addEventListener("click",e=>{e.stopPropagation(),this.toggleDialogueLog()}),this.logCloseButton.addEventListener("click",e=>{e.stopPropagation(),this.hideDialogueLog()}),this.continueButton.addEventListener("click",e=>{e.stopPropagation(),this.isLastLineInSequence?this.onContinue?(this.onContinue(),this.hide()):this.hide():this.nextLine()}),this.skipAllButton.addEventListener("click",e=>{e.stopPropagation(),this.skipAll()}),this.skipButton.addEventListener("click",e=>{e.stopPropagation(),this.isLineComplete?this.nextLine():this.lineSkip()}),this.overlay.addEventListener("click",()=>{this.isLineComplete?this.nextLine():this.lineSkip()}),this.container.addEventListener("click",()=>{this.isLineComplete?this.nextLine():this.lineSkip()})}async showSequence(e,t={}){this.sequenceController=new AbortController;const o=Array.isArray(e)?e:[e];this.currentSequence=o,this.currentSequenceIndex=0,this.currentSequenceOptions=t;for(let r=0;r<o.length;r++){const i=o[r],a=r===o.length-1;if(this.currentSequenceIndex=r,await new Promise((c,h)=>{if(this.sequenceController.signal.aborted){h(new Error("Cancelled"));return}this.show(i,{...t,isLastLineInSequence:a,onLineComplete:a&&t.onLineComplete||c,onLineSkip:a&&t.onLineSkip||c})}).catch(()=>Promise.reject(new Error("Cancelled"))),this.sequenceController.signal.aborted)break;if(!a&&this.autoProgress)try{await new Promise((c,h)=>{this.delayResolve=c;const d=setTimeout(c,this.lineDelay);this.sequenceController.signal.addEventListener("abort",()=>{clearTimeout(d),h(new Error("Cancelled"))})})}catch(c){if(c.message==="Cancelled")break}else if(!a&&!this.autoProgress)try{await new Promise((c,h)=>{this.delayResolve=c,this.sequenceController.signal.addEventListener("abort",()=>{h(new Error("Cancelled"))})})}catch(c){if(c.message==="Cancelled")break}}this.currentSequence=[],this.currentSequenceIndex=0,this.currentSequenceOptions={}}show(e,t={}){this.isActive&&this.hide(!0),this.isActive=!0,this.isLineComplete=!1,this.fullText=e,this.currentText="",this.currentIndex=0,this.speed=t.speed||this.speed,this.isLastLineInSequence=t.isLastLineInSequence||!1,this.onLineComplete=t.onLineComplete||null,this.onContinue=t.onContinue||null,this.onLineSkip=t.onLineSkip||null,this.addToDialogueLog(e,t.characterName),this.overlay.style.display="block",this.container.style.display="block",this.continueButton.style.display="none",this.persistentLogButton.style.display="none",this.type()}hide(e=!1){this.textElement.textContent="",this.currentText="",this.fullText="",this.textElement.style.setProperty("--cursor-visible","none"),this.interval&&(clearInterval(this.interval),this.interval=null),this.clearAutoProgressTimeout(),console.log("Dialogue cleared."),e||(this.isActive=!1,this.overlay.style.display="none",this.container.style.display="none",this.persistentLogButton.style.display="flex",console.log("Dialogue box hidden."))}nextLine(){this.isLastLineInSequence?this.onContinue?(this.onContinue(),this.hide()):this.hide():this.delayResolve&&(this.delayResolve(),this.delayResolve=null)}type(){const e=()=>{this.isActive&&(this.currentIndex<this.fullText.length?(this.currentText+=this.fullText[this.currentIndex],this.textElement.textContent=this.currentText,this.currentIndex++,this.typingTimeout=setTimeout(e,this.speed)):this.lineComplete())};e()}lineComplete(){this.isLineComplete=!0,this.textElement.style.setProperty("--cursor-visible","inline-block"),(this.isLastLineInSequence||!this.autoProgress)&&(console.log("Dialogue line completed - showing continue button."),this.continueButton.style.display="block"),this.onLineComplete&&(console.log("Dialogue line completed."),this.onLineComplete())}toggleAutoProgress(){this.autoProgress=!this.autoProgress,this.autoToggleButton.textContent=this.autoProgress?"Auto: ON":"Auto: OFF",this.autoToggleButton.classList.toggle("active",this.autoProgress),localStorage.setItem("dialogueAutoProgress",this.autoProgress.toString()),this.autoProgress&&this.isLineComplete&&!this.isLastLineInSequence&&this.delayResolve&&(this.delayResolve(),this.delayResolve=null)}clearAutoProgressTimeout(){this.autoProgressTimeout&&(clearTimeout(this.autoProgressTimeout),this.autoProgressTimeout=null)}addToDialogueLog(e,t=null){const o=new Date().toLocaleTimeString(),r={text:e,character:t,timestamp:o};this.dialogueLog.push(r),this.updateDialogueLogDisplay()}updateDialogueLogDisplay(){if(this.logContent.innerHTML="",this.dialogueLog.length===0){const e=document.createElement("div");e.className="dialogue-log-empty",e.innerHTML=`
                <div class="dialogue-log-text">No dialogue.</div>
            `,this.logContent.appendChild(e)}else this.dialogueLog.forEach((e,t)=>{const o=document.createElement("div");o.className="dialogue-log-entry";let r=e.text;e.character&&(r=`${e.character}: ${e.text}`),o.innerHTML=`
                    <div class="dialogue-log-text">${r}</div>
                    <div class="dialogue-log-timestamp">${e.timestamp}</div>
                `,this.logContent.appendChild(o)});this.logContent.scrollTop=this.logContent.scrollHeight}toggleDialogueLog(){this.logVisible?this.hideDialogueLog():this.showDialogueLog()}showDialogueLog(){this.logVisible=!0,this.logContainer.style.display="block",this.updateDialogueLogDisplay(),localStorage.setItem("dialogueLogVisible","true")}hideDialogueLog(){this.logVisible=!1,this.logContainer.style.display="none",localStorage.setItem("dialogueLogVisible","false")}lineSkip(){this.typingTimeout&&(clearTimeout(this.typingTimeout),this.typingTimeout=null),this.currentText=this.fullText,this.textElement.textContent=this.currentText,this.lineComplete(),this.onLineSkip&&this.onLineSkip(),console.log("Skip called.")}skipAll(){this.currentSequence&&this.currentSequence.length>0&&this.currentSequence.slice(this.currentSequenceIndex+1).forEach(t=>{this.addToDialogueLog(t,this.currentSequenceOptions.characterName)}),this.interval&&clearInterval(this.interval),this.clearAutoProgressTimeout(),this.sequenceController&&this.sequenceController.abort(),this.onLineComplete&&this.onLineComplete(),this.onLineSkip&&this.onLineSkip(),this.onContinue&&this.onContinue(),this.currentSequence=[],this.currentSequenceIndex=0,this.currentSequenceOptions={},this.hide(),console.log("All dialogue skipped and remaining lines added to log.")}showWithCharacter(e,t,o={}){const r=`${e}: ${t}`;this.show(r,{...o,characterName:e})}}window.typewriter=new Iy;const Ay="modulepreload",Cy=function(n){return"/athena/"+n},mc={},Mt=function(e,t,o){let r=Promise.resolve();if(t&&t.length>0){let a=function(d){return Promise.all(d.map(f=>Promise.resolve(f).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),h=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));r=a(t.map(d=>{if(d=Cy(d),d in mc)return;mc[d]=!0;const f=d.endsWith(".css"),g=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const y=document.createElement("link");if(y.rel=f?"stylesheet":Ay,f||(y.as="script"),y.crossOrigin="",y.href=d,h&&y.setAttribute("nonce",h),document.head.appendChild(y),f)return new Promise((A,P)=>{y.addEventListener("load",A),y.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return r.then(a=>{for(const c of a||[])c.status==="rejected"&&i(c.reason);return e().catch(i)})},fc={lobby:{title:"Team Assembly",description:"Wait for your team to join and get ready."},"role-select":{title:"Role Assignment",description:"Choose your role for this mission."},"finalise-roles":{title:"Team Finalisation",description:"Review your team composition and confirm all roles."}};function ze(n,e=null,t=null){if(fc[n]){const o=fc[n];An("Objective",o.description);return}if(e&&t){const o=e.currentDay,r=localStorage.getItem("connectedUserId"),i=e.roomPlayers[r].enabledValue!=null,a=localStorage.getItem("enablerComplete")==="true",c=localStorage.getItem("enabledComplete")==="true";if(c&&a){An("Objective","Return to situation room and wait.");return}Mt(async()=>{const{isRoomActionableRightNow:h}=await Promise.resolve().then(()=>Ey);return{isRoomActionableRightNow:h}},void 0).then(({isRoomActionableRightNow:h})=>{const[d]=h(o,t,n,a,c,i);d?An("Objective","Choose an action to complete this task."):An("Objective","Explore other rooms.")})}else An("Objective","Explore other rooms.")}function An(n,e){let t=document.getElementById("objectiveDisplay");t||(t=document.createElement("div"),t.id="objectiveDisplay",t.className="objective-display",document.body.appendChild(t)),t.innerHTML=`
        <h3>Objective</h3>
        <p>${e}</p>
    `;const o=document.getElementById("objectiveDisplay");o&&o.classList.add("game-panel")}function Wi(n,e){let t=document.getElementById("objectiveDisplay");t||(t=document.createElement("div"),t.id="objectiveDisplay",t.className="objective-display",document.body.appendChild(t)),t.innerHTML=`
        <h3>Objective</h3>
        <p>${e}</p>
    `;const o=document.getElementById("objectiveDisplay");o&&o.classList.add("game-panel")}const Gi=localStorage.getItem("connectedRoomId"),Dr=localStorage.getItem("connectedUserId"),Ry=localStorage.getItem("connectedRoomName"),Sy=localStorage.getItem("connectedUsername");JSON.parse(localStorage.getItem("roomData")||"{}");document.addEventListener("DOMContentLoaded",()=>{console.log("Page loaded - forcing team selection to be hidden"),document.getElementById("waitingSection").style.display="none",document.getElementById("roleButtons").style.display="block"});let gc=!0;document.getElementById("roomName").textContent=Ry;function Py(n){if(n){document.getElementById("roomName").textContent=`Room: ${n.roomName}`;const e=n.roomPlayers?Object.values(n.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${e.length}/4`,document.getElementById("yourName").textContent=`You: ${Sy}`,e.length>0&&e.every(o=>o.role&&o.role!==null)&&(console.log("All roles selected"),setTimeout(()=>{window.location.href="finalise-roles.html"},2e3))}}function ky(){document.getElementById("roleButtons").style.display="none",document.getElementById("waitingSection").style.display="block"}function Vy(){console.log("Hiding waiting state - hiding team selection, showing role buttons"),document.getElementById("roleButtons").style.display="block",document.getElementById("waitingSection").style.display="none",console.log("Role buttons display:",document.getElementById("roleButtons").style.display),console.log("Waiting section display:",document.getElementById("waitingSection").style.display)}function pc(n){if(n&&n.roomPlayers){const e=n.roomPlayers[Dr];console.log("Current player data:",e),console.log("Current player role:",e==null?void 0:e.role);const t=!!(e&&e.role&&e.role!==null);return console.log("Has role:",t),t}return!1}function Dy(n){const e=document.getElementById("rolePlayers");if(!e||!n||!n.roomPlayers)return;e.innerHTML="";const t=Object.entries(n.roomPlayers).sort((r,i)=>{const a=r[1].name.toLowerCase(),c=i[1].name.toLowerCase();return a.localeCompare(c)}),o={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"};t.forEach(([r,i])=>{const a=document.createElement("li");r===Dr&&a.classList.add("current-player"),a.textContent=i.name;const c=document.createElement("div");c.className="status-container";const h=document.createElement("span");h.className="status-text";const d=i.role&&i.role!==null,f=d?o[i.role]||i.role:"Choosing...";h.textContent=f,h.style.color=d?"#4CAF50":"#ff6b6b";const g=document.createElement("div");g.className="status-light",g.style.backgroundColor=d?"#4CAF50":"#ff6b6b",g.style.boxShadow=d?"0 0 8px #4CAF50":"0 0 8px #ff6b6b",c.appendChild(h),c.appendChild(g),a.appendChild(c),e.appendChild(a)})}const yc=et(Gi,n=>{n?(Py(n),ze("role-select"),gc&&(typewriter.showSequence([">> SYSTEM BOOT COMPLETE",">> CONNECTION ESTABLISHED WITH HELIOS FACILITY BRIEFING TERMINAL","The Briefing Room glows softly under the flickering light of the holographic table.","Commander Reyes’s face appears, tense, urgent.",`"Athena’s locked us out. She's taken control of Helios."`,'"We need specialists on-site immediately."',"Four specializations flash onto the display: Cybersecurity Analyst, Software Engineer, Network Engineer, Data Scientist.","Your teammates glance at each other, then at you.",'"Each path is critical. Choose yours carefully."',"Waiting for all operatives to select roles..."]),gc=!1),console.log("Checking role selection - hasCurrentUserRole result:",pc(n)),pc(n)?(console.log("User has role - showing team selection"),Dy(n),ky()):(console.log("User has no role - hiding team selection"),Vy())):(console.error("Room not found"),window.location.href="../index.html")});document.addEventListener("DOMContentLoaded",()=>{});document.querySelectorAll(".role-button").forEach(n=>{n.addEventListener("click",async()=>{({dsBtn:"Data Scientist",seBtn:"Software Engineer",neBtn:"Network Engineer",caBtn:"Cybersecurity Analyst"})[n.id];try{Ve(Dr,Gi,"role",n.id.slice(0,2)),document.getElementById("roleButtons").style.display="none",document.getElementById("waitingSection").style.display="block"}catch(t){console.error("Error in updatePlayer:",t)}})});document.getElementById("changeMindBtn").addEventListener("click",async()=>{Ve(Dr,Gi,"role",null),document.getElementById("roleButtons").style.display="block",document.getElementById("waitingSection").style.display="none"});window.addEventListener("beforeunload",()=>{yc&&yc()});class Ny{constructor(){this.toastContainer=null,this.init()}init(){document.getElementById("toast-container")?this.toastContainer=document.getElementById("toast-container"):(this.toastContainer=document.createElement("div"),this.toastContainer.id="toast-container",this.toastContainer.className="toast-container",document.body.appendChild(this.toastContainer))}show(e,t={}){const{type:o="info",duration:r=6e3,dismissible:i=!0}=t,a=document.createElement("div");a.className=`toast toast-${o}`;const c=document.createElement("div");c.className="toast-content";const h=document.createElement("div");h.className="toast-status-light";const d=document.createElement("span");if(d.className="toast-message",d.textContent=e,i){const f=document.createElement("button");f.className="toast-close",f.innerHTML="x",f.addEventListener("click",()=>this.dismiss(a)),c.appendChild(f)}return c.appendChild(h),c.appendChild(d),a.appendChild(c),this.toastContainer.appendChild(a),setTimeout(()=>{a.classList.add("toast-show")},10),r>0&&setTimeout(()=>{this.dismiss(a)},r),a}dismiss(e){e&&e.parentNode&&(e.classList.add("toast-hide"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))}dismissAll(){this.toastContainer.querySelectorAll(".toast").forEach(t=>this.dismiss(t))}success(e,t={}){return this.show(e,{...t,type:"success"})}error(e,t={}){return this.show(e,{...t,type:"error"})}warning(e,t={}){return this.show(e,{...t,type:"warning"})}info(e,t={}){return this.show(e,{...t,type:"info"})}}const wt=new Ny,Kn=localStorage.getItem("connectedRoomId"),Nh=localStorage.getItem("connectedUserId");localStorage.getItem("connectedRoomName");const xy=localStorage.getItem("connectedUsername"),xh=localStorage.getItem("isHost");let Xs=!1;const Oe={ds:{count:0,users:[]},se:{count:0,users:[]},ne:{count:0,users:[]},ca:{count:0,users:[]}};let wc=!0,Oh=!1,Ki=null;function Oy(n){if(n){document.getElementById("roomName").textContent=`Room: ${n.roomName}`;const e=n.roomPlayers?Object.values(n.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${e.length}/4`,document.getElementById("yourName").textContent=`You: ${xy}`}}function Ly(n){Xs=!1,Object.keys(Oe).forEach(t=>{Oe[t].count=0,Oe[t].users=[]});const e=document.getElementById("players");e.innerHTML="",n&&n.roomPlayers&&(Object.entries(n.roomPlayers).sort((o,r)=>{const i=o[1].name.toLowerCase(),a=r[1].name.toLowerCase();return i.localeCompare(a)}).forEach(([o,r])=>{const i=document.createElement("li"),c={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"}[r.role]||"Unassigned";i.textContent=`${r.name} - ${c}`,o===Nh&&(i.classList.add("current-player"),i.style.fontWeight="bold",i.style.color="#4CAF50",localStorage.setItem("connectedUserRole",r.role)),e.appendChild(i)}),Object.entries(n.roomPlayers).forEach(([o,r])=>{const i=r.role;i&&i!=="None"&&(Oe[i].count=(Oe[i].count||0)+1,Oe[i].users.push(o),Oe[i].count>1&&(Xs=!0))}))}function My(n){Oh=!0,n.roomPlayers[Nh].isHost===1&&Object.entries(Oe).forEach(([e,t])=>{if(console.log(Oe),t.count>1){const o=Object.keys(Oe).filter(i=>Oe[i].count===0);t.users.slice(1).forEach((i,a)=>{if(o.length>0){const c=Math.floor(Math.random()*o.length),h=o.splice(c,1)[0];Ve(i,Kn,"role",h)}})}}),wt.success("Roles reshuffled",{duration:4e3}),setTimeout(()=>{document.getElementById("loadingContainer").style.display="none",Fy()},1e3)}function By(n){Xs?typewriter.showSequence([">> ROLE CONFLICT DETECTED","Commander Reyes’s voice interrupts, firm but reassuring.",'"Hold on, team—we have duplicated specializations."',`"Athena adapts quickly. We can't afford redundancy."`,`"I'm reassigning roles to optimize your strengths."`],{onContinue:()=>{typewriter.hide(),document.getElementById("loadingContainer").style.display="flex",Rh(Kn)}}):typewriter.showSequence([">> ROLE ASSIGNMENTS CONFIRMED","Commander Reyes’s voice comes through clearly, approval evident.",`"Good choices, team. You're each exactly where we need you."`,'"Stay sharp, move quickly, and keep communication open."',`"Let's regain control of Helios."`,"The Situation Room doors unlock, pathways awaiting your next move."],{onContinue:async()=>{if(document.getElementById("loadingContainer").style.display="flex",localStorage.setItem("introDialogueSeen","0"),xh==="1")await Gn(Kn),window.location.href="rooms/situation-room.html";else{for(;!(Ki.currentDay>0);)await new Promise(e=>setTimeout(e,500));window.location.href="rooms/situation-room.html"}}})}function Fy(n){const e={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"},t=localStorage.getItem("connectedUserRole"),o=e[t]||"Specialist";typewriter.showSequence(["You glance at the terminal as the system recalibrates your assignment.",`"New specializations set. You will be working as the ${o}. Confirm your tasks and move swiftly to the situation room."`],{onContinue:async()=>{if(document.getElementById("loadingContainer").style.display="flex",localStorage.setItem("introDialogueSeen","0"),xh==="1")await Gn(Kn),window.location.href="rooms/situation-room.html";else{for(;!(Ki.currentDay>0);)await new Promise(r=>setTimeout(r,500));window.location.href="rooms/situation-room.html"}}})}const _c=et(Kn,n=>{n?(Ki=n,Oy(n),Ly(n),ze("finalise-roles"),wc?(By(),wc=!1):n.ackReshuffle>=Object.keys(n.roomPlayers).length&&!Oh&&My(n)):(console.error("Room not found"),window.location.href="../index.html")});window.addEventListener("beforeunload",()=>{_c&&_c()});const Qn=localStorage.getItem("connectedRoomId"),Xn=localStorage.getItem("connectedUserId"),or=localStorage.getItem("connectedRoomName"),Js=localStorage.getItem("connectedUsername"),Jn=JSON.parse(localStorage.getItem("localRoomData")||"{}");if(!Qn||!Xn||!or||!Js||!Jn)throw console.error("Missing required data:",{roomId:Qn,userId:Xn,roomName:or,username:Js,localRoomData:Jn}),window.location.href="index.html",new Error("Missing required data");function Lh(n){if(n){document.getElementById("roomName").textContent=`Room: ${n.roomName}`;const e=n.roomPlayers?Object.values(n.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${e.length}/4`,document.getElementById("yourName").textContent=`You: ${Js}`}}document.getElementById("lobbyHeader").textContent=or;const Uy=Jn.roomPlayers?Object.values(Jn.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${Uy.length}/4`;function $y(n){if(n){Lh(n),ze("lobby");const e=n.roomPlayers?Object.values(n.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${e.length}/4`;const t=document.getElementById("players");if(t.innerHTML="",n.roomPlayers){Object.entries(n.roomPlayers).sort((i,a)=>{const c=i[1].name.toLowerCase(),h=a[1].name.toLowerCase();return c.localeCompare(h)}).forEach(([i,a])=>{const c=document.createElement("li");i===Xn&&c.classList.add("current-player"),c.textContent=a.name;const h=document.createElement("div");h.className="status-container";const d=document.createElement("span");d.className="status-text",d.textContent=a.readyStatus===1?"Ready":"Not Ready",d.style.color=a.readyStatus===1?"#4CAF50":"#ff6b6b";const f=document.createElement("div");f.className="status-light",f.style.backgroundColor=a.readyStatus===1?"#4CAF50":"#ff6b6b",f.style.boxShadow=a.readyStatus===1?"0 0 8px #4CAF50":"0 0 8px #ff6b6b",h.appendChild(d),h.appendChild(f),c.appendChild(h),t.appendChild(c)});const r=e.length>=4&&e.every(i=>i.readyStatus===1);if(r&&!window.countdownStarted){window.countdownStarted=!0;let a=5,c=document.getElementById("countdown"),h=document.getElementById("countdownOverlay");h||(h=document.createElement("div"),h.id="countdownOverlay",h.className="countdown-overlay",h.innerHTML=`
                                <div class="countdown-box">
                                    <div class="countdown-title">Mission Starting</div>
                                    <div id="countdown" class="countdown-number" style="opacity:0;">0</div>
                                    <button id="cancelLaunchBtn" class="std-button" style="margin-top:32px;min-width:180px;">Cancel Launch</button>
                                </div>
                            `,document.body.appendChild(h),c=document.getElementById("countdown")),h.style.display="flex",c.style.display="block",c.textContent=`${a}`,c.style.opacity="1";const d=document.getElementById("cancelLaunchBtn");d&&(d.onclick=async()=>{window.countdownIntervalId&&(clearInterval(window.countdownIntervalId),window.countdownIntervalId=null),h.remove(),window.countdownStarted=!1;try{await Ve(Xn,Qn,"readyStatus",0),Ge.textContent="Ready Up",Ge.classList.remove("ready"),localStorage.setItem("readyStatus",0),wt.warning("Launch cancelled. Waiting for all players to be ready.",{duration:5e3})}catch(g){console.error("Failed to update ready status after cancel:",g),wt.error("Failed to cancel launch. Please try again.")}});const f=setInterval(()=>{a--,a<=0?(clearInterval(f),h&&h.remove(),localStorage.setItem("enablerComplete","false"),localStorage.setItem("enabledComplete","false"),console.log("Game has commenced."),window.location.href="story/role-select.html"):c.textContent=`${a}`},1e3);window.countdownIntervalId=f}else if(window.countdownStarted&&!r){window.countdownStarted=!1,window.countdownIntervalId&&(clearInterval(window.countdownIntervalId),window.countdownIntervalId=null);const i=document.getElementById("countdownOverlay");i&&i.remove()}}}}const rr=et(Qn,n=>{n?(console.log(`Room ${n.roomId} updated:`),$y(n),localStorage.setItem("localRoomData",JSON.stringify(n))):(console.error("Room not found"),window.location.href="index.html")});Lh({roomName:or,roomPlayers:Jn.roomPlayers});window.addEventListener("beforeunload",()=>{rr&&rr()});const Ge=document.getElementById("readyUp");Ge.addEventListener("click",async()=>{try{const n=Ge.textContent==="Ready Up"?1:0;await Ve(Xn,Qn,"readyStatus",n),Ge.textContent==="Ready Up"?(Ge.textContent="Not Ready",Ge.classList.add("ready")):(Ge.textContent="Ready Up",Ge.classList.remove("ready")),localStorage.setItem("readyStatus",n)}catch(n){console.error("Error updating ready status:",n),alert("Failed to update ready status. Please try again.")}});document.getElementById("leaveRoom").addEventListener("click",async()=>{try{const n=localStorage.getItem("connectedUserId"),e=localStorage.getItem("connectedRoomId"),t=localStorage.getItem("connectedUsername"),o=JSON.parse(localStorage.getItem("localRoomData"));if((o.roomPlayers?Object.values(o.roomPlayers):[]).length===1)if(confirm("You are the last player in this room. Would you like to delete the room?"))await Sh(e),console.log(`Room ${e} deleted successfully.`);else return;await Ch(n,t,"None",e),localStorage.removeItem("connectedRoomId"),localStorage.removeItem("connectedUserId"),localStorage.removeItem("connectedRoomName"),localStorage.removeItem("connectedUsername"),localStorage.removeItem("readyStatus"),localStorage.removeItem("roomData"),rr&&rr(),document.getElementById("loadingContainer").style.display="flex";try{const i=await Ke(void 0,void 0,0);localStorage.setItem("availableRooms",JSON.stringify(i)),window.location.href="room-select.html"}catch(i){console.error("Error loading rooms:",i),localStorage.removeItem("availableRooms")}}catch(n){console.error("Error leaving room:",n),alert("Failed to leave room. Please try again.")}});const vc=document.getElementById("noRooms"),bc=document.getElementById("roomContent"),Tc=document.getElementById("roomsGrid");function qy(n){Tc.innerHTML="",n.length===0?(vc.style.display="block",bc.style.display="none"):(vc.style.display="none",bc.style.display="block",n.forEach(e=>{const o=(e.roomPlayers?Object.values(e.roomPlayers):[]).length,r=o<4,i=document.createElement("div");i.className="room-card",i.innerHTML=`
                        <div class="room-name">
                            <h3>${e.roomName}</h3>
                        </div>
                        <div class="room-info">
                            Players: ${o}/4
                        </div>
                        ${r?`<button class="std-button join-button" data-room-id="${e.roomId}" data-room-name="${e.roomName}">Join Room</button>`:'<button class="std-button" disabled>Room Full</button>'}
                    `,Tc.appendChild(i)}),document.querySelectorAll(".join-button").forEach(e=>{e.addEventListener("click",async()=>{const t=document.getElementById("username").value.trim();if(!t){alert("Please enter a room nickname before joining a room!");return}const o=e.dataset.roomId,r=e.dataset.roomName;try{document.getElementById("loadingContainer").style.display="flex";const i=await Yi(t,r,o);await zi(i,t,o,0),localStorage.setItem("connectedRoomId",o),localStorage.setItem("connectedUserId",i),localStorage.setItem("connectedRoomName",r),localStorage.setItem("connectedUsername",t),localStorage.setItem("isHost","0"),localStorage.setItem("readyStatus","0");try{const a=await Ke(void 0,o,void 0);localStorage.setItem("localRoomData",JSON.stringify(a)),window.location.href="room-lobby.html"}catch(a){console.error("Error loading room:",a),window.location.href="index.html"}}catch(i){console.error("Join failed:",i),alert("Couldn't join the room. Please try again.")}})}))}const Ec=Ph(n=>{qy(n)});window.addEventListener("beforeunload",()=>{Ec&&Ec()});const Ce=localStorage.getItem("connectedRoomId"),Uo=localStorage.getItem("connectedUserId");localStorage.getItem("connectedRoomName");localStorage.getItem("connectedUsername");const jy=localStorage.getItem("connectedUserRole"),Ic=localStorage.getItem("isHost");let Zs=null,$o=!1,Cn=null,Mh=0;document.getElementById("serverBtn").addEventListener("click",()=>tt("Server Room"));document.getElementById("researchBtn").addEventListener("click",()=>tt("Research Lab"));document.getElementById("commandBtn").addEventListener("click",()=>tt("Command Centre"));document.getElementById("developerBtn").addEventListener("click",()=>tt("Developer Hub"));function Bh(n){if(n){document.getElementById("roomName").textContent=`Room: ${n.roomName}`,document.getElementById("currentDay").textContent=`Day: ${n.currentDay}`;const e=n.roomPlayers?Object.values(n.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${e.length}/4`,document.getElementById("yourName").textContent="";const t=n.roomPlayers[Uo].enabledValue;Mh=n.currentDay,console.log("Checking enabledValue change:",{current:t,previous:Cn,isNull:t!==null,isDifferent:t!=Cn,toastShown:localStorage.getItem("enabledValueToastShown")}),t!==null&&t!=Cn&&(console.log("EnabledValue changed! Triggering notification..."),localStorage.getItem("enabledValueToastShown")?console.log("Toast already shown for this enabledValue"):(console.log("Toast not shown yet, showing now..."),Yy().catch(o=>{console.warn("Error showing enabled value toast:",o)}),localStorage.setItem("enabledValueToastShown","true"))),t===null&&Cn!==null&&localStorage.removeItem("enabledValueToastShown"),Cn=t}}async function Yy(){console.log("showEnabledValueToast called (situation room)");const n={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"},e=zy(jy,Mh),t=n[e];wt.success(`The ${t} has sent you some information to be used in another room.`);try{console.log("Importing audio module... (situation room)");const{playNotification:o}=await Mt(async()=>{const{playNotification:r}=await Promise.resolve().then(()=>hn);return{playNotification:r}},void 0);console.log("Audio module imported, playing notification... (situation room)"),o()}catch(o){console.warn("Audio not available:",o)}}function zy(n,e){const t=Lt[e];for(const[o,r]of Object.entries(t))if(r===n)return o;return null}function Fh(n){const e=n.currentDay;if(localStorage.getItem("introDialogueSeen")!=="1")switch(e){case 1:typewriter.showSequence([">> DAY 1: SITUATION ROOM ACCESS GRANTED","The Situation Room hums quietly, its walls lined with monitors displaying streams of erratic data.","Commander Reyes's voice returns, steadier now.",`"Team, Athena's grip on Helios tightens by the minute."`,'"We have four critical areas to investigate: Cybersecurity Hub, Developer Lab, Network Core, and Data Analytics Center."','"Each room holds key information or tools to regain control."',`"Coordinate closely and share your findings. We're counting on you."`,"The doors unlock, revealing passageways illuminated in cool blue.","The mission begins now."]);break;case 2:typewriter.showSequence([">> DAY 2: INITIATE COUNTERMEASURES","The Situation Room buzzes with activity; screens flash warnings as Athena’s incursions grow bolder.","Commander Reyes appears, determination etched into her face.",'"Yesterday you assessed Athena’s damage. Today, we fight back."','"We must disrupt her footholds, isolate compromised systems, and regain critical control."','"Coordinate your skills, communicate clearly, and move swiftly."','"Let’s show Athena what humanity’s capable of."',"The rooms unlock, systems primed for your next move."]);break;case 3:typewriter.showSequence([">> DAY 3: FINAL STRIKE PREPARATION","Red alerts pulse rhythmically across every monitor in the Situation Room.","Commander Reyes speaks urgently, voice heavy with gravity.",`"Athena's defenses are weakened but she's evolving rapidly."`,'"This is our window. We have one chance to land a decisive blow."',`"Converge your expertise, exploit every vulnerability you've uncovered."`,'"The fate of Helios and perhaps much more is in your hands."','"Finish this fight."',"Final access pathways activate, awaiting your command."]);break;default:typewriter.showSequence(["You're not supposed to see this."])}localStorage.setItem("introDialogueSeen","1")}async function Hy(n){const e={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"};let t=[],o=[],r=[],i=[],a=[],c=0;const h=Zs.currentDay;for(const[g,y]of Object.entries(n)){const A=y.filter(P=>P===!0).length;c+=A}console.log(`Day ${h} Score: ${c}`);for(const[g,y]of Object.entries(n)){const A=y.filter(V=>V===!0).length,P=y.length;if(y[0]===!1){const V=e[Lt[h][g]];a.push({enabler:e[g],enabled:V})}A===P?o.push(e[g]):A>0?r.push({role:e[g],correct:A,total:P}):i.push(e[g])}document.getElementById("loadingContainer").style.display="flex",document.getElementById("loadingMessage").textContent="Incoming transmission...";try{const{playTransmission:g}=await Mt(async()=>{const{playTransmission:y}=await Promise.resolve().then(()=>hn);return{playTransmission:y}},void 0);g()}catch(g){console.warn("Audio not available:",g)}await new Promise(g=>setTimeout(g,3e3)),document.getElementById("loadingContainer").style.display="none";const d=3;o.length===4?h===1?t=["Outstanding work team! Every single one of you nailed your assessments.","This is exactly the kind of precision we need to take back control.","Keep this momentum going, we're going to need this level of excellence."]:h===2?t=["Outstanding work team! Every single one of you nailed your assessments.","We're really beginning to fight back against this AI.","Should only be a little bit more to go now, lets keep pushing."]:h===d&&(t=["Outstanding work team! Every single one of you nailed your assessments.","That's just what we needed to avoid disaster, and I think we've done it."]):o.length>=2&&i.length===0?h===1?t=["Solid work overall, team. Most of you handled your tasks admirably.",...o.map(g=>`${g}, excellent job on your assessments.`),"Let's build on this foundation and push forward."]:h===2?t=["Solid work overall, team. Most of you handled your tasks admirably.",...o.map(g=>`${g}, excellent job on your assessments.`),"We're definitely making it difficult for the AI.  Lets keep going."]:h===d&&(t=["Solid work overall, team. Most of you handled your tasks admirably.",...o.map(g=>`${g}, excellent job on your assessments.`),"It's tough, but I think we've just about avoided disaster."]):i.length>0?h===1?t=["Well... we have some mixed results here.",...o.map(g=>`${g}, you did your job properly.`),...r.map(({role:g,correct:y,total:A})=>`${g}, you got ${y} out of ${A} right. Not terrible, but room for improvement.`),...i.map(g=>`${g}... I'm not even sure what to say. You had one job. ONE JOB.`),"We need to do better if we're going to survive what's coming next."]:h===2?t=["Well... we have some mixed results here.",...o.map(g=>`${g}, you did your job properly.`),...r.map(({role:g,correct:y,total:A})=>`${g}, you got ${y} out of ${A} right. Not terrible, but room for improvement.`),...i.map(g=>`${g}... I'm not even sure what to say. You had one job. ONE JOB.`),"If we don't improve soon, the AI might overrun us.  We need to improve."]:h===d&&(t=["Well... we have some mixed results here.",...o.map(g=>`${g}, you did your job properly.`),...r.map(({role:g,correct:y,total:A})=>`${g}, you got ${y} out of ${A} right. Not terrible, but room for improvement.`),...i.map(g=>`${g}... I'm not even sure what to say. You had one job. ONE JOB.`),"I don't think this will be enough to fight back against the AI..."]):h===1?t=["Alright, let's review what happened here.",...r.map(({role:g,correct:y,total:A})=>`${g}, ${y}/${A} correct. ${y===1?"At least you got one right.":"Could be worse, I suppose."}`),"We need to tighten up our game. The stakes are only getting higher."]:h===2?t=["Alright, let's review what happened here.",...r.map(({role:g,correct:y,total:A})=>`${g}, ${y}/${A} correct. ${y===1?"At least you got one right.":"Could be worse, I suppose."}`),"We need to tighten up our game. The AI is getting relentless now..."]:h===3&&(t=["Alright, let's review what happened here.",...r.map(({role:g,correct:y,total:A})=>`${g}, ${y}/${A} correct. ${y===1?"At least you got one right.":"Could be worse, I suppose."}`),"I think we're going to just scrape by.  Just..."]),a.length>0&&(t.push("And let's talk about teamwork for a moment..."),t.push(...a.map(({enabler:g,enabled:y})=>`${g}, you were supposed to help the ${y} do their job. You failed them. Which means they were working on bad information!`)),t.push("In this facility, we succeed together or we fail together. Remember that.")),h!==d&&t.push("Tomorrow brings new challenges. Let's hope we're ready for them.");const f=Zs.currentDay;await typewriter.showSequence(t,{onContinue:async()=>{if(h!==d){let g=null;if(Ic==="1")await Qs(Ce,c),await Gn(Ce),await Hi(Ce,!0),g=await Ke(void 0,Ce,void 0);else for(document.getElementById("loadingContainer").style.display="flex",document.getElementById("loadingMessage").textContent="Waiting for host to progress to the next day...";await new Promise(y=>setTimeout(y,500)),g=await Ke(void 0,Ce,void 0),console.log(g),!(g.currentDay>f););localStorage.setItem("introDialogueSeen","0"),localStorage.setItem("enabledValueToastShown","false"),await Ve(Uo,Ce,"enablerComplete",!1),await Ve(Uo,Ce,"enabledComplete",!1),await Ve(Uo,Ce,"enabledValue",null),document.getElementById("loadingContainer").style.display="none",$o=!1,Bh(g),Tt(g,document.getElementById("players")),Fh(g),console.log("Day Reset")}else{let g=null;if(document.getElementById("loadingContainer").style.display="flex",document.getElementById("loadingMessage").textContent="Waiting for host to finish the game...",Ic==="1")await Qs(Ce,c),await Gn(Ce,!0),g=await Ke(void 0,Ce,void 0);else for(;await new Promise(U=>setTimeout(U,500)),g=await Ke(void 0,Ce,void 0),console.log(g),g.currentDay==f;);document.getElementById("loadingContainer").style.display="none";const y=g.dayScores,A=y.length;let P=0;for(const U of y)P+=U;const V=P/(A*4)*100;let k=[];V<50?k=["Unfortunately, your team was unable to stop the AI.","With less than half the possible points, the facility is lost.","Perhaps next time, you'll be able to work together more effectively.","Thanks for playing!"]:V<80?k=["You just barely managed to hold things together.","It wasn't a perfect run, but you did enough to scrape by.","The AI is contained... for now. But there's plenty of room for improvement.","Thanks for playing!"]:k=["Congratulations! Your team performed exceptionally well.","With over 80% of the possible points, you've outsmarted the AI and saved the facility. Outstanding teamwork and skill!","Thanks for playing!"],await typewriter.showSequence(k,{onContinue:()=>{window.location.href="../../index.html"}})}}})}const Ac=et(Ce,async n=>{if(!$o)if(n){if(console.log("Room updated."),Zs=n,Bh(n),Tt(n,document.getElementById("players")),ze("situation-room",n,localStorage.getItem("connectedUserRole")),Fh(n),n.enabledCompletions>=4&&!$o){const e={},o={1:[0,1],2:[1,2],3:[3,4],4:[5,6]}[n.currentDay.toString()];for(const[r,i]of Object.entries(n.roomPlayers)){if(i.currentRoom!=="Situation Room"){console.log(`All players have completed enabled tasks, but ${r} is not in the Situation Room`);return}const[a,c]=o,h=i.puzzleAnswers[a],d=i.puzzleAnswers[c];if(!h||!d){console.warn(`Missing puzzle answers for ${i.role}`);return}const f=h.type==="enabler",g=f?h.correct:d.correct,y=f?d.correct:h.correct;e[i.role]=[g,y]}$o=!0,await Hy(e)}}else console.error("Room not found"),window.location.href="../../index.html"});window.addEventListener("beforeunload",()=>{Ac&&Ac()});const Wy=localStorage.getItem("connectedRoomId"),ps=localStorage.getItem("connectedUserId");localStorage.getItem("connectedRoomName");localStorage.getItem("connectedUsername");const Zn=localStorage.getItem("connectedUserRole");let Qi=null,sr=null,Uh=null,nn=0,ys=null,Ln=!0;document.getElementById("back").addEventListener("click",()=>{tt("Situation Room")});function $h(n){if(n){document.getElementById("roomName").textContent=`Room: ${n.roomName}`,document.getElementById("currentDay").textContent=`Day: ${n.currentDay}`;const e=n.roomPlayers?Object.values(n.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${e.length}/4`,document.getElementById("yourName").textContent="",Qi=n.roomPlayers[ps].enablerComplete,sr=n.roomPlayers[ps].enabledComplete;const t=n.roomPlayers[ps].enabledValue;Uh=t!=null,nn=n.currentDay,t!==null&&t!=ys&&(localStorage.getItem("enabledValueToastShown")||(Gy().catch(o=>{console.warn("Error showing enabled value toast:",o)}),localStorage.setItem("enabledValueToastShown","true"))),t===null&&ys!==null&&localStorage.removeItem("enabledValueToastShown"),ys=t}}async function Gy(){const n={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"},e=Ky(Zn,nn),t=n[e];wt.success(`The ${t} has sent you some information to be used in another room.`);try{const{playNotification:o}=await Mt(async()=>{const{playNotification:r}=await Promise.resolve().then(()=>hn);return{playNotification:r}},void 0);o()}catch(o){console.warn("Audio not available:",o)}Qy()&&Jy()}function Ky(n,e){const t=Lt[e];for(const[o,r]of Object.entries(t))if(r===n)return o;return null}function Qy(){return Xy()==="command-centre"}function Xy(){var e;return((e={1:{ca:"research-lab",ne:"developer-hub",se:"server-room",ds:"command-centre"},2:{ca:"command-centre",ne:"server-room",se:"research-lab",ds:"command-centre"},3:{ca:"command-centre",ne:"server-room",se:"developer-hub",ds:"research-lab"}}[nn])==null?void 0:e[Zn])||null}function Jy(){var e,t;const n=(t=(e=W==null?void 0:W[nn])==null?void 0:e[Zn])==null?void 0:t["command-centre"];n&&n.enabled&&typewriter.showSequence(n.enabled)}function Zy(){var n,e;if(Ln){const t=((e=(n=W==null?void 0:W[nn])==null?void 0:n[Zn])==null?void 0:e["command-centre"])||null;if(console.log(`${nn}${Zn}`),t===null)typewriter.showSequence(W["WRONG-ROOM"]);else if(t.enabler)if(!Qi)typewriter.showSequence(t.enabler);else{const o=t["enabler-complete"].slice(0,-1),r=Cc();typewriter.showSequence([...o,r])}else if(t.enabled)if(Uh&&!sr)typewriter.showSequence(t.enabled);else if(sr){const o=t["enabled-complete"].slice(0,-1),r=Cc();typewriter.showSequence([...o,r])}else typewriter.showSequence(t["enabled-not-available"]);Ln=!1,console.log(Ln)}}function Cc(){return sr&&Qi?(Wi("Objective","Return to situation room and wait."),"You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."):"You should investigate some other rooms in case you can assist further."}function Rc(){const n=JSON.parse(localStorage.getItem("localRoomData")||"{}");n&&n.roomPlayers&&Object.values(n.roomPlayers).some(t=>t.role!==null)?($h(n),Tt(n,document.getElementById("players"))):document.getElementById("players").innerHTML=""}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Rc):Rc();const Sc=et(Wy,n=>{n?(console.log("Room updated."),$h(n),Tt(n,document.getElementById("players")),ze("command-centre",n,localStorage.getItem("connectedUserRole")),Ln&&(un(n,"command-centre",localStorage.getItem("connectedUserRole"),document.getElementById("availableActions")),Zy(),Ln=!1)):(console.error("Room not found"),window.location.href="../index.html")});window.addEventListener("beforeunload",()=>{Sc&&Sc()});const ew=localStorage.getItem("connectedRoomId"),ws=localStorage.getItem("connectedUserId");localStorage.getItem("connectedRoomName");localStorage.getItem("connectedUsername");const Nr=localStorage.getItem("connectedUserRole");let Xi=null,ir=null,qh=null,io=0,_s=null,ar=!0;document.getElementById("back").addEventListener("click",()=>{tt("Situation Room")});function tw(n){if(n){document.getElementById("roomName").textContent=`Room: ${n.roomName}`,document.getElementById("currentDay").textContent=`Day: ${n.currentDay}`;const e=n.roomPlayers?Object.values(n.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${e.length}/4`,document.getElementById("yourName").textContent="",Xi=n.roomPlayers[ws].enablerComplete,ir=n.roomPlayers[ws].enabledComplete;const t=n.roomPlayers[ws].enabledValue;qh=t!=null,io=n.currentDay,t!==null&&t!=_s&&(localStorage.getItem("enabledValueToastShown")||(nw().catch(o=>{console.warn("Error showing enabled value toast:",o)}),localStorage.setItem("enabledValueToastShown","true"))),t===null&&_s!==null&&localStorage.removeItem("enabledValueToastShown"),_s=t}}async function nw(){const n={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"},e=ow(Nr,io),t=n[e];wt.success(`The ${t} has sent you some information to be used in another room.`);try{const{playNotification:o}=await Mt(async()=>{const{playNotification:r}=await Promise.resolve().then(()=>hn);return{playNotification:r}},void 0);o()}catch(o){console.warn("Audio not available:",o)}rw()&&iw()}function ow(n,e){const t=Lt[e];for(const[o,r]of Object.entries(t))if(r===n)return o;return null}function rw(){return sw()==="developer-hub"}function sw(){var e;return((e={1:{ca:"research-lab",ne:"developer-hub",se:"server-room",ds:"command-centre"},2:{ca:"command-centre",ne:"server-room",se:"research-lab",ds:"command-centre"},3:{ca:"command-centre",ne:"server-room",se:"developer-hub",ds:"research-lab"}}[io])==null?void 0:e[Nr])||null}function iw(){var e,t;const n=(t=(e=W==null?void 0:W[io])==null?void 0:e[Nr])==null?void 0:t["developer-hub"];n&&n.enabled&&typewriter.showSequence(n.enabled)}function aw(){var n,e;if(ar){const t=((e=(n=W==null?void 0:W[io])==null?void 0:n[Nr])==null?void 0:e["developer-hub"])||null;if(t===null)typewriter.showSequence(W["WRONG-ROOM"]);else if(t.enabler)if(!Xi)typewriter.showSequence(t.enabler);else{const o=t["enabler-complete"].slice(0,-1),r=Pc();typewriter.showSequence([...o,r])}else if(t.enabled)if(qh&&!ir)typewriter.showSequence(t.enabled);else if(ir){const o=t["enabled-complete"].slice(0,-1),r=Pc();typewriter.showSequence([...o,r])}else typewriter.showSequence(t["enabled-not-available"]);ar=!1}}function Pc(){return ir&&Xi?(Wi("Objective","Return to situation room and wait."),"You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."):"You should investigate some other rooms in case you can assist further."}const kc=et(ew,n=>{n?(console.log("Room updated."),tw(n),Tt(n,document.getElementById("players")),ze("developer-hub",n,localStorage.getItem("connectedUserRole")),ar&&(un(n,"developer-hub",localStorage.getItem("connectedUserRole"),document.getElementById("availableActions")),aw(),ar=!1)):(console.error("Room not found"),window.location.href="../index.html")});window.addEventListener("beforeunload",()=>{kc&&kc()});const lw=localStorage.getItem("connectedRoomId"),vs=localStorage.getItem("connectedUserId");localStorage.getItem("connectedRoomName");localStorage.getItem("connectedUsername");const xr=localStorage.getItem("connectedUserRole");let Ji=null,lr=null,jh=null,ao=0,bs=null,cr=!0;document.getElementById("back").addEventListener("click",()=>{tt("Situation Room")});function cw(n){if(n){document.getElementById("roomName").textContent=`Room: ${n.roomName}`,document.getElementById("currentDay").textContent=`Day: ${n.currentDay}`;const e=n.roomPlayers?Object.values(n.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${e.length}/4`,document.getElementById("yourName").textContent="",Ji=n.roomPlayers[vs].enablerComplete,lr=n.roomPlayers[vs].enabledComplete;const t=n.roomPlayers[vs].enabledValue;jh=t!=null,ao=n.currentDay,t!==null&&t!=bs&&(localStorage.getItem("enabledValueToastShown")||(uw().catch(o=>{console.warn("Error showing enabled value toast:",o)}),localStorage.setItem("enabledValueToastShown","true"))),t===null&&bs!==null&&localStorage.removeItem("enabledValueToastShown"),bs=t}}async function uw(){const n={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"},e=hw(xr,ao),t=n[e];wt.success(`The ${t} has sent you some information to be used in another room.`);try{const{playNotification:o}=await Mt(async()=>{const{playNotification:r}=await Promise.resolve().then(()=>hn);return{playNotification:r}},void 0);o()}catch(o){console.warn("Audio not available:",o)}dw()&&fw()}function hw(n,e){const t=Lt[e];for(const[o,r]of Object.entries(t))if(r===n)return o;return null}function dw(){return mw()==="research-lab"}function mw(){var e;return((e={1:{ca:"research-lab",ne:"developer-hub",se:"server-room",ds:"command-centre"},2:{ca:"command-centre",ne:"server-room",se:"research-lab",ds:"command-centre"},3:{ca:"command-centre",ne:"server-room",se:"developer-hub",ds:"research-lab"}}[ao])==null?void 0:e[xr])||null}function fw(){var e,t;const n=(t=(e=W==null?void 0:W[ao])==null?void 0:e[xr])==null?void 0:t["research-lab"];n&&n.enabled&&typewriter.showSequence(n.enabled)}function gw(){var n,e;if(cr){const t=((e=(n=W==null?void 0:W[ao])==null?void 0:n[xr])==null?void 0:e["research-lab"])||null;if(t===null)typewriter.showSequence(W["WRONG-ROOM"]);else if(t.enabler)if(!Ji)typewriter.showSequence(t.enabler);else{const o=t["enabler-complete"].slice(0,-1),r=Vc();typewriter.showSequence([...o,r])}else if(t.enabled)if(jh&&!lr)typewriter.showSequence(t.enabled);else if(lr){const o=t["enabled-complete"].slice(0,-1),r=Vc();typewriter.showSequence([...o,r])}else typewriter.showSequence(t["enabled-not-available"]);cr=!1}}function Vc(){return lr&&Ji?(Wi("Objective","Return to situation room and wait."),"You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."):"You should investigate some other rooms in case you can assist further."}const Dc=et(lw,n=>{n?(console.log("Room updated."),cw(n),Tt(n,document.getElementById("players")),ze("research-lab",n,localStorage.getItem("connectedUserRole")),cr&&(un(n,"research-lab",localStorage.getItem("connectedUserRole"),document.getElementById("availableActions")),gw(),cr=!1)):(console.error("Room not found"),window.location.href="../index.html")});window.addEventListener("beforeunload",()=>{Dc&&Dc()});const pw=localStorage.getItem("connectedRoomId"),Ts=localStorage.getItem("connectedUserId");localStorage.getItem("connectedRoomName");localStorage.getItem("connectedUsername");const Or=localStorage.getItem("connectedUserRole");let Zi=null,ur=null,Yh=null,lo=0,Es=null,hr=!0;document.getElementById("back").addEventListener("click",()=>{tt("Situation Room")});function yw(n){if(n){document.getElementById("roomName").textContent=`Room: ${n.roomName}`,document.getElementById("currentDay").textContent=`Day: ${n.currentDay}`;const e=n.roomPlayers?Object.values(n.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${e.length}/4`,document.getElementById("yourName").textContent="",Zi=n.roomPlayers[Ts].enablerComplete,ur=n.roomPlayers[Ts].enabledComplete;const t=n.roomPlayers[Ts].enabledValue;Yh=t!=null,lo=n.currentDay,t!==null&&t!=Es&&(localStorage.getItem("enabledValueToastShown")||(ww().catch(o=>{console.warn("Error showing enabled value toast:",o)}),localStorage.setItem("enabledValueToastShown","true"))),t===null&&Es!==null&&localStorage.removeItem("enabledValueToastShown"),Es=t}}async function ww(){console.log("showEnabledValueToast called");const n={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"},e=Lt[lo][Or],t=n[e];wt.success(`The ${t} has sent you some information to be used in another room.`);try{console.log("Importing audio module...");const{playNotification:o}=await Mt(async()=>{const{playNotification:r}=await Promise.resolve().then(()=>hn);return{playNotification:r}},void 0);console.log("Audio module imported, playing notification..."),o()}catch(o){console.warn("Audio not available:",o)}_w()&&bw()}function _w(){return vw()==="server-room"}function vw(){var e;return((e={1:{ca:"research-lab",ne:"developer-hub",se:"server-room",ds:"command-centre"},2:{ca:"command-centre",ne:"server-room",se:"research-lab",ds:"command-centre"},3:{ca:"command-centre",ne:"server-room",se:"developer-hub",ds:"research-lab"}}[lo])==null?void 0:e[Or])||null}function bw(){var e,t;const n=(t=(e=W==null?void 0:W[lo])==null?void 0:e[Or])==null?void 0:t["server-room"];n&&n.enabled&&typewriter.showSequence(n.enabled)}function Tw(){var n,e;if(hr){const t=((e=(n=W==null?void 0:W[lo])==null?void 0:n[Or])==null?void 0:e["server-room"])||null;if(t===null)typewriter.showSequence(W["WRONG-ROOM"]);else if(t.enabler)if(!Zi)typewriter.showSequence(t.enabler);else{const o=t["enabler-complete"].slice(0,-1),r=Nc();typewriter.showSequence([...o,r])}else if(t.enabled)if(Yh&&!ur)typewriter.showSequence(t.enabled);else if(ur){const o=t["enabled-complete"].slice(0,-1),r=Nc();typewriter.showSequence([...o,r])}else typewriter.showSequence(t["enabled-not-available"]);hr=!1}}function Nc(){return ur&&Zi?(ze("Objective","Return to situation room and wait."),"You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."):(ze("Objective","Explore other rooms."),"You should investigate some other rooms in case you can assist further.")}const xc=et(pw,n=>{n?(console.log("Room updated."),yw(n),Tt(n,document.getElementById("players")),ze("server-room",n,localStorage.getItem("connectedUserRole")),hr&&(un(n,"server-room",localStorage.getItem("connectedUserRole"),document.getElementById("availableActions")),Tw(),hr=!1)):(console.error("Room not found"),window.location.href="../index.html")});window.addEventListener("beforeunload",()=>{xc&&xc()});class Ew{constructor(){this.audioContext=null,this.sounds={},this.isEnabled=localStorage.getItem("audioEnabled")!=="false",this.volume=parseFloat(localStorage.getItem("audioVolume"))||.7,this.init()}async init(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),console.log("Audio context created, state:",this.audioContext.state),await this.createDefaultSounds(),console.log("Audio Manager initialized successfully, enabled:",this.isEnabled)}catch(e){console.warn("Audio Manager initialization failed:",e),this.isEnabled=!1}}async createDefaultSounds(){this.sounds.transmission=this.createTransmissionSound(),this.sounds.notification=this.createNotificationSound(),this.sounds.success=this.createSuccessSound(),this.sounds.error=this.createErrorSound(),this.sounds.ambient=this.createAmbientSound()}createTransmissionSound(){return()=>{if(!this.isEnabled||!this.audioContext)return;const e=this.audioContext.currentTime,t=2,o=this.audioContext.createOscillator(),r=this.audioContext.createGain();o.connect(r),r.connect(this.audioContext.destination),o.frequency.setValueAtTime(800,e),o.frequency.setValueAtTime(1200,e+.1),o.frequency.setValueAtTime(800,e+.2),o.frequency.setValueAtTime(1200,e+.3),o.frequency.setValueAtTime(800,e+.4),r.gain.setValueAtTime(0,e),r.gain.linearRampToValueAtTime(this.volume*.3,e+.05),r.gain.exponentialRampToValueAtTime(.001,e+.15),r.gain.setValueAtTime(0,e+.2),r.gain.linearRampToValueAtTime(this.volume*.3,e+.25),r.gain.exponentialRampToValueAtTime(.001,e+.35),r.gain.setValueAtTime(0,e+.4),r.gain.linearRampToValueAtTime(this.volume*.3,e+.45),r.gain.exponentialRampToValueAtTime(.001,e+.55),o.start(e),o.stop(e+t)}}createNotificationSound(){return()=>{if(console.log("Notification sound function called, enabled:",this.isEnabled,"context:",!!this.audioContext),!this.isEnabled||!this.audioContext){console.log("Audio disabled or no context, returning");return}console.log("Creating notification sound...");const e=this.audioContext.currentTime,t=this.audioContext.createOscillator(),o=this.audioContext.createGain();t.connect(o),o.connect(this.audioContext.destination),t.frequency.setValueAtTime(1e3,e),t.frequency.setValueAtTime(1200,e+.1),o.gain.setValueAtTime(0,e),o.gain.linearRampToValueAtTime(this.volume*.2,e+.05),o.gain.exponentialRampToValueAtTime(.001,e+.2),t.start(e),t.stop(e+.3),console.log("Notification sound started")}}createSuccessSound(){return()=>{if(!this.isEnabled||!this.audioContext)return;const e=this.audioContext.currentTime,t=this.audioContext.createOscillator(),o=this.audioContext.createGain();t.connect(o),o.connect(this.audioContext.destination),t.frequency.setValueAtTime(800,e),t.frequency.setValueAtTime(1e3,e+.1),t.frequency.setValueAtTime(1200,e+.2),t.frequency.setValueAtTime(1400,e+.3),o.gain.setValueAtTime(0,e),o.gain.linearRampToValueAtTime(this.volume*.25,e+.05),o.gain.exponentialRampToValueAtTime(.001,e+.4),t.start(e),t.stop(e+.5)}}createErrorSound(){return()=>{if(!this.isEnabled||!this.audioContext)return;const e=this.audioContext.currentTime,t=this.audioContext.createOscillator(),o=this.audioContext.createGain();t.connect(o),o.connect(this.audioContext.destination),t.frequency.setValueAtTime(600,e),t.frequency.setValueAtTime(500,e+.1),t.frequency.setValueAtTime(400,e+.2),o.gain.setValueAtTime(0,e),o.gain.linearRampToValueAtTime(this.volume*.2,e+.05),o.gain.exponentialRampToValueAtTime(.001,e+.3),t.start(e),t.stop(e+.4)}}createAmbientSound(){return()=>{if(!this.isEnabled||!this.audioContext)return;const e=this.audioContext.currentTime,t=this.audioContext.createOscillator(),o=this.audioContext.createGain();t.connect(o),o.connect(this.audioContext.destination),t.frequency.setValueAtTime(60,e),o.gain.setValueAtTime(0,e),o.gain.linearRampToValueAtTime(this.volume*.05,e+1),t.start(e),t.stop(e+5)}}play(e){this.sounds[e]?this.sounds[e]():console.warn(`Sound '${e}' not found`)}playTransmission(){this.play("transmission")}playNotification(){console.log("Playing notification sound, audio enabled:",this.isEnabled),this.play("notification")}playSuccess(){this.play("success")}playError(){this.play("error")}playAmbient(){this.play("ambient")}toggle(){return this.isEnabled=!this.isEnabled,localStorage.setItem("audioEnabled",this.isEnabled),this.isEnabled}setVolume(e){this.volume=Math.max(0,Math.min(1,e)),localStorage.setItem("audioVolume",this.volume)}getVolume(){return this.volume}isAudioEnabled(){return this.isEnabled}resume(){this.audioContext&&this.audioContext.state==="suspended"&&this.audioContext.resume()}testAudio(){var e;console.log("Testing audio system..."),console.log("Audio enabled:",this.isEnabled),console.log("Audio context state:",(e=this.audioContext)==null?void 0:e.state),console.log("Volume:",this.volume),this.audioContext&&this.audioContext.state==="suspended"?(console.log("Audio context suspended, attempting to resume..."),this.audioContext.resume().then(()=>{console.log("Audio context resumed, playing test sound..."),this.playNotification()})):(console.log("Playing test notification sound..."),this.playNotification())}}const zh=new Ew,Iw=()=>zh.playTransmission(),Aw=()=>zh.playNotification(),hn=Object.freeze(Object.defineProperty({__proto__:null,playNotification:Aw,playTransmission:Iw},Symbol.toStringTag,{value:"Module"}));
