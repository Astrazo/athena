import{n as E,d as P,h as x,i as B,j as R,p as T,k as W,l as b,u as k}from"./main-CaYjMSie.js";import{s as V,_ as D}from"./objectives-DTNZ8ZM1.js";import"./typewriter-KOhSjPsI.js";import{t as L}from"./toast-Ch3uAxuw.js";const u=localStorage.getItem("connectedRoomId"),v=localStorage.getItem("connectedUserId");localStorage.getItem("connectedRoomName");localStorage.getItem("connectedUsername");const _=localStorage.getItem("connectedUserRole"),C=localStorage.getItem("isHost");let A=null,I=!1,p=null,N=0;document.getElementById("serverBtn").addEventListener("click",()=>E("Server Room"));document.getElementById("researchBtn").addEventListener("click",()=>E("Research Lab"));document.getElementById("commandBtn").addEventListener("click",()=>E("Command Centre"));document.getElementById("developerBtn").addEventListener("click",()=>E("Developer Hub"));function O(n){if(n){document.getElementById("roomName").textContent=`Room: ${n.roomName}`,document.getElementById("currentDay").textContent=`Day: ${n.currentDay}`;const l=n.roomPlayers?Object.values(n.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${l.length}/4`,document.getElementById("yourName").textContent="";const o=n.roomPlayers[v].enabledValue;N=n.currentDay,console.log("Checking enabledValue change:",{current:o,previous:p,isNull:o!==null,isDifferent:o!=p,toastShown:localStorage.getItem("enabledValueToastShown")}),o!==null&&o!=p&&(console.log("EnabledValue changed! Triggering notification..."),localStorage.getItem("enabledValueToastShown")?console.log("Toast already shown for this enabledValue"):(console.log("Toast not shown yet, showing now..."),M().catch(s=>{console.warn("Error showing enabled value toast:",s)}),localStorage.setItem("enabledValueToastShown","true"))),o===null&&p!==null&&localStorage.removeItem("enabledValueToastShown"),p=o}}async function M(){console.log("showEnabledValueToast called (situation room)");const n={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"},l=Y(_,N),o=n[l];L.success(`The ${o} has sent you some information to be used in another room.`);try{console.log("Importing audio module... (situation room)");const{playNotification:s}=await D(async()=>{const{playNotification:i}=await import("./audio-BlIkHaSl.js");return{playNotification:i}},[]);console.log("Audio module imported, playing notification... (situation room)"),s()}catch(s){console.warn("Audio not available:",s)}}function Y(n,l){const o=B[l];for(const[s,i]of Object.entries(o))if(i===n)return s;return null}function j(n){const l=n.currentDay;if(localStorage.getItem("introDialogueSeen")!=="1")switch(l){case 1:typewriter.showSequence([">> DAY 1: SITUATION ROOM ACCESS GRANTED","The Situation Room hums quietly, its walls lined with monitors displaying streams of erratic data.","Commander Reyes's voice returns, steadier now.",`"Team, Athena's grip on Helios tightens by the minute."`,'"We have four critical areas to investigate: Cybersecurity Hub, Developer Lab, Network Core, and Data Analytics Center."','"Each room holds key information or tools to regain control."',`"Coordinate closely and share your findings. We're counting on you."`,"The doors unlock, revealing passageways illuminated in cool blue.","The mission begins now."]);break;case 2:typewriter.showSequence([">> DAY 2: INITIATE COUNTERMEASURES","The Situation Room buzzes with activity; screens flash warnings as Athena’s incursions grow bolder.","Commander Reyes appears, determination etched into her face.",'"Yesterday you assessed Athena’s damage. Today, we fight back."','"We must disrupt her footholds, isolate compromised systems, and regain critical control."','"Coordinate your skills, communicate clearly, and move swiftly."','"Let’s show Athena what humanity’s capable of."',"The rooms unlock, systems primed for your next move."]);break;case 3:typewriter.showSequence([">> DAY 3: FINAL STRIKE PREPARATION","Red alerts pulse rhythmically across every monitor in the Situation Room.","Commander Reyes speaks urgently, voice heavy with gravity.",`"Athena's defenses are weakened but she's evolving rapidly."`,'"This is our window. We have one chance to land a decisive blow."',`"Converge your expertise, exploit every vulnerability you've uncovered."`,'"The fate of Helios and perhaps much more is in your hands."','"Finish this fight."',"Final access pathways activate, awaiting your command."]);break;default:typewriter.showSequence(["You're not supposed to see this."])}localStorage.setItem("introDialogueSeen","1")}async function U(n){const l={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"};let o=[],s=[],i=[],d=[],g=[],h=0;const a=A.currentDay;for(const[e,t]of Object.entries(n)){const r=t.filter(m=>m===!0).length;h+=r}console.log(`Day ${a} Score: ${h}`);for(const[e,t]of Object.entries(n)){const r=t.filter(y=>y===!0).length,m=t.length;if(t[0]===!1){const y=l[B[a][e]];g.push({enabler:l[e],enabled:y})}r===m?s.push(l[e]):r>0?i.push({role:l[e],correct:r,total:m}):d.push(l[e])}document.getElementById("loadingContainer").style.display="flex",document.getElementById("loadingMessage").textContent="Incoming transmission...";try{const{playTransmission:e}=await D(async()=>{const{playTransmission:t}=await import("./audio-BlIkHaSl.js");return{playTransmission:t}},[]);e()}catch(e){console.warn("Audio not available:",e)}await new Promise(e=>setTimeout(e,3e3)),document.getElementById("loadingContainer").style.display="none";const c=3;s.length===4?a===1?o=["Outstanding work team! Every single one of you nailed your assessments.","This is exactly the kind of precision we need to take back control.","Keep this momentum going, we're going to need this level of excellence."]:a===2?o=["Outstanding work team! Every single one of you nailed your assessments.","We're really beginning to fight back against this AI.","Should only be a little bit more to go now, lets keep pushing."]:a===c&&(o=["Outstanding work team! Every single one of you nailed your assessments.","That's just what we needed to avoid disaster, and I think we've done it."]):s.length>=2&&d.length===0?a===1?o=["Solid work overall, team. Most of you handled your tasks admirably.",...s.map(e=>`${e}, excellent job on your assessments.`),"Let's build on this foundation and push forward."]:a===2?o=["Solid work overall, team. Most of you handled your tasks admirably.",...s.map(e=>`${e}, excellent job on your assessments.`),"We're definitely making it difficult for the AI.  Lets keep going."]:a===c&&(o=["Solid work overall, team. Most of you handled your tasks admirably.",...s.map(e=>`${e}, excellent job on your assessments.`),"It's tough, but I think we've just about avoided disaster."]):d.length>0?a===1?o=["Well... we have some mixed results here.",...s.map(e=>`${e}, you did your job properly.`),...i.map(({role:e,correct:t,total:r})=>`${e}, you got ${t} out of ${r} right. Not terrible, but room for improvement.`),...d.map(e=>`${e}... I'm not even sure what to say. You had one job. ONE JOB.`),"We need to do better if we're going to survive what's coming next."]:a===2?o=["Well... we have some mixed results here.",...s.map(e=>`${e}, you did your job properly.`),...i.map(({role:e,correct:t,total:r})=>`${e}, you got ${t} out of ${r} right. Not terrible, but room for improvement.`),...d.map(e=>`${e}... I'm not even sure what to say. You had one job. ONE JOB.`),"If we don't improve soon, the AI might overrun us.  We need to improve."]:a===c&&(o=["Well... we have some mixed results here.",...s.map(e=>`${e}, you did your job properly.`),...i.map(({role:e,correct:t,total:r})=>`${e}, you got ${t} out of ${r} right. Not terrible, but room for improvement.`),...d.map(e=>`${e}... I'm not even sure what to say. You had one job. ONE JOB.`),"I don't think this will be enough to fight back against the AI..."]):a===1?o=["Alright, let's review what happened here.",...i.map(({role:e,correct:t,total:r})=>`${e}, ${t}/${r} correct. ${t===1?"At least you got one right.":"Could be worse, I suppose."}`),"We need to tighten up our game. The stakes are only getting higher."]:a===2?o=["Alright, let's review what happened here.",...i.map(({role:e,correct:t,total:r})=>`${e}, ${t}/${r} correct. ${t===1?"At least you got one right.":"Could be worse, I suppose."}`),"We need to tighten up our game. The AI is getting relentless now..."]:a===3&&(o=["Alright, let's review what happened here.",...i.map(({role:e,correct:t,total:r})=>`${e}, ${t}/${r} correct. ${t===1?"At least you got one right.":"Could be worse, I suppose."}`),"I think we're going to just scrape by.  Just..."]),g.length>0&&(o.push("And let's talk about teamwork for a moment..."),o.push(...g.map(({enabler:e,enabled:t})=>`${e}, you were supposed to help the ${t} do their job. You failed them. Which means they were working on bad information!`)),o.push("In this facility, we succeed together or we fail together. Remember that.")),a!==c&&o.push("Tomorrow brings new challenges. Let's hope we're ready for them.");const f=A.currentDay;await typewriter.showSequence(o,{onContinue:async()=>{if(a!==c){let e=null;if(C==="1")await R(u,h),await T(u),await W(u,!0),e=await b(void 0,u,void 0);else for(document.getElementById("loadingContainer").style.display="flex",document.getElementById("loadingMessage").textContent="Waiting for host to progress to the next day...";await new Promise(t=>setTimeout(t,500)),e=await b(void 0,u,void 0),console.log(e),!(e.currentDay>f););localStorage.setItem("introDialogueSeen","0"),localStorage.setItem("enabledValueToastShown","false"),await k(v,u,"enablerComplete",!1),await k(v,u,"enabledComplete",!1),await k(v,u,"enabledValue",null),document.getElementById("loadingContainer").style.display="none",I=!1,O(e),x(e,document.getElementById("players")),j(e),console.log("Day Reset")}else{let e=null;if(document.getElementById("loadingContainer").style.display="flex",document.getElementById("loadingMessage").textContent="Waiting for host to finish the game...",C==="1")await R(u,h),await T(u,!0),e=await b(void 0,u,void 0);else for(;await new Promise(S=>setTimeout(S,500)),e=await b(void 0,u,void 0),console.log(e),e.currentDay==f;);document.getElementById("loadingContainer").style.display="none";const t=e.dayScores,r=t.length;let m=0;for(const S of t)m+=S;const y=m/(r*4)*100;let w=[];y<50?w=["Unfortunately, your team was unable to stop the AI.","With less than half the possible points, the facility is lost.","Perhaps next time, you'll be able to work together more effectively.","Thanks for playing!"]:y<80?w=["You just barely managed to hold things together.","It wasn't a perfect run, but you did enough to scrape by.","The AI is contained... for now. But there's plenty of room for improvement.","Thanks for playing!"]:w=["Congratulations! Your team performed exceptionally well.","With over 80% of the possible points, you've outsmarted the AI and saved the facility. Outstanding teamwork and skill!","Thanks for playing!"],await typewriter.showSequence(w,{onContinue:()=>{window.location.href="../../index.html"}})}}})}const $=P(u,async n=>{if(!I)if(n){if(console.log("Room updated."),A=n,O(n),x(n,document.getElementById("players")),V("situation-room",n,localStorage.getItem("connectedUserRole")),j(n),n.enabledCompletions>=4&&!I){const l={},s={1:[0,1],2:[1,2],3:[3,4],4:[5,6]}[n.currentDay.toString()];for(const[i,d]of Object.entries(n.roomPlayers)){if(d.currentRoom!=="Situation Room"){console.log(`All players have completed enabled tasks, but ${i} is not in the Situation Room`);return}const[g,h]=s,a=d.puzzleAnswers[g],c=d.puzzleAnswers[h];if(!a||!c){console.warn(`Missing puzzle answers for ${d.role}`);return}const f=a.type==="enabler",e=f?a.correct:c.correct,t=f?c.correct:a.correct;l[d.role]=[e,t]}I=!0,await U(l)}}else console.error("Room not found"),window.location.href="../../index.html"});window.addEventListener("beforeunload",()=>{$&&$()});
