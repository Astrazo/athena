import{d as I,u as R,p as f}from"./main-3GqDBcTq.js";import"./typewriter-CCdU_-e1.js";const i=localStorage.getItem("connectedRoomId"),y=localStorage.getItem("connectedUserId");localStorage.getItem("connectedRoomName");const b=localStorage.getItem("connectedUsername"),g=localStorage.getItem("isHost");let h=!1;const s={ds:{count:0,users:[]},se:{count:0,users:[]},ne:{count:0,users:[]},ca:{count:0,users:[]}};let m=!0,a=!1,c=null;function S(e){if(e){document.getElementById("roomName").textContent=`Room: ${e.roomName}`;const o=e.roomPlayers?Object.values(e.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${o.length}/4`,document.getElementById("yourName").textContent=`You: ${b}`}}function E(e){const o=document.getElementById("players");o.innerHTML="",e&&e.roomPlayers&&(Object.entries(e.roomPlayers).forEach(([l,n])=>{const t=document.createElement("li"),u={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"}[n.role]||"Unassigned";t.textContent=`${n.name} - ${u}`,l===y&&(t.classList.add("current-player"),t.style.fontWeight="bold",t.style.color="#4CAF50",localStorage.setItem("connectedUserRole",n.role)),o.appendChild(t)}),Object.entries(e.roomPlayers).forEach(([l,n])=>{const t=n.role;t&&t!=="None"&&(s[t].count=(s[t].count||0)+1,s[t].users.push(l),s[t].count>1&&(h=!0))}))}function C(e){h?typewriter.showSequence(["You picked the same roles?!?!","I thought you were the best?","I guess I'll have to handle you myself..."],{onLineComplete:()=>{typewriter.hide(),a=!0,e.roomPlayers[y].isHost===1&&Object.entries(s).forEach(([o,l])=>{if(console.log(s),l.count>1){const n=Object.keys(s).filter(r=>s[r].count===0);l.users.slice(1).forEach((r,u)=>{if(n.length>0){const w=Math.floor(Math.random()*n.length),p=n.splice(w,1)[0];R(r,i,"role",p)}})}})}}):typewriter.showSequence(["Good work team","Lets get to work!"],{onContinue:async()=>{if(document.getElementById("loadingContainer").style.display="flex",localStorage.setItem("introDialogueSeen","0"),g==="1")await f(i),window.location.href="rooms/situation-room.html";else{for(;!(c.currentDay>0);)await new Promise(o=>setTimeout(o,500));window.location.href="rooms/situation-room.html"}}})}function P(e){typewriter.showSequence(["Now that that's sorted, lets get to work.","Your communication skills can surely only get better from here.","Right?"],{onContinue:async()=>{if(document.getElementById("loadingContainer").style.display="flex",localStorage.setItem("introDialogueSeen","0"),g==="1")await f(i),window.location.href="rooms/situation-room.html";else{for(;!(c.currentDay>0);)await new Promise(o=>setTimeout(o,500));window.location.href="rooms/situation-room.html"}}})}const d=I(i,e=>{e?(c=e,S(e),E(e),m?(C(e),m=!1):a&&(P(),a=!1)):(console.error("Room not found"),window.location.href="../index.html")});window.addEventListener("beforeunload",()=>{d&&d()});
