import{n as I,d as R,h as p,i as S,m,o as E}from"./main-CaYjMSie.js";import{_ as v,s as P,u as C}from"./objectives-DTNZ8ZM1.js";import"./typewriter-KOhSjPsI.js";import{t as z}from"./toast-Ch3uAxuw.js";const O=localStorage.getItem("connectedRoomId"),u=localStorage.getItem("connectedUserId");localStorage.getItem("connectedRoomName");localStorage.getItem("connectedUsername");const s=localStorage.getItem("connectedUserRole");let b=null,c=null,h=null,a=0,d=null,r=!0;document.getElementById("back").addEventListener("click",()=>{I("Situation Room")});function w(e){if(e){document.getElementById("roomName").textContent=`Room: ${e.roomName}`,document.getElementById("currentDay").textContent=`Day: ${e.currentDay}`;const n=e.roomPlayers?Object.values(e.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${n.length}/4`,document.getElementById("yourName").textContent="",b=e.roomPlayers[u].enablerComplete,c=e.roomPlayers[u].enabledComplete;const t=e.roomPlayers[u].enabledValue;h=t!=null,a=e.currentDay,t!==null&&t!=d&&(localStorage.getItem("enabledValueToastShown")||(T().catch(o=>{console.warn("Error showing enabled value toast:",o)}),localStorage.setItem("enabledValueToastShown","true"))),t===null&&d!==null&&localStorage.removeItem("enabledValueToastShown"),d=t}}async function T(){const e={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"},n=N(s,a),t=e[n];z.success(`The ${t} has sent you some information to be used in another room.`);try{const{playNotification:o}=await v(async()=>{const{playNotification:l}=await import("./audio-BlIkHaSl.js");return{playNotification:l}},[]);o()}catch(o){console.warn("Audio not available:",o)}B()&&V()}function N(e,n){const t=S[n];for(const[o,l]of Object.entries(t))if(l===e)return o;return null}function B(){return L()==="command-centre"}function L(){var n;return((n={1:{ca:"research-lab",ne:"developer-hub",se:"server-room",ds:"command-centre"},2:{ca:"command-centre",ne:"server-room",se:"research-lab",ds:"command-centre"},3:{ca:"command-centre",ne:"server-room",se:"developer-hub",ds:"research-lab"}}[a])==null?void 0:n[s])||null}function V(){var n,t,o;const e=(o=(t=(n=m)==null?void 0:n[a])==null?void 0:t[s])==null?void 0:o["command-centre"];e&&e.enabled&&typewriter.showSequence(e.enabled)}function M(){var e,n,t;if(r){const o=((t=(n=(e=m)==null?void 0:e[a])==null?void 0:n[s])==null?void 0:t["command-centre"])||null;if(console.log(`${a}${s}`),o===null)typewriter.showSequence(m["WRONG-ROOM"]);else if(o.enabler)if(!b)typewriter.showSequence(o.enabler);else{const l=o["enabler-complete"].slice(0,-1),i=g();typewriter.showSequence([...l,i])}else if(o.enabled)if(h&&!c)typewriter.showSequence(o.enabled);else if(c){const l=o["enabled-complete"].slice(0,-1),i=g();typewriter.showSequence([...l,i])}else typewriter.showSequence(o["enabled-not-available"]);r=!1,console.log(r)}}function g(){return c&&b?(C("Objective","Return to situation room and wait."),"You feel like you've done all you can for today, return to the situation room and wait for your teammates to finish up."):"You should investigate some other rooms in case you can assist further."}function y(){const e=JSON.parse(localStorage.getItem("localRoomData")||"{}");e&&e.roomPlayers&&Object.values(e.roomPlayers).some(t=>t.role!==null)?(w(e),p(e,document.getElementById("players"))):document.getElementById("players").innerHTML=""}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",y):y();const f=R(O,e=>{e?(console.log("Room updated."),w(e),p(e,document.getElementById("players")),P("command-centre",e,localStorage.getItem("connectedUserRole")),r&&(E(e,"command-centre",localStorage.getItem("connectedUserRole"),document.getElementById("availableActions")),M(),r=!1)):(console.error("Room not found"),window.location.href="../index.html")});window.addEventListener("beforeunload",()=>{f&&f()});
