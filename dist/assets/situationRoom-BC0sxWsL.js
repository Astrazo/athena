import{n as I,d as j,g as x,h as O,i as E,p as R,j as P,l as w,u as k}from"./main-3GqDBcTq.js";import"./typewriter-CCdU_-e1.js";const i=localStorage.getItem("connectedRoomId"),$=localStorage.getItem("connectedUserId");localStorage.getItem("connectedRoomName");const W=localStorage.getItem("connectedUsername");localStorage.getItem("connectedUserRole");const A=localStorage.getItem("isHost");let S=null,b=!1;document.getElementById("serverBtn").addEventListener("click",()=>I("Server Room"));document.getElementById("researchBtn").addEventListener("click",()=>I("Research Lab"));document.getElementById("commandBtn").addEventListener("click",()=>I("Command Centre"));document.getElementById("developerBtn").addEventListener("click",()=>I("Developer Hub"));function C(s){if(s){document.getElementById("roomName").textContent=`Room: ${s.roomName}`;const r=s.roomPlayers?Object.values(s.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${r.length}/4`,document.getElementById("yourName").textContent=`You: ${W}`}}function D(s){const r=s.currentDay;if(localStorage.getItem("introDialogueSeen")!=="1")switch(r){case 1:typewriter.showSequence(["Welcome, team, to the situation room.","From here, you can access these four rooms which may contain what you need to fix this.","Good luck, and don't be afraid to ask for help if you need it."]);break;case 2:typewriter.showSequence(["Day 2 welcome dialogue."]);break;case 3:typewriter.showSequence(["Day 3 welcome dialogue."]);break;case 4:typewriter.showSequence(["Day 4 welcome dialogue."]);break;default:typewriter.showSequence(["You're not supposed to see this.","I guess you guys really are the best..."])}localStorage.setItem("introDialogueSeen","1")}async function N(s){const r={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"};let a=[],u=[],d=[],l=[],g=[],h=0;const o=S.currentDay;for(const[e,t]of Object.entries(s)){const n=t.filter(m=>m===!0).length;h+=n}console.log(`Day ${o} Score: ${h}`);for(const[e,t]of Object.entries(s)){const n=t.filter(y=>y===!0).length,m=t.length;if(t[0]===!1){const y=r[O[o][e]];g.push({enabler:r[e],enabled:y})}n===m?u.push(r[e]):n>0?d.push({role:r[e],correct:n,total:m}):l.push(r[e])}const c=3;u.length===4?o===1?a=["Outstanding work team! Every single one of you nailed your assessments.","This is exactly the kind of precision we need to take back control.","Keep this momentum going, we're going to need this level of excellence."]:o===2?a=["Outstanding work team! Every single one of you nailed your assessments.","We're really beginning to fight back against this AI.","Should only be a little bit more to go now, lets keep pushing."]:o===c&&(a=["Outstanding work team! Every single one of you nailed your assessments.","That's just what we needed to avoid disaster, and I think we've done it."]):u.length>=2&&l.length===0?o===1?a=["Solid work overall, team. Most of you handled your tasks admirably.",...u.map(e=>`${e}, excellent job on your assessments.`),"Let's build on this foundation and push forward."]:o===2?a=["Solid work overall, team. Most of you handled your tasks admirably.",...u.map(e=>`${e}, excellent job on your assessments.`),"We're definitely making it difficult for the AI.  Lets keep going."]:o===c&&(a=["Solid work overall, team. Most of you handled your tasks admirably.",...u.map(e=>`${e}, excellent job on your assessments.`),"It's tough, but I think we've just about avoided disaster."]):l.length>0?o===1?a=["Well... we have some mixed results here.",...u.map(e=>`${e}, you did your job properly.`),...d.map(({role:e,correct:t,total:n})=>`${e}, you got ${t} out of ${n} right. Not terrible, but room for improvement.`),...l.map(e=>`${e}... I'm not even sure what to say. You had one job. ONE JOB.`),"We need to do better if we're going to survive what's coming next."]:o===2?a=["Well... we have some mixed results here.",...u.map(e=>`${e}, you did your job properly.`),...d.map(({role:e,correct:t,total:n})=>`${e}, you got ${t} out of ${n} right. Not terrible, but room for improvement.`),...l.map(e=>`${e}... I'm not even sure what to say. You had one job. ONE JOB.`),"If we don't improve soon, the AI might overrun us.  We need to improve."]:o===c&&(a=["Well... we have some mixed results here.",...u.map(e=>`${e}, you did your job properly.`),...d.map(({role:e,correct:t,total:n})=>`${e}, you got ${t} out of ${n} right. Not terrible, but room for improvement.`),...l.map(e=>`${e}... I'm not even sure what to say. You had one job. ONE JOB.`),"I don't think this will be enough to fight back against the AI..."]):o===1?a=["Alright, let's review what happened here.",...d.map(({role:e,correct:t,total:n})=>`${e}, ${t}/${n} correct. ${t===1?"At least you got one right.":"Could be worse, I suppose."}`),"We need to tighten up our game. The stakes are only getting higher."]:o===2?a=["Alright, let's review what happened here.",...d.map(({role:e,correct:t,total:n})=>`${e}, ${t}/${n} correct. ${t===1?"At least you got one right.":"Could be worse, I suppose."}`),"We need to tighten up our game. The AI is getting relentless now..."]:o===3&&(a=["Alright, let's review what happened here.",...d.map(({role:e,correct:t,total:n})=>`${e}, ${t}/${n} correct. ${t===1?"At least you got one right.":"Could be worse, I suppose."}`),"I think we're going to just scrape by.  Just..."]),g.length>0&&(a.push("And let's talk about teamwork for a moment..."),a.push(...g.map(({enabler:e,enabled:t})=>`${e}, you were supposed to help the ${t} do their job. You failed them. Which means they were working on bad information!`)),a.push("In this facility, we succeed together or we fail together. Remember that.")),o!==c&&a.push("Tomorrow brings new challenges. Let's hope we're ready for them.");const f=S.currentDay;await typewriter.showSequence(a,{onContinue:async()=>{if(o!==c){let e=null;if(A==="1")await E(i,h),await R(i),await P(!0),e=await w(void 0,i,void 0);else for(;await new Promise(t=>setTimeout(t,500)),e=await w(void 0,i,void 0),console.log(e),!(e.currentDay>f););localStorage.setItem("introDialogueSeen","0"),document.getElementById("loadingContainer").style.display="flex",await k($,i,"enablerComplete",!1),await k($,i,"enabledComplete",!1),await k($,i,"enabledValue",null),document.getElementById("loadingContainer").style.display="none",b=!1,C(e),x(e,document.getElementById("players")),D(e)}else{let e=null;if(document.getElementById("loadingContainer").style.display="flex",A==="1")await E(i,h),await R(i,!0),e=await w(void 0,i,void 0);else for(;await new Promise(v=>setTimeout(v,500)),e=await w(void 0,i,void 0),console.log(e),e.currentDay==f;);document.getElementById("loadingContainer").style.display="none";const t=e.dayScores,n=t.length;let m=0;for(const v of t)m+=v;const y=m/(n*4)*100;let p=[];y<50?p=["Unfortunately, your team was unable to stop the AI.","With less than half the possible points, the facility is lost.","Perhaps next time, you'll be able to work together more effectively."]:y<80?p=["You just barely managed to hold things together.","It wasn't a perfect run, but you did enough to scrape by.","The AI is contained... for now. But there's plenty of room for improvement."]:p=["Congratulations! Your team performed exceptionally well.","With over 80% of the possible points, you've outsmarted the AI and saved the facility.","Outstanding teamwork and skill!"],await typewriter.showSequence(p,{onContinue:()=>{window.location.href="/index.html"}})}}})}const B=j(i,async s=>{if(!b)if(s){if(console.log("Room updated."),S=s,C(s),x(s,document.getElementById("players")),D(s),s.enabledCompletions>=4&&!b){const r={},u={1:[0,1],2:[1,2],3:[3,4],4:[5,6]}[s.currentDay.toString()];for(const[d,l]of Object.entries(s.roomPlayers)){if(l.currentRoom!=="Situation Room"){console.log(`All players have completed enabled tasks, but ${d} is not in the Situation Room`);return}const[g,h]=u,o=l.puzzleAnswers[g],c=l.puzzleAnswers[h];if(!o||!c){console.warn(`Missing puzzle answers for ${l.role}`);return}const f=o.type==="enabler",e=f?o.correct:c.correct,t=f?c.correct:o.correct;r[l.role]=[e,t]}b=!0,await N(r)}}else console.error("Room not found"),window.location.href="/index.html"});window.addEventListener("beforeunload",()=>{B&&B()});
