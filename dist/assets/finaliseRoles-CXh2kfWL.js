import{d as I,e as R,p as f,u as C}from"./main-fhajF75_.js";import"./typewriter-KOhSjPsI.js";import{s as E}from"./objectives-BzP7pnAo.js";import{t as S}from"./toast-Ch3uAxuw.js";const l=localStorage.getItem("connectedRoomId"),g=localStorage.getItem("connectedUserId");localStorage.getItem("connectedRoomName");const b=localStorage.getItem("connectedUsername"),h=localStorage.getItem("isHost");let u=!1;const n={ds:{count:0,users:[]},se:{count:0,users:[]},ne:{count:0,users:[]},ca:{count:0,users:[]}};let d=!0,w=!1,m=null;function N(e){if(e){document.getElementById("roomName").textContent=`Room: ${e.roomName}`;const r=e.roomPlayers?Object.values(e.roomPlayers):[];document.getElementById("playerCount").textContent=`Players: ${r.length}/4`,document.getElementById("yourName").textContent=`You: ${b}`}}function k(e){u=!1,Object.keys(n).forEach(a=>{n[a].count=0,n[a].users=[]});const r=document.getElementById("players");r.innerHTML="",e&&e.roomPlayers&&(Object.entries(e.roomPlayers).sort((t,s)=>{const o=t[1].name.toLowerCase(),i=s[1].name.toLowerCase();return o.localeCompare(i)}).forEach(([t,s])=>{const o=document.createElement("li"),c={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"}[s.role]||"Unassigned";o.textContent=`${s.name} - ${c}`,t===g&&(o.classList.add("current-player"),o.style.fontWeight="bold",o.style.color="#4CAF50",localStorage.setItem("connectedUserRole",s.role)),r.appendChild(o)}),Object.entries(e.roomPlayers).forEach(([t,s])=>{const o=s.role;o&&o!=="None"&&(n[o].count=(n[o].count||0)+1,n[o].users.push(t),n[o].count>1&&(u=!0))}))}function P(e){w=!0,e.roomPlayers[g].isHost===1&&Object.entries(n).forEach(([r,a])=>{if(console.log(n),a.count>1){const t=Object.keys(n).filter(o=>n[o].count===0);a.users.slice(1).forEach((o,i)=>{if(t.length>0){const c=Math.floor(Math.random()*t.length),p=t.splice(c,1)[0];C(o,l,"role",p)}})}}),S.success("Roles reshuffled",{duration:4e3}),setTimeout(()=>{document.getElementById("loadingContainer").style.display="none",v()},1e3)}function L(e){u?typewriter.showSequence([">> ROLE CONFLICT DETECTED","Commander Reyes’s voice interrupts, firm but reassuring.",'"Hold on, team—we have duplicated specializations."',`"Athena adapts quickly. We can't afford redundancy."`,`"I'm reassigning roles to optimize your strengths."`],{onContinue:()=>{typewriter.hide(),document.getElementById("loadingContainer").style.display="flex",R(l)}}):typewriter.showSequence([">> ROLE ASSIGNMENTS CONFIRMED","Commander Reyes’s voice comes through clearly, approval evident.",`"Good choices, team. You're each exactly where we need you."`,'"Stay sharp, move quickly, and keep communication open."',`"Let's regain control of Helios."`,"The Situation Room doors unlock, pathways awaiting your next move."],{onContinue:async()=>{if(document.getElementById("loadingContainer").style.display="flex",localStorage.setItem("introDialogueSeen","0"),h==="1")await f(l),window.location.href="rooms/situation-room.html";else{for(;!(m.currentDay>0);)await new Promise(r=>setTimeout(r,500));window.location.href="rooms/situation-room.html"}}})}function v(e){const r={ds:"Data Scientist",se:"Software Engineer",ne:"Network Engineer",ca:"Cybersecurity Analyst"},a=localStorage.getItem("connectedUserRole"),t=r[a]||"Specialist";typewriter.showSequence(["You glance at the terminal as the system recalibrates your assignment.",`"New specializations set. You will be working as the ${t}. Confirm your tasks and move swiftly to the situation room."`],{onContinue:async()=>{if(document.getElementById("loadingContainer").style.display="flex",localStorage.setItem("introDialogueSeen","0"),h==="1")await f(l),window.location.href="rooms/situation-room.html";else{for(;!(m.currentDay>0);)await new Promise(s=>setTimeout(s,500));window.location.href="rooms/situation-room.html"}}})}const y=I(l,e=>{e?(m=e,N(e),k(e),E("finalise-roles"),d?(L(),d=!1):e.ackReshuffle>=Object.keys(e.roomPlayers).length&&!w&&P(e)):(console.error("Room not found"),window.location.href="../index.html")});window.addEventListener("beforeunload",()=>{y&&y()});
