<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Athena</title>
    <link rel="stylesheet" href="../styles.css">

</head>
<body>
    <!-- Game Info Display -->
    <div id="gameInfo" class="game-info">
        <div id="roomName">Room: Loading...</div>
        <div id="playerCount">Players: Loading...</div>
        <div id="yourName">You: Loading...</div>
    </div>

    <div class="menu-container">
        <h1 id="lobbyHeader"></h1>
        <div id="roomInfo" class="room-info">
            <h2 id="roomName">Finalise Roles</h2>
        </div>

        <div id="playerList" class="player-list">
            <h3>Roles</h3>
            <ul id="players"></ul>
        </div>

        <div class="button-container">
            <button id="dsBtn" class="std-button role-button" style="width: 250px; max-width: 100%;">Data Scientist</button>
            <button id="seBtn" class="std-button role-button" style="width: 250px;">Software Engineer</button>
            <button id="neBtn" class="std-button role-button" style="width: 250px; max-width: 100%;">Network Engineer</button>
            <button id="caBtn" class="std-button role-button" style="width: 250px;">Cybersecurity Analyst</button>
        </div>
    </div>

    <script type="module">
        import { updatePlayer, listenToRoom } from "../main.js";

        // Get room data from localStorage
        const roomId = localStorage.getItem("connectedRoomId");
        const userId = localStorage.getItem("connectedUserId");
        const roomName = localStorage.getItem("connectedRoomName");
        const username = localStorage.getItem("connectedUsername");
        const roomData = JSON.parse(localStorage.getItem("roomData") || "{}");

        // Function to update game info
        function updateGameInfo(roomData) {
            if (roomData) {
                document.getElementById("roomName").textContent = `Room: ${roomData.roomName}`;
                document.getElementById("playerCount").textContent = `Players: ${roomData.roomPlayers ? roomData.roomPlayers.length : 0}/4`;
                document.getElementById("yourName").textContent = `You: ${username}`;
            }
        }

        // Set up real-time listener for game info updates
        const unsubscribe = listenToRoom(roomId, (roomData) => {
            if (roomData) {
                updateGameInfo(roomData);
            } else {
                console.error("Room not found");
                window.location.href = "../index.html";
            }
        });

        // Initial update with stored data
        updateGameInfo({ roomName: roomName, roomPlayers: roomData.roomPlayers });

        // Clean up listener when leaving the page
        window.addEventListener("beforeunload", () => {
            if (unsubscribe) {
                unsubscribe();
            }
        });
    </script>
</body>
</html>

